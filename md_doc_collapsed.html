<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MPI-AMRVAC: Looking at line-integrated quantities</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MPI-AMRVAC
   &#160;<span id="projectnumber">3.1</span>
   </div>
   <div id="projectbrief">The MPI - Adaptive Mesh Refinement - Versatile Advection Code</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Looking at line-integrated quantities </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Collapsed output</h1>
<p>Often one wishes to look at quantities integrated over one particular direction (collapsing), yielding e.g. column densities. For this purpose AMRVAC can output line integrals of the simulation variables (plus user- specified variables) during runtime. The current implementation is efficient as we take advantage of the grid structure; however only collapsing along coordinate directions is currently possible (which is often sufficient). The user can freely specify the resolution (collapseLevel) of the resulting output data. No re-gridding of the domain is required, higher levels on the output grid are filled with flat interpolation. Note that collapsing of 1D output is not fully implemented. Collapsed output is sensitive to the switch <em>saveprim</em> of the <em>filelist</em> section, therefore primitive variable output at runtime is possible. Also the switch <em>nwauxio</em> affects the collapsed view to output user-defined variables.</p>
<h1>Setup in par file</h1>
<p>Collapsed views are the fourth file format with output intervals that can be specified in the <em>savelist</em> section of the par file. To give an example, here we ask for collapsed arrays in all three coordinate directions, where the logical <em>collapse(1)=T</em> specifies to output arrays integrated over the first coordinate direction. The other directions are analoguous. </p><pre class="fragment"> &amp;savelist;
        itsave(1,4)      = 0
        dtsave(4)        = 0.1d0
        collapse(1)      = T
        collapse(2)      = T
        collapse(3)      = T
        collapseLevel    = 3
/
</pre><p> In the standard configuration, AMRVAC will output <em>*.vti</em> files that can be visualized with paraview. The output filename is composed of the direction and level. For example, the first collapsed output name reads <em>filenameout_d1_l3_nXXXX.vti</em> and analoge for the other two. Note that the order of the (reduced) dimensions in the resulting output files is preserved, e.g. the first collapsed array in the example above will hold the y-direction as first coordinate and the z-direction as second coordinate. This should be kept in mind for visualization.</p>
<h1>Collapsing of existing output</h1>
<p>To collapse existing <em>*.dat</em> files, the simulation can be restarted from a given output time and the code can be brought to a halt after zero iterations. This is entirely analoguous to the method for <a class="el" href="md_doc_slices.html">slicing</a> <em>*.dat</em> files and done in the following way: it is best to create a new <em>*.par</em> file (e.g. collapse.par) and clear the savelist from any output to filetypes other than <em>4</em>. We use itsave to demand a collapse output for the zero-iteration. </p><pre class="fragment"> &amp;savelist;
        itsave(1,4)      = 0
        collapse(1)      = T
        collapse(2)      = T
        collapse(3)      = T
        collapseLevel    = 3
/
</pre><p> The stoplist should look as follows: </p><pre class="fragment"> &amp;stoplist;
        reset_it         = .true.
        it_max            = 0
/
</pre><p> where we reset the iteration counter (so that <em>itsave(1,4)=0</em> will output collapsed data) and stop the code immediately after the IO (<em>it_max=0</em>).</p>
<p>The code can then be started with </p><pre class="fragment">amrvac -i collapse.par -collapsenext 10 -if datamr/data0010.dat
</pre><p> which will take the output <em>datamr/data0010.dat</em> to create new collapsed view with index 10 (-collapse 10). The par-file is the newly created collapse.par (-i collapse.par) so that the default used to run the code can be left untouched. It is a simple exercise in shell scripting to run along all output-files in one go. For example with the BASH: </p><pre class="fragment">for i in {0..10}; do printf -v j "%04d" $i; mpirun -np 4 ./amrvac -i collapse.par -collapsenext $i -if datamr/data$j.dat; done
</pre> <h1>ASCII output</h1>
<p>As an alternative to the cell-type <em>*.vti</em> file format, you can obtain comma- separated-value <em>*.csv</em> files of the cell-center variables. This can be useful especially for 2D simulations (ergo 1D line output) which can then be simply visualized using e.g. gnuplot. For a quick look, the <em>*.csv</em> files can be visualized with GNUplot using a command similar to the following: </p><pre class="fragment">gnuplot&gt; p 'data_d1_l3_n0000.csv' u 2:1:9 with image
</pre><p> To activate csv ASCII output, the option </p><pre class="fragment"> &amp; filelist
        collapse_type    = 'csv'
/
</pre><p> needs to be set. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
