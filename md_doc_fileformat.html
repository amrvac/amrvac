<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MPI-AMRVAC: MPI-AMRVAC data file format</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MPI-AMRVAC
   &#160;<span id="projectnumber">3.1</span>
   </div>
   <div id="projectbrief">The MPI - Adaptive Mesh Refinement - Versatile Advection Code</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">MPI-AMRVAC data file format </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><blockquote class="doxtable">
<p>this doc describes the latest version of the data file format, which is numbered "5" </p>
</blockquote>
<p>All data files consist of a single snapshot, and they can be used for restart and/or further conversion to other data formats directly usable for visualization. Note that restart is possible on a differing number of CPUs, and may suddenly allow more refinement levels. Also, note that the individual snapshots will typically have different lengths, as the number of grid blocks will vary dynamically. The data is saved in binary format (double precision). You can find the exact implementation in <code>src/mod_input_output.t</code>, more specifically in <code><a class="el" href="namespacemod__input__output.html#acd293c80fe4dffe68b3bd5af075cc137" title="Write header for a snapshot.">snapshot_write_header()</a></code> and <code><a class="el" href="namespacemod__input__output.html#ae860a54ebdb7a0bee2fed1821d67cc99" title="Read header for a snapshot.">snapshot_read_header()</a></code>.</p>
<p>A snapshot (<code>.dat</code> file) contains a header, mesh tree information, and block data, in the following order:</p>
<h1>Header</h1>
<div class="fragment"><div class="line"><span class="keywordtype">integer</span>           :: Version number</div>
<div class="line"><span class="keywordtype">integer</span>           :: Byte offset where tree information starts</div>
<div class="line"><span class="keywordtype">integer</span>           :: Byte offset where block data starts</div>
<div class="line"><span class="keywordtype">integer</span>           :: nw</div>
<div class="line"><span class="keywordtype">integer</span>           :: ndir</div>
<div class="line"><span class="keywordtype">integer</span>           :: ndim</div>
<div class="line"><span class="keywordtype">integer</span>           :: levmax</div>
<div class="line"><span class="keywordtype">integer</span>           :: nleafs</div>
<div class="line"><span class="keywordtype">integer</span>           :: nparents</div>
<div class="line"><span class="keywordtype">integer</span>           :: it</div>
<div class="line"><span class="keywordtype">double precision</span>  :: global_time</div>
<div class="line"><span class="keywordtype">double precision</span>  :: xprobmin(ndim)</div>
<div class="line"><span class="keywordtype">double precision</span>  :: xprobmax(ndim)</div>
<div class="line"><span class="keywordtype">integer</span>           :: domain_nx(ndim)</div>
<div class="line"><span class="keywordtype">integer</span>           :: block_nx(ndim)</div>
<div class="line"><span class="keywordtype">logical</span>           :: periodic(ndim)</div>
<div class="line"><span class="keywordtype">character(len=16)</span> :: geometry</div>
<div class="line"><span class="keywordtype">logical</span>           :: staggered</div>
<div class="line"><span class="keywordtype">character(len=16)</span> :: w_names(nw)</div>
<div class="line"><span class="keywordtype">character(len=16)</span> :: physics_type</div>
<div class="line"><span class="comment">! The physics parameters, such as gamma</span></div>
<div class="line"><span class="keywordtype">integer</span>           :: n_params</div>
<div class="line"><span class="keywordtype">double precision</span>  :: parameters(n_params)</div>
<div class="line"><span class="keywordtype">character(len=16)</span> :: parameter_names(n_params)</div>
<div class="line"><span class="comment">! Indexes for file output (for restarting)</span></div>
<div class="line"><span class="keywordtype">integer</span>           :: snapshotnext</div>
<div class="line"><span class="keywordtype">integer</span>           :: slicenext</div>
<div class="line"><span class="keywordtype">integer</span>           :: collapsenext</div>
</div><!-- fragment --><h1>Tree information</h1>
<div class="fragment"><div class="line"><span class="keywordtype">logical</span> :: leaf(nleafs+nparents)</div>
<div class="line"><span class="keywordtype">integer</span> :: refinement_level(nleafs)</div>
<div class="line"><span class="keywordtype">integer</span> :: spatial_index(ndim, nleafs)</div>
<div class="line"><span class="keywordtype">integer(kind=MPI_OFFSET_KIND)</span> :: offset_block(nleafs)</div>
</div><!-- fragment --><h1>Block 1 to nleafs</h1>
<div class="fragment"><div class="line"><span class="keywordtype">integer</span> :: n_ghost_lo(ndim) <span class="comment">! number of ghost cells on lower boundaries</span></div>
<div class="line"><span class="keywordtype">integer</span> :: n_ghost_hi(ndim) <span class="comment">! number of ghost cells on upper boundaries</span></div>
<div class="line"><span class="comment">! block_shape = 1-n_ghost_lo:block_nx+n_ghost_hi</span></div>
<div class="line"><span class="keywordtype">double precision</span> :: w(block_shape, nw)</div>
</div><!-- fragment --><h1>Version history</h1>
<h2>Version 1</h2>
<p>Version 1 contained the following information </p><pre class="fragment">1. block data (nw variables)
2. leaf/parent logical array
3. header:
    nx^D
    domain_nx^D
    xprobmin^D
    xprobmax^D
    nleafs
    levmax
    ndim
    ndir
    nw
    it
    global_time
</pre><p> The idea is that you can reconstruct the full grid when you know the Morton order used for the leaf/parent logical array.</p>
<h2>Version 2</h2>
<p>Version 2 had the same information as version 1, but changes were made to the Morton order on the coarse grid, causing incompatibility.</p>
<h2>Version 5 (current)</h2>
<p>Version 5 introduced the <code>geometry</code> parameter (e.g. "polar_2D", "cartesian_1.75D"... ), as well as a <code>periodic</code> and a <code>staggered</code> flags. The periodic flag a <code>ndir</code>-long 1D boolean array. For each direction, it defaults to <code>.false.</code> but is set to <code>.true.</code> if at least one quantity is using a periodic boundary condition in the corresponding direction. This change was motivated by improving the (upcoming) compatibility with <code>yt</code>. The <code>staggered</code> flag is added to support staggered grid for constrained transport MHD. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
