<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MPI-AMRVAC: Reading the vtk files</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MPI-AMRVAC<span id="projectnumber">&#160;3.1</span>
   </div>
   <div id="projectbrief">The MPI - Adaptive Mesh Refinement - Versatile Advection Code</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Reading the vtk files</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="introductionvtk"></a>
Introduction on reading vtk files</h1>
<p>This document describes the use of Python for plotting MPI-AMRVAC 1D and 2D simulation data using the <code>vtk</code> filetypes. All required packages and instructions on how to set up the tools folder are described in <a class="el" href="md_doc_2python__setup.html">Setting up the python tools</a>. The vtk-file tools can be found in the folder <code>$AMRVAC_DIR/tools/python/vtkfiles</code>.</p>
<h1><a class="anchor" id="reading_vtk"></a>
Reading datasets</h1>
<p>Currently only the reading of <b>cell-centered</b> <code>vtk</code> file-types (<code>.vtu</code>, <code>.pvtu</code>, <code>.vti</code>) is supported, together with some ascii <code>.csv</code> files. Reading the data is handled in the file <code>read.py</code>, present in the <code>vtkfiles</code> subdirectory. This file contains various classes for different data.</p>
<p>Reading the <code>vtk</code> files is best done using an interactive environment. Hence, navigate to your directory containing your data and fire up <code>IPython</code>: </p><pre class="fragment">ipython --pylab
</pre><p> Next, import the reading and plotting classes: </p><pre class="fragment">from amrvac_pytools.vtkfiles import read, amrplot
</pre> <h2>vtu and pvtu filetypes</h2>
<p>These filetypes use the class <code>read.load()</code>, loading the data can be done as follows: </p><pre class="fragment">offset=15
ds = read.load_vtkfile(offset, file='KH', type='vtu')
</pre><p> which will read the file <code>KH0015.vtu</code>. The argument <code>offset</code> is zero-padded to four digits and is used to specify the file number. The argument <code>type</code> is either '<code>vtu</code>' (default) or &lsquo;'pvtu&rsquo;<code>, which is used to append the file extension and select the correct reading methods. The variables are contained in the instance</code>ds<code>, thus @iverbatim ds.rho @endiverbatim\ilinebr holds the Numpy array for the density,</code>ds.v1&lsquo; holds the first component of the velocity (assuming the data is in primitive quantities and your velocity variable is called &rsquo;<code>v1</code>') and so on. The available variables will be printed to the terminal when loading in the dataset. Different datasets can be loaded by supplying different offsets.</p>
<h2>vti filetypes</h2>
<p>This filetype uses the class <code>read.loadvti()</code>, loading the data can be done as follows: </p><pre class="fragment">offset=15
ds = read.loadvti(offset, file='KH')
</pre><p> which in turn reads the file <code>KH0015.vti</code>. In this case no filetype has to be specified. Accessing the variables in these uniform <code>.vti</code> files is done in a similar way as described above, the available variables are again printed to the terminal when loading the dataset.</p>
<h2>Particle csv files</h2>
<p>Loading particle ensemble csv (comma-separated-value) files uses the class <code>read.ensemble()</code>. To load the file <code>data_ensemble000015.csv</code>, one can do </p><pre class="fragment">offset=15
ds = read.ensemble(offset, file='data', npayload=1)
</pre><p> In this case, <code>offset</code> is zero padded to six digits. The argument <code>npayload</code> stands for the number of payload arrays in the data (default is one).</p>
<h2>Slice csv files</h2>
<p>To load a 1D slice in <code>.csv</code> format from a 2D simulation, you can use </p><pre class="fragment">offset=15
ds = read.loadcsv(offset, file='data', dir=1, coord=0.)
</pre><p> which loads in <code>data_d1_x+0.00D00_n0015.csv</code>. The argument <code>offset</code> refers to the last 4 digits of the filename, the argument <code>coord</code> translates to <code>0.00D00</code> and <code>dir=1</code> refers to the <code>d1</code> part of the filename (setting <code>dir=2</code> would mean <code>data_d2_x...</code>).</p>
<h1><a class="anchor" id="plotting_vtk"></a>
Plotting data</h1>
<h2>1D plotting</h2>
<p>Once the data is loaded into the instance <code>ds</code>, you can access it with <code>ds.varname</code> where <code>varname</code> is a variable name chosen in your AMRVAC parameter-file. Pythons powerful introspection makes it really easy to see what is available in the data: just type <code>ds.</code> and hit the <em>tab</em> key to see the available variable names.</p>
<p>For uniform data (<code>.vti</code>), the arithmetic centre of the cells can be obtained via the command </p><pre class="fragment">ds.getCenterPoints()
</pre><p> Hence, a simple 1D plot can be created using matplotlib by doing </p><pre class="fragment">import matplotlib.pyplot as plt
plt.plot(ds.getCenterPoints(), ds.rho)
plt.show()
</pre><p> At this point, <code>ds.getCenterPoints()</code> and <code>ds.rho</code> are simple Numpy arrays, so you can use all of matplotlib for your plotting experience.</p>
<p>For the structured <code>.vti</code> files, the attribute <code>ds.x</code> (or <code>.y</code> or <code>.z</code>) denotes the cell centre coordinate, such that a plot can be obtained with </p><pre class="fragment">import matplotlib.pyplot as plt
plt.plot(ds.x, ds.rho)
plt.show()
</pre> <h2>2D plotting</h2>
<p>The plotting of two-dimensional AMR data is also supported. These plotting tools come in two flavours:</p><ol type="1">
<li>The class <code>amrplot.polyplot</code> to show each cell in one patch</li>
<li>The class <code>amrplot.rgplot</code> to show data interpolated onto a uniform mesh</li>
</ol>
<p>Both classes offer the same functionality. In order to display a 2D image of the dataset <code>ds</code>, invoke a new instance </p><pre class="fragment">p1 = amrplot.polyplot(ds.rho, ds)
</pre><p> This will open a new window, containing a plot of the requested data. Drawing the window for the first time might take a few seconds, as a list of the cell patches has to be generated. If all of this is done in interactive mode another quantity can be plotted using the same window (for example the temperature) with the command </p><pre class="fragment">p1.show(ds.p/ds.rho, ds)
</pre><p> The class <code>amrplot.polyplot</code> has several convenient members. One example is <code>amrplot.polyplot.save</code>, which saves the image to a file and takes the filename as parameter. The axis ranges can be fixed with the attributes <code>p1.xrange</code> and <code>p1.yrange</code>, while the window zoom can be controlled by setting <code>p1.fixzoom</code> to a value other than <code>None</code>. Additionally there is a nice interactive feature when using <code>amrplot.polyplot</code>: if the middle mouse button is clicked to mark a cell in the plotting window, a pink crosshair will be displayed and all variables at the chosen location will be returned to the terminal. This may take a few seconds the first time this feature is executed, as the centerpoints must be calculated first.</p>
<h1><a class="anchor" id="vtk_auxiliary"></a>
Convenient auxiliary functions</h1>
<p>The class <code>amrplot</code> has some additional auxiliary functions which can be quite useful:</p><ul>
<li><code>amrplot.line</code>: selects variables over a straight path across a 2D slice</li>
<li><code>amrplot.velovect</code>: provides velocity vectors for a flow field</li>
<li><code>amrplot.contour</code>: overlays contours onto the plotting window</li>
<li><code>amrplot.streamlines</code>: shows streamlines of a vector field</li>
<li><code>amrplot.streamline</code>: plots a single streamline with given starting values</li>
</ul>
<p>See the respective methods and classes in <code>vtkfiles/amrplot</code> for more information. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
