<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MPI-AMRVAC: Slice output</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MPI-AMRVAC
   &#160;<span id="projectnumber">3.0</span>
   </div>
   <div id="projectbrief">The MPI - Adaptive Mesh Refinement - Versatile Advection Code</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Slice output </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Introduction</h1>
<p>To alleviate the disk space requirements and overhead of full snapshot output, it is possible to write hypersurfaces at their own (short) intervals. Currently, these slices are aligned with the grid, with the benefit that only a sub-space of the forest has to be traversed to obtain a Morton ordered AMR- aware subgrid. The slice output is useful especially in expensive 3D simulations in cartesian geometry, but gives valid output for any dimension and geometry. The output is composed of the grid cells closest to the specified subdimensional plane and thus reflects non-interpolated simulation variables which can be handy for debugging purposes.</p>
<h2>Setup in par file</h2>
<p>D-1 dimensional slices are the third file format with output intervals that can be specified in the <em>savelist</em> section of the par file. To give an example, here we specify three slices, where the first is perpendicular to the first coordinate direction <em>slicedir(1)=1</em> and intersects the first axis at a value of 0.6 <em>slicecoord(1)=0.6</em>. The second plane is parametrized perpendicular to the third coordinate direction <em>slicedir(2)=3</em> and intersects the third axis at a value of 0.8 <em>slicecoord(2)=0.8</em> and analoge for the third slice. </p><pre class="fragment"> &amp;savelist;
        itsave(1,3)=0
        dtsave(3)=0.1d0
        nslices=3
        slicedir(1)=1
        slicecoord(1)=0.6
        slicedir(2)=3
        slicecoord(2)=0.8
        slicedir(3)=2
        slicecoord(3)=0.7
/
</pre><p> The total number of slices is specified by <em>nslices</em>. The data type of the slices is set by <em>slice_type</em> in <em>filelist</em>, which by default is 'vtuCC' in ascii form. if <em>slice_type='dat'</em>, the implementation obtains a properly Morton ordered subdimensional forest with the same levels as the original simulation, such that the output .dat file can be used for restarts in lower dimension. User also has the option 'csv' to obtain comma-separated-value *.csv files of the cell-center variables. This can be useful especially for 2D simulations (1D line output) which can then be simply visualized using e.g. gnuplot. For 1D simulations, the code will always write a single *.csv file and append the point data together with the output time. The file then reads <em>base_filename-d1-x.600.csv</em> in the example above. For a quick look, the *.csv files can be imported in Paraview and be visualized as points using the filter <em>Table to Points</em>. The output filename is composed of the direction and offset values. For example, the first slice output name reads <em>filenameout-d1-x.600-nXXXX.vtu</em> and analoge for the other two slices. Note, that the order of the (reduced) dimensions in the resulting output files is preserved, e.g. the third slice in the example above will hold the x-direction as first coordinate and the z-direction as second coordinate. If you restart from a snapshot and continue the run with slicing, please choose the next file number <em>x</em> by <em>slicenext=x</em> in <em>filelist</em> to get continuous the file number of slices, otherwise it will start from 0 again overwriting old files.</p>
<h2>Slicing of existing output</h2>
<p>To slice existing *.dat files, the simulation can be restarted from a given output time and the code can be brought to a halt after zero iterations. This is done in the following way: its best to create a new *.par file (e.g. slices.par) and clear the savelist from any output to filetypes other than <em>3</em>. We use itsave to demand a slice output for the zero-iteration. </p><pre class="fragment"> &amp;savelist;
        itsave(1,3)=0
        nslices=3
        slicedir(1)=1
        slicecoord(1)=0.6
        slicedir(2)=3
        slicecoord(2)=0.8
        slicedir(3)=2
        slicecoord(3)=0.7
/
</pre><p> The stoplist should look like the following, </p><pre class="fragment"> &amp;stoplist;
        reset_it=.true.
        it_max=0
/
</pre><p> where we reset the iteration counter (so that <em>itsave(1,3)=0</em> will output slice data) and stop the code immediately after the IO by set <em>it_max=0</em>.</p>
<p>The code can then be started with </p><pre class="fragment">amrvac -i slices.par -slice 10 -if datamr/data0010.dat
</pre><p> which will take the output <em>datamr/data0010.dat</em> to create new slices with index 10 (-slice 10). The par-file is the newly created slices.par (-i slices.par) so that the default used to run the code can be left untouched. It is a simple exercise in shell scripting to run along all output-files in one go. For example with the BASH: </p><pre class="fragment">for i in {0..10}; do printf -v j "%04d" $i; ./amrvac -i slices.par -slice $i -if datamr/data$j.dat; done
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
