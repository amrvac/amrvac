<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MPI-AMRVAC: Physics modules and equations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MPI-AMRVAC<span id="projectnumber">&#160;3.1</span>
   </div>
   <div id="projectbrief">The MPI - Adaptive Mesh Refinement - Versatile Advection Code</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Physics modules and equations</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="eq_list_physics"></a>
List of physics modules</h1>
<p>This document describes the equations implemented. Information about user defined source terms are in <a class="el" href="md_doc_2amrvacusr.html">user module</a>. In principle, the code handles anything of generic form</p>
<div class="image">
<img src="eq.general.gif" alt=""/>
</div>
    <p>The code is configured to use the specified set of equations by activating it in the usr_init subroutine of user module "mod_usr.t" </p><pre class="fragment">subroutine usr_init()
  ...
  call EQUATION_activate()
end subroutine usr_init
</pre><p>where EQUATION is one of the implemented physics modules (rho,hd,mhd), see below.</p>
<h2><a class="anchor" id="eq_rho"></a>
Transport Equation: rho</h2>
<pre class="fragment">call rho_activate()
</pre><p> <img src="eq.rho.gif" alt="" class="inline"/>    </p>
<p>The transport equation describes the transport of a scalar field, here the density <b>rho</b> by a prescribed velocity field. This equation is used for test purposes.</p>
<p>The parameters rho_v in the rho_list of amrvac.par file define the components of the uniform velocity field.</p>
<p>For a linear scalar equation the Riemann solver is trivial, thus all TVD type methods give identical results.</p>
<h2><a class="anchor" id="eq_nonlinear"></a>
Scalar Nonlinear Equation: nonlinear</h2>
<pre class="fragment">call nonlinear_activate()
</pre><p> This module contains various instances of a scalar nonlinear equation, including the inviscid Burgers, inviscid nonconvex equation, as well as a possibility to handle the Korteweg-de Vries equation. It allows testing of truly nonlinear (shock steepening and formation) phenomena, in 1D to multi-D, or to test how source additions are best combined with flux prescriptions and discretizations. The equation implemented in \(N_d\) dimensions is </p><pre class="fragment">\f$  \frac{\partial \rho}{\partial t} + \nabla \cdot \mathbf{F}(\rho,\mathbf{x},t) = -\delta^2 \sum_{i=1}^{N_d} \frac{\partial^3 \rho}{\partial x_i^3} \f$
</pre><p> where the RHS is activated through the <em><a class="el" href="mod__kdv_8t.html">mod_kdv.t</a></em> module. The actual flux expression can be chosen (depending on the parameter <code>nonlinear_flux_type</code>) to be one of \(   \mathbf{F}^{\mathrm{burgers}}  =  \frac{1}{2}{\rho^2}\mathbf{v}_0  \) or \(  \mathbf{F}^{\mathrm{nonconvex}}  =  {\rho^3}\mathbf{v}_0 \) where we introduced \(\mathbf{v}_0=\sum_{i=1}^{N_d} \hat{\mathbf{e}}_i\)</p>
<h2><a class="anchor" id="eq_hd"></a>
Hydrodynamics: hd</h2>
<pre class="fragment">call hd_activate()
</pre><p> <img src="eq.hd.gif" alt="" class="inline"/>    </p>
<p>The Euler equations are solved for density <b>rho</b>, the momentum density <b>m=rho*v</b> and the total energy density <b>e</b>. The pressure is a derived quantity which is calculated from the conservative variables.</p>
<p>Parameters of hydrodynamics are read in the <b>hd_list</b> of parameter file. There is a single equation parameter, the adiabatic index <b>hd_gamma</b> (typical value is 5/3).</p>
<p>This equation module can be combined with physical sources for (local) optically thin radiative losses by set <b>hd_radiative_cooling=.true.</b>. see the <a class="el" href="md_doc_2radiative__cooling.html">radiative cooling</a> page. Schematically, it introduces terms as</p>
<div class="image">
<img src="eq.radloss.gif" alt=""/>
</div>
    <p>The HD module can also be combined with the external gravity module (<em><a class="el" href="mod__gravity_8t.html">src/physics/mod_gravity.t</a></em>) for uniform gravity by set <b>hd_gravity=.true.</b></p>
<div class="image">
<img src="eq.gravity.gif" alt=""/>
</div>
    <p>and for point gravity</p>
<div class="image">
<img src="eq.pointgrav.gif" alt=""/>
</div>
    <p>Note how the gravitational constant and the non-dimensionalization is taken into the parameters <em>M_point</em> and its location <em>x_point</em>.</p>
<p>To do adiabatic hydrodynamics (i.e. solve the hydro set without energy equation added) just add in hd_list of parameter file </p><pre class="fragment">hd_energy=.false.
</pre><p> This special case includes the equations for pressureless dust and the Shallow Water equations, and writes generally as</p>
<div class="image">
<img src="eq.hdadiab.gif" alt=""/>
</div>
    <p>The system of adiabatic hydrodynamical equations are solved for the density <b>rho</b> and the momentum density <b>m=rho*v</b>. The pressure is a function of density only since an isentropic initial condition is assumed. There are two equation parameters, the adiabatic index <b>hd_gamma</b> (the isothermal case corresponds to <b>hd_gamma</b>) and the adiabatic constant <b>hd_adiab</b> (which should be positive or zero). It is possible to set <b>hd_adiab=0</b> and handle the case of pressureless dust.</p>
<p>The system of <b>shallow water equations</b> is a special case with the following identifications: <b>rho=h</b> represents the height of the water column, <b>hd_gamma2</b> and the adiabatic coefficient is half of the gravitational acceleration <b>hd_adiab=g/2</b>.</p>
<p>There is a Roe-type Riemann solver implemented, in <em><a class="el" href="mod__hd__roe_8t.html">hd/mod_hd_roe.t</a></em>. Several routines specific to HLLC are in <em><a class="el" href="mod__hd__hllc_8t.html">hd/mod_hd_hllc.t</a></em>.</p>
<h2><a class="anchor" id="eq_mhd"></a>
Magnetohydrodynamics: mhd</h2>
<pre class="fragment">call mhd_activate()
</pre><p> <img src="eq.mhd.gif" alt="" class="inline"/>    </p>
<p>This is the full system of the MHD equations, with the following conservative variables: density <b>rho</b>, momentum density <b>m=rho*v</b>, total energy density <b>e</b> and the magnetic field <b>B</b>. The magnetic field is measured in units for which the magnetic permeability is 1.</p>
<p>Parameters of magnetohydrodynamics are read in the <b>mhd_list</b> of parameter file. The source terms on the right hand side with <b>eta</b> in them are the resistive terms.</p>
<p>There are three equation parameters: the polytropic index <b>mhd_gamma</b> (which must be larger or equal to 1), and the resistivity <b>mhd_eta</b>, and the entropy <b>mhd_adiab</b>. Ideal MHD corresponds to <b>mhd_eta=0</b>, positive values give a uniform resistivity, while a negative value calls the <b>specialeta</b> procedure to determine the resistivity as a function of the coordinates, of the conservative variables, and/or of the current density. This subroutine is to be completed by the user.</p>
<p>There is a Roe-type Riemann solver implemented using arithmetic averaging, in <em><a class="el" href="mod__mhd__roe_8t.html">mhd/mod_mhd_roe.t</a></em>, while several routines specific to HLLC are in <em><a class="el" href="mod__mhd__hllc_8t.html">mhd/mod_mhd_hllc.t</a></em>.</p>
<p>This equation module can be combined with physical sources for (local) optically thin <a class="el" href="md_doc_2radiative__cooling.html">radiative losses</a> by set <b>mhd_radiative_cooling=.true.</b>. It can also be combined with the external gravity modules by set <b>mhd_gravity=.true.</b>.</p>
<p>We also have implemented the magnetic field splitting strategy, where a static, background magnetic field is assumed. This modifies the equations and brings in extra sources and flux terms.</p>
<p>To run isothermal magnetohydrodynamics, add in mhd_list of parameter file </p><pre class="fragment">mhd_energy=.false.
</pre><p> <img src="eq.mhdiso.gif" alt="" class="inline"/>    </p>
<p>This is the system of the MHD equations without the full energy equation, and with the following conservative variables: density <b>rho</b>, momentum density <b>m=rho*v</b>, and the magnetic field <b>B</b>. The magnetic field is measured in units for which the magnetic permeability is 1. The density pressure relation is polytropic.</p>
<h1><a class="anchor" id="eq_divB_fix"></a>
Divergence B source treatments</h1>
<p>Both the classical and the special relativistic MHD module can deal with solenoidal magnetic field corrections through source term treatments. Traditionally, these can be written as</p>
<div class="image">
<img src="eq.divb.gif" alt=""/>
</div>
    <p>Terms proportional to <b>div B</b> are <a class="el" href="md_doc_2methods.html">Powell`s fix</a> for the numerical problems related to the divergence of the magnetic field. They are used only in more than 1D. We can also just take the term along in the induction equation, known as Janhunen<code>s approach. Another option is to use the diffusive (parabolic) approach, with the parameter _C_d_ of order unity (up to 2). Alternatively, there is the [Dedner</code>s](<a class="el" href="methods_8md.html">methods.md</a>) generalised Lagrange multiplier (GLM) method.</p>
<h1><a class="anchor" id="eq_positivity_fixes"></a>
Positivity fixes</h1>
<p>Another, similarly corrective, action is referred to as positivity fixing. This is merely an additional means to handle the supposedly rare instances where due to all nonlinearities of the scheme employed, the local conservative to primitive transformation signals a non-physical state. Our positivity fix approach can then be activated, and one such strategy operates as follows: identify all cells (within the same grid block) that represent physical states surrounding a faulty cell in a rectangular zone up to <b>small_values_daverage</b> cells away; (2) convert those cells to primitive variables; and (3) for all but the magnetic field components, replace the faulty cell values by the average of surrounding physical state cells. Finally, revert to conservative variables where needed. Obviously, in this form, strict conservation may be violated. These fix strategies are seperated off in the <em><a class="el" href="namespacemod__small__values.html" title="Module for handling problematic values in simulations, such as negative pressures.">mod_small_values</a></em> modules. They are by default inactive, and can be controlled by the parameters <b>small_values_method</b> and other related parameters described in <a class="el" href="md_doc_2par.html">par/PROBLEM</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
