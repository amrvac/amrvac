<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MPI-AMRVAC: Numerical methods</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MPI-AMRVAC<span id="projectnumber">&#160;3.1</span>
   </div>
   <div id="projectbrief">The MPI - Adaptive Mesh Refinement - Versatile Advection Code</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Numerical methods</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document briefly describes the features of the spatial discretizations available in MPI-AMRVAC. The different options can be set in the <a class="el" href="md_doc_2par.html#par_methodlist">methodlist</a> of the input par file. For a more extensive description, you can read the article <a href="http://www-personal.umich.edu/~gtoth/Papers/vac.html">Comparison of some FCT and TVD Schemes</a>. Also, the paper using MPI-AMRVAC has info on the various methods, see 'Parallel, grid- adaptive approaches for relativistic hydro and magnetohydrodynamics', R. Keppens, Z. Meliani, A.J. van Marle, P. Delmont, A. Vlasis, &amp; B. van der Holst, 2011, JCP. <a href="http://dx.doi.org/10.1016/j.jcp.2011.01.020">doi:10.1016/j.jcp.2011.01.020</a>. A more recent update is 'MPI-AMRVAC FOR SOLAR AND ASTROPHYSICS', O. Porth, C. Xia, T. Hendrix, S. P. Moschou and R. Keppens ApJS. <a href="http://dx.doi.org/10.1088/0067-0049/214/1/4">doi:10.1088/0067-0049/214/1/4</a>.</p>
<p>The acronyms TVD, TVDLF, and TVD-MUSCL stand for Total Variation Diminishing, TVD Lax-Friedrich, and TVD Monotonic Upwind Scheme for Conservation Laws, respectively. Then, depending on the physics module selected, you also have HLL, HLLC, and HLLD schemes, which are due to harten Lax, van Leer, with the HLLC variant including a treatment for the Contact discontinuity, as e.g. described for Euler gas dynamics in <em>E.F. Toro, Riemann solvers and numerical methods for fluid dynamics (Berlin, Springer-Verlag, 1997)</em>, and with the HLLD variant for MHD including multiple discontinuities, which was invented by Miyoshi and Kusano in <em>Journal of Computational Physics, 208, 315-344 (2005)</em>.</p>
<p>Not all methods are available or meaningfull for all physics modules. In fact, we have the following combinations typically: </p><pre class="fragment">Physics   Schemes
--------------------------------------------------------------------------
rho       TVDLF, HLL, HLLC, TVD (Roe solver), TVDMU (Roe solver), FD
HD        TVDLF, HLL, HLLC, TVD (Roe solver), TVDMU (Roe solver), FD
MHD       TVDLF, HLL, HLLD, TVD (Roe solver), TVDMU (Roe solver), FD
</pre><p> Also, the method can be selected per AMR grid level, but one can not combine different stepsize methods (hence, TVD is the only second order onestep method, while all others can be used with all steps time stepper/integrator setting). In MPI-AMRVAC, the <b>flux_scheme</b> is thus an array of strings, one string per level up to <b>nlevelshi</b>. Some more info follows on the various methods.</p>
<h1>HLL HLLC and HLLD schemes</h1>
<p>The TVDLF scheme hence uses minimal info on the wave speeds, and in combination with AMR and its inherent robustness due to its diffusive nature, it is readily usable for any system of conservation laws at minimal implementation costs. But TVDLF maybe too diffusive to resolve details in your applications. Maximal wave speed info is used in a full Roe-type approximate Riemann solver as employed by TVD or TVD-MUSCL, where all characteristic wave speeds (7 in total for (relativistic) MHD) as well as the wave strengths are deduced from the eigenvalues, as well as right and left eigenvector pairs of the flux Jacobian. However, TVD or TVD-MUSCL is limited to second-order accuracy and not the most efficient one. The simpler HLL, HLLC, and HLLD solvers, make further approximations to their corresponding representation of the Riemann fan, as schematically illustrated below.<img src="solvers.gif" alt="" class="inline"/>    </p>
<p>In these approximate Riemann solvers, the HLL is available for all physics modules but the most diffusive one. The HLLC is designed for HD physics and gives unreliable results for MHD. The HLLD works only for MHD and gives the best resolution with higher efficiency than Roe solver.</p>
<h1>TVDLF Scheme</h1>
<p>The TVD Lax-Friedrich method is robust, in most cases there are no spurious oscillations, but it is somewhat more diffusive than HLL, HLLC, HLLD or TVD methods. Since it does not use a Riemann solver, it is the fastest. The Courant number should be less than 1, <b>courantpar=0.8</b> is recommended. Second order time discretization is best achieved by a Hancock predictor step, so the corresponding <b>typepred1='hancock'</b>. TVDLF can be used with <b>dimsplit=F</b>, it is also preferred for steady state calculations. The second order TVDLF scheme <b>flux_scheme='tvdlf'</b> uses limiters. There are many choices available: the 'minmod' limiter gives the smoothest result, the 'woodward' limiter is sharper, and the 'superbee' limiter is probably too sharp. The **'woodward'** limiter is recommended, but note that the default is the most robust <b>limiter='minmod'</b>. The various options can be found in the <code><a class="el" href="mod__finite__volume_8t.html">mod_finite_volume.t</a></code> module, in the subroutine <code>dwlimiter2</code>. The slope limiting is performed on the primitive variables. You can even employ limiting on logarithmically stretched variables (which should be positive, like a density or pressure), by setting the <code>loglimit</code> flags. You can also use third order accurate <b>limiter='ppm'</b>, but the code will run with a wider ghost cell region, namely <b>nghostcells=4</b>. A third order limiter **'cada3'** (also known as LIMO3) only needs <b>nghostcells=2</b> ghost cell layers .</p>
<h1>TVD-MUSCL Scheme</h1>
<p>The TVD-MUSCL scheme <b>flux_scheme='tvdmu'</b> is a two-step TVD algorithm using the same Hancock predictor step and upwinding as TVDLF, and a characteristic based Riemann solver similar to the TVD method. At the moment Riemann solvers are implemented for adiabatic hydrodynamics, hydrodynamics, and full MHD. The scalar transport equation has a trivial Riemann solver. The scheme has comparable resolution to the non-MUSCL TVD method. The Courant number should be less than 1, <b>courantpar=0.8</b> is recommended. TVD-MUSCL can be dimensionally split <b>dimsplit=T</b> or unsplit <b>dimsplit=F</b>. The multistep Runge-Kutta schemes can be applied, such as <b>time_stepper='fourstep'</b> with <b>time_integrator='rk4'</b>. Linear Riemann solvers can produce non-physical solutions. This can be eliminated by the use of an entropy fix, controlled by <b>typeentropy</b> and the <b>entropycoef</b>. The default is <b>typeentropy='nul'</b>. See the details for the entropy fixes in the respective <code>mod_PHYS_roe.t</code> files, as well as in the <code><a class="el" href="mod__tvd_8t.html">mod_tvd.t</a></code> module.</p>
<h1>TVD Scheme</h1>
<p>The non-MUSCL TVD method <b>flux_scheme='tvd'</b> with Roe approximate Riemann solver is one of the most accurate and efficient of the implemented schemes. There are a few variants of the TVD scheme, but the default is <b>typetvd='roe'</b>. Details are in the <code><a class="el" href="mod__tvd_8t.html">mod_tvd.t</a></code> module. This solver has to be dimensionally split, set <b>dimsplit=T</b>. The Courant number should be less than 1, <b>courantpar=0.8</b> is recommended. The same limiters can be used as for TVDLF and TVD MUSCL, but they are applied to the characteristic waves, rather than to the primitive variables. The order of the characteristic waves is defined in the <b>mod_PHYS_roe.t</b> files. The **'woodward'** limiter is recommended, but note that the default is **'minmod'**. The entropy fix for the Riemann solver is given by the <b>typeentropy</b> array, it has the same meaning as for the TVD-MUSCL method, and for MHD, the divergence B problem should also be taken care of.</p>
<h1>2nd Order Central Difference Scheme</h1>
<p>The explicit central differencing schemes are not stable by themselves for advection dominated problems. The second order central difference scheme ('cd') is used by the TVD scheme before the limiting is applied. Otherwise it is useful for testing a few time steps, since this scheme contains no artificial fluxes, thus comparison with analytic formulae is straightforward. It is straightforward to generalize this central difference approach to higher order accuracy, at the expense of introducing a wider stencil.</p>
<h1>High order finite difference FD Scheme</h1>
<p>This scheme <b>flux_scheme='fd'</b> implements conservative finite differences with global Lax-Friedrich flux splitting. It can be used with almost all limiters (exluding ppm) and yields high order accuracy in space. For second, third and fifth order reconstruction you can set e.g.: <b>limiter='koren'/'cada3'/'mp5'</b>.</p>
<h1>Maintaining the div B=0 Condition</h1>
<p>In multidimensional MHD the numerical conservation of divergence of magnetic field div B is not guaranteed by the standard TVD or HLL type schemes. This can lead to inaccuracies as well as instablilities. For all the schemes below, you can influence how to compute div B, by setting <b>typegrad</b> and <b>typediv</b>, along with <b>gradient_limiter</b>. This allows to select either a standard central difference evaluation, or one evaluated after the cell-center values have been reconstructed to the cell edges. User can select one of the following methods by select <b>typedivbfix</b> and related parameters in <code>mhd_list</code> of par file.</p>
<h3>constrained transport fix: typedivbfix='ct'</h3>
<p>The upwind constrained transport (CT) method by Gardiner and Stone in <em>Journal of Computational Physics, 205, 509-539 (2005)</em>, <b>type_ct='uct_contact'</b> (default), or by Del Zanna, L., Zanotti, O., Bucciantini, N., &amp; Londrillo, P. in <em>Astronomy &amp; Astrophysics , 473, 11 (2007)</em> <b>type_ct='uct_hll'</b>, using staggered grid for magnetic field, can preserve initial div B to round off errors. A simple non-upwinding version of ct is through averaging electric fields from neighbors <b>type_ct='average'</b>. It only works with HLL and HLLD Riemann flux schemes in the current implementation. It works in Cartesian and non-Cartesian coordinates with or without grid stretching. It works with finite non-zero resistivity. Initial conditions and boundary conditions for magnetic field have to be given at corresponding cell faces instead, or vector potential is given at corresponding cell edges, see examples: <b>tests/mhd/solar_atmosphere_2.5D</b>. Note that when using AMR, the div B preserving prolongation for CT requires even number of ghost cell layers and odd number of ghost layers for some slope limiters, e.g. mp5, is added by one to become even.</p>
<h3>Powell fix: typedivbfix='powel'</h3>
<p>For multidimensional MHD calculations the non-conservative form of the <a class="el" href="md_doc_2equations.html#eq_mhd">MHD</a>equations" seems to produce better results than the usual
conservative form. The idea is to include source terms proportional to div B
into the momentum, energy and induction equations and to add a divergence wave
for the Riemann solver.
Powell scheme is fast, it stabilizes the Riemann solver, and improves
results for TVDLF and similar type methods, but it is non-conservative, and
div B is not kept close to zero. 

&lt;h3&gt;Janhunen fix: typedivbfix='janhunen'&lt;/h3&gt;

Source term in Powell fix is only added to the induction equation. This approach
is usable for both classical and relativistic MHD.

&lt;h3&gt;Diffusive fix: typedivbfix='linde'&lt;/h3&gt;

You can also use the diffusive (parabolic) approach, see the
@ref par_divbfix "equations". It uses a <code>C_d</code> coefficient quantified by <code>divbdiff</code>, which can be up to 2. This method is by default inactive, identified by <code>divbdiff=1</code>, but it is recommended for many multi-D MHD applications.</p>
<h3>Dedner fix: typedivbfix='glm'</h3>
<p>This implements the mixed hyperbolic propagating and parabolic dampening of divB using an additional scalar variable <em>psi</em>. The algorithm of 'glm' is described by Dedner et al. as <em>Equation (24)</em> in <em>Journal of Computational Physics 175, 645-673 (2002) doi:10.1006/jcph.2001.6961</em>.</p>
<h3>projection fix: typedivbfix='multigrid'</h3>
<p>Projection scheme using multigrid Poisson solver by Teunissen and Keppens in <em>Computer Physics Communications 245, 1068, (2019)</em> can be use to remove div B part of B.</p>
<h3>Combined fix: typedivbfix='lindejanhunen' or 'lindepowel'</h3>
<p>Combining diffusive fix and Janhunen or Powell fix by add both source terms of these methods at the same time. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
