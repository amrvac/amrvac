<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MPI-AMRVAC: src/io/mod_input_output.t Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="my_customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MPI-AMRVAC
   &#160;<span id="projectnumber">3.1</span>
   </div>
   <div id="projectbrief">The MPI - Adaptive Mesh Refinement - Versatile Advection Code</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_c184e51c84f2c3f0345bbc8a0d75d3e1.html">io</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">mod_input_output.t</div>  </div>
</div><!--header-->
<div class="contents">
<a href="mod__input__output_8t.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">!&gt; Module for reading input and writing output</span></div>
<div class="line"><a name="l00002"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html">    2</a></span>&#160;<span class="keyword">module</span> <a class="code" href="namespacemod__input__output.html">mod_input_output</a></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacemod__comm__lib.html">mod_comm_lib</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__comm__lib.html#a9b6f1a8fd13bc5670e3b426151c34048">mpistop</a></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160; </div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  <span class="keywordtype">public</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; </div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">  !&gt; List of compatible versions</span></div>
<div class="line"><a name="l00010"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#af6450e39c0d1c69b17bbbb5db487231a">   10</a></span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="namespacemod__input__output.html#af6450e39c0d1c69b17bbbb5db487231a">compatible_versions</a>(3) = [3, 4, 5]</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">  !&gt; number of w found in dat files</span></div>
<div class="line"><a name="l00013"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">   13</a></span>&#160;  <span class="keywordtype">integer</span> :: <a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">  !&gt; tag for MPI message</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">private</span> :: itag</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">  !&gt; coefficient for rk2_alfa</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  <span class="keywordtype">double precision</span>, <span class="keywordtype">private</span> :: rk2_alfa</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">  !&gt; whether staggered field is in dat</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">private</span> :: stagger_mark_dat=.false.</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <span class="comment">! Formats used in output</span></div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#a5a4c8ad20085895e6afea0b6da413313">   26</a></span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="namespacemod__input__output.html#a5a4c8ad20085895e6afea0b6da413313">fmt_r</a>  = <span class="stringliteral">&#39;es16.8&#39;</span> <span class="comment">! Default precision</span></div>
<div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#ab0092e81ef07b5ca84ceddacc7c4d9f9">   27</a></span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="namespacemod__input__output.html#ab0092e81ef07b5ca84ceddacc7c4d9f9">fmt_r2</a> = <span class="stringliteral">&#39;es10.2&#39;</span> <span class="comment">! Two digits</span></div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#abd164abbe2712c03076283f266ae3d52">   28</a></span>&#160;  <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="namespacemod__input__output.html#abd164abbe2712c03076283f266ae3d52">fmt_i</a>  = <span class="stringliteral">&#39;i8&#39;</span>     <span class="comment">! Integer format</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="comment">! public methods</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  <span class="keywordtype">public</span> :: <a class="code" href="namespacemod__input__output.html#acd293c80fe4dffe68b3bd5af075cc137">snapshot_write_header</a>  </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keyword">contains</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">  !&gt; Read the command line arguments passed to amrvac</span></div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#a98a1cccd22f5c9aebc79667b1b469161">   36</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#a98a1cccd22f5c9aebc79667b1b469161">read_arguments</a>()</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__slice.html">mod_slice</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">slicenext</a></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keywordtype">integer</span>                          :: len, stat, n, i, ipars</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>               :: max_files = 20 <span class="comment">! Maximum number of par files</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordtype">integer</span>                          :: n_par_files</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordtype">character(len=max_files*std_len)</span> :: all_par_files</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordtype">character(len=std_len)</span>           :: tmp_files(max_files), arg</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordtype">logical</span>                          :: unknown_arg, help, morepars</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a> == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;       print *, <span class="stringliteral">&#39;-----------------------------------------------------------------------------&#39;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;       print *, <span class="stringliteral">&#39;-----------------------------------------------------------------------------&#39;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;       print *, <span class="stringliteral">&#39;|         __  __ ____ ___        _    __  __ ______     ___    ____         |&#39;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;       print *, <span class="stringliteral">&#39;|        |  \/  |  _ \_ _|      / \  |  \/  |  _ \ \   / / \  / ___|        |&#39;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;       print *, <span class="stringliteral">&#39;|        | |\/| | |_) | |_____ / _ \ | |\/| | |_) \ \ / / _ \| |            |&#39;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;       print *, <span class="stringliteral">&#39;|        | |  | |  __/| |_____/ ___ \| |  | |  _ &lt; \ V / ___ \ |___         |&#39;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;       print *, <span class="stringliteral">&#39;|        |_|  |_|_|  |___|   /_/   \_\_|  |_|_| \_\ \_/_/   \_\____|        |&#39;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;       print *, <span class="stringliteral">&#39;-----------------------------------------------------------------------------&#39;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;       print *, <span class="stringliteral">&#39;-----------------------------------------------------------------------------&#39;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">! =============== Fortran 2003 command line reading ================</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160; </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">! Default command line arguments</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    all_par_files=<span class="stringliteral">&quot;amrvac.par&quot;</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a99b70d54ff2f08fb179495e2a07d1e44">restart_from_file</a>=<a class="code" href="namespacemod__global__parameters.html#aba6bd3b8579dde6b7c68f65ab628a049">undefined</a></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a>=-1</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">slicenext</a>=-1</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ae5c84337d8ace067e3744f286305044c">collapsenext</a>=-1</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    help=.false.</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#abeaadf7ca515b0a99e6e1e326d88e4f7">convert</a>=.false.</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a2bb0b481a238e6de804ec476a9cc0f2f">resume_previous_run</a>=.false.</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">! Argument 0 is program name, so we start from one</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    i = 1</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    unknown_arg=.false.</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">DO</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;       <span class="keyword">CALL </span>get_command_argument(i, arg)</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;       <span class="keywordflow">IF</span> (len_trim(arg) == 0) <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;       <span class="keywordflow">select case</span>(arg)</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;         <span class="keywordflow">case</span>(<span class="stringliteral">&quot;-i&quot;</span>)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;           i = i+1</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;           <span class="keyword">CALL </span>get_command_argument(i, arg)</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;           <span class="comment">!if(mype==0)print *,&#39;found argument=&#39;,arg</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;           all_par_files=trim(arg)</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;           morepars=.true.</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;           ipars=1</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;           <span class="keywordflow">do</span> <span class="keywordflow">while</span> (ipars&lt;max_files.and.morepars)</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;              <span class="keyword">CALL </span>get_command_argument(i+ipars,arg)</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;              <span class="comment">!if(mype==0)print *,&#39;found argument=&#39;,arg</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;              <span class="keywordflow">if</span> (index(trim(arg),<span class="stringliteral">&quot;-&quot;</span>)==1.or.len_trim(arg)==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                 morepars=.false.</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                 ipars=ipars+1</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                 all_par_files=trim(all_par_files)//<span class="stringliteral">&quot; &quot;</span>//trim(arg)</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                 <span class="comment">!if(mype==0)print *,&#39;now all_par_files=&#39;,TRIM(all_par_files)</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="keywordflow">              endif</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="keywordflow">           end do</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;           <span class="comment">!if(mype==0)print *,&#39;-i identified &#39;,ipars, &#39; par-file arguments&#39;</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;           i=i+ipars-1</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;           <span class="comment">!if(mype==0)print *,&#39;-i arguments passed to all_par_files=&#39;,TRIM(all_par_files)</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;         <span class="keywordflow">case</span>(<span class="stringliteral">&quot;-if&quot;</span>)</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;           i = i+1</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;           <span class="keyword">CALL </span>get_command_argument(i, arg)</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;           <a class="code" href="namespacemod__global__parameters.html#a99b70d54ff2f08fb179495e2a07d1e44">restart_from_file</a>=trim(arg)</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;           <span class="comment">!if(mype==0)print *,&#39;-if has argument=&#39;,TRIM(arg),&#39; passed to restart_from_file=&#39;,TRIM(restart_from_file)</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;         <span class="keywordflow">case</span>(<span class="stringliteral">&quot;-slicenext&quot;</span>)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;           i = i+1</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;           <span class="keyword">CALL </span>get_command_argument(i, arg)</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;           <span class="keyword">read</span>(arg,*,iostat=stat) <a class="code" href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">slicenext</a></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;           <span class="comment">!if(mype==0)print *,&#39;-slicenext has argument=&#39;,arg,&#39; passed to slicenext=&#39;,slicenext</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;         <span class="keywordflow">case</span>(<span class="stringliteral">&quot;-collapsenext&quot;</span>)</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;           i = i+1</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;           <span class="keyword">CALL </span>get_command_argument(i, arg)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;           <span class="keyword">read</span>(arg,*,iostat=stat) <a class="code" href="namespacemod__global__parameters.html#ae5c84337d8ace067e3744f286305044c">collapsenext</a></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;           <span class="comment">!if(mype==0)print *,&#39;-collapsenext has argument=&#39;,arg,&#39; passed to collapsenext=&#39;,collapsenext</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;         <span class="keywordflow">case</span>(<span class="stringliteral">&quot;-snapshotnext&quot;</span>)</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;           i = i+1</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;           <span class="keyword">CALL </span>get_command_argument(i, arg)</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;           <span class="keyword">read</span>(arg,*,iostat=stat) <a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;           <span class="comment">!if(mype==0)print *,&#39;-snapshotnext has argument=&#39;,arg,&#39; passed to snapshotnext=&#39;,snapshotnext</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;         <span class="keywordflow">case</span>(<span class="stringliteral">&quot;-resume&quot;</span>)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;           <a class="code" href="namespacemod__global__parameters.html#a2bb0b481a238e6de804ec476a9cc0f2f">resume_previous_run</a>=.true.</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;           <span class="comment">!if(mype==0)print *,&#39;resume specified: resume_previous_run=T&#39;</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;         <span class="keywordflow">case</span>(<span class="stringliteral">&quot;-convert&quot;</span>)</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;           <a class="code" href="namespacemod__global__parameters.html#abeaadf7ca515b0a99e6e1e326d88e4f7">convert</a>=.true.</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;           <span class="keywordflow">if</span>(<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>==0)print *,<span class="stringliteral">&#39;convert specified: convert=T&#39;</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;         <span class="keywordflow">case</span>(<span class="stringliteral">&quot;--help&quot;</span>,<span class="stringliteral">&quot;-help&quot;</span>)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;           help=.true.</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;           <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="keywordflow">         case default</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;           unknown_arg=.true.</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;           help=.true.</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;           <span class="keywordflow">EXIT</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="keywordflow">       end select</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;       i = i+1</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="keywordflow">    END DO</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">if</span> (unknown_arg) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;       print*,<span class="stringliteral">&quot;=======================================&quot;</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;       print*,<span class="stringliteral">&quot;Error: Command line argument &#39; &quot;</span>,trim(arg),<span class="stringliteral">&quot; &#39; not recognized&quot;</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;       print*,<span class="stringliteral">&quot;=======================================&quot;</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;       help=.true.</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">! Show the usage if the help flag was given, or no par file was specified</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">if</span> (help) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;       <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a> == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;          print *, <span class="stringliteral">&#39;Usage example:&#39;</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;          print *, <span class="stringliteral">&#39;mpirun -np 4 ./amrvac -i file.par [file2.par ...]&#39;</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;          print *, <span class="stringliteral">&#39;         (later .par files override earlier ones)&#39;</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;          print *, <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;          print *, <span class="stringliteral">&#39;Optional arguments:&#39;</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;          print *, <span class="stringliteral">&#39;-convert             Convert snapshot files&#39;</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;          print *, <span class="stringliteral">&#39;-if file0001.dat     Use this snapshot to restart from&#39;</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;          print *, <span class="stringliteral">&#39;                     (you can modify e.g. output names)&#39;</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;          print *, <span class="stringliteral">&#39;-resume              Automatically resume previous run&#39;</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;          print *, <span class="stringliteral">&#39;                     (useful for long runs on HPC systems)&#39;</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;          print *, <span class="stringliteral">&#39;-snapshotnext N      Manual index for next snapshot&#39;</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;          print *, <span class="stringliteral">&#39;-slicenext N         Manual index for next slice output&#39;</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;          print *, <span class="stringliteral">&#39;-collapsenext N      Manual index for next collapsed output&#39;</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;          print *, <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;       <span class="keyword">call </span>mpi_finalize(<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;       stop</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">! Split the input files, in case multiple were given</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacemod__input__output.html#ab2d0a28e065926627226ed89b96ada9d">get_fields_string</a>(all_par_files, <span class="stringliteral">&quot; ,&#39;&quot;</span><span class="stringliteral">&quot;&quot;</span>//char(9), max_files, &amp;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;         tmp_files, n_par_files)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#a551004039cf74031e6bf9e613eb24e64">par_files</a>(n_par_files))</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a551004039cf74031e6bf9e613eb24e64">par_files</a> = tmp_files(1:n_par_files)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#a98a1cccd22f5c9aebc79667b1b469161">read_arguments</a></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">  !&gt; Read in the user-supplied parameter-file</span></div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#a3d02333ce1529f982c89bf948cc871e7">  175</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#a3d02333ce1529f982c89bf948cc871e7">read_par_files</a>()</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__physics.html">mod_physics</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__physics.html#af51a72a2fd88d69c5745864770c06f93">phys_energy</a>, <a class="code" href="namespacemod__physics.html#a9c0b8a2dc10a59ca87e89eaa056929ad">physics_type</a>, <a class="code" href="namespacemod__physics.html#a95ed0d73188b963f6d662c2e6626fb1c">phys_wider_stencil</a></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__small__values.html">mod_small_values</a></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__limiter.html">mod_limiter</a></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__slice.html">mod_slice</a></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__geometry.html">mod_geometry</a></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__source.html">mod_source</a></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__input__output__helper.html">mod_input_output_helper</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__input__output__helper.html#ab75e38c0b0f267995e208c94854d9973">get_names_from_string</a></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordtype">logical</span>          :: fileopen, file_exists</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordtype">integer</span>          :: i, j, k, ifile, io_state</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordtype">integer</span>          :: iB, isave, iw, level, idim, islice</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keywordtype">integer</span>          :: nx_vec(^ND), block_nx_vec(^ND)</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordtype">integer</span>          :: my_unit, iostate</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordtype">integer</span>          :: ilev</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordtype">double precision</span> :: dx_vec(^ND)</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordtype">character</span>              :: c_ndim</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordtype">character(len=80)</span>      :: fmt_string</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordtype">character(len=std_len)</span> :: err_msg, restart_from_file_arg</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordtype">character(len=std_len)</span> :: basename_full, basename_prev, dummy_file</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordtype">character(len=std_len)</span>, <span class="keywordtype">dimension(:)</span>, <span class="keywordtype">allocatable</span> :: &amp;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;         typeboundary_min^D, typeboundary_max^D</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordtype">character(len=std_len)</span>, <span class="keywordtype">allocatable</span> :: limiter(:)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="keywordtype">character(len=std_len)</span>, <span class="keywordtype">allocatable</span> :: gradient_limiter(:)</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordtype">character(len=name_len)</span> :: stretch_dim(ndim)<span class="comment"></span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">    !&gt; How to apply dimensional splitting to the source terms, see</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">    !&gt; @ref discretization.md</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="keywordtype">character(len=std_len)</span> :: typesourcesplit<span class="comment"></span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">    !&gt; Which flux scheme of spatial discretization to use (per grid level)</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keywordtype">character(len=std_len)</span>, <span class="keywordtype">allocatable</span> :: flux_scheme(:)<span class="comment"></span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">    !&gt; Which type of the maximal bound speed of Riemann fan to use</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordtype">character(len=std_len)</span> :: typeboundspeed<span class="comment"></span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">    !&gt; Which time stepper to use</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordtype">character(len=std_len)</span> :: time_stepper<span class="comment"></span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">    !&gt; Which time integrator to use</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordtype">character(len=std_len)</span> :: time_integrator<span class="comment"></span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">    !&gt; type of curl operator</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordtype">character(len=std_len)</span> :: typecurl<span class="comment"></span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">    !&gt; Limiter used for prolongation to refined grids and ghost cells</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordtype">character(len=std_len)</span> :: typeprolonglimit<span class="comment"></span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">    !&gt; How to compute the CFL-limited time step.</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">    !&gt; Options are &#39;maxsum&#39;: max(sum(c/dx)); &#39;summax&#39;: sum(max(c/dx)) and</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">    !&gt; &#39;minimum: max(c/dx), where the summations loop over the grid dimensions and</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">    !&gt; c is the velocity. The default &#39;maxsum&#39; is the conventiontal way of</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">    !&gt; computing CFL-limited time steps.</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordtype">character(len=std_len)</span> :: typecourant</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(nsavehi)</span> :: tsave_log, tsave_dat, tsave_slice, &amp;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;         tsave_collapsed, tsave_custom</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordtype">double precision</span> :: dtsave_log, dtsave_dat, dtsave_slice, &amp;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;         dtsave_collapsed, dtsave_custom</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordtype">integer</span> :: ditsave_log, ditsave_dat, ditsave_slice, &amp;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;         ditsave_collapsed, ditsave_custom</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordtype">double precision</span> :: tsavestart_log, tsavestart_dat, tsavestart_slice, &amp;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;         tsavestart_collapsed, tsavestart_custom</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordtype">integer</span> :: windex, ipower</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordtype">double precision</span> :: sizeuniformpart^D</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordtype">double precision</span> :: im_delta,im_nu,rka54,rka51,rkb54,rka55</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    namelist /filelist/ <a class="code" href="namespacemod__global__parameters.html#acca226f88fb362bae425ca71f3742d09">base_filename</a>,<a class="code" href="namespacemod__global__parameters.html#a99b70d54ff2f08fb179495e2a07d1e44">restart_from_file</a>, &amp;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#ade5d1c51af566e1f4fead3564b6739a9">typefilelog</a>,<a class="code" href="namespacemod__global__parameters.html#a3445cbdbb5912e5da0aafc9b83ec6300">firstprocess</a>,<a class="code" href="namespacemod__global__parameters.html#ac29e1282b63a78a2c3a89d18f05675ff">reset_grid</a>,<a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a>, &amp;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#abeaadf7ca515b0a99e6e1e326d88e4f7">convert</a>,<a class="code" href="namespacemod__global__parameters.html#a43c682e6a92ae87edc89730d59af7b46">convert_type</a>,<a class="code" href="namespacemod__global__parameters.html#a41a6de0584bd346508963bfac3653ae6">saveprim</a>,<a class="code" href="namespacemod__global__parameters.html#a6b5097d61d55594c85e0f80cea175ca2">usr_filename</a>,&amp;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a892699e88d1642157a42ce148707fdf8">nwauxio</a>,<a class="code" href="namespacemod__global__parameters.html#a0f69ab118580f4dd69756f1e17754c15">nocartesian</a>, <a class="code" href="namespacemod__global__parameters.html#a96ac799804cba9c9f5ceda58b1b115a4">w_write</a>,<a class="code" href="namespacemod__global__parameters.html#aa81fe5c9595675cc4a2397258dca12c3">writelevel</a>,&amp;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a8c5fbfe3d140df19a90085e75c13973f">writespshift</a>,<a class="code" href="namespacemod__global__parameters.html#a6d25c8f0a568cc070ea9f329dd23f88f">length_convert_factor</a>, <a class="code" href="namespacemod__global__parameters.html#a02302cec765e4436ca70725ef811cc10">w_convert_factor</a>, &amp;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a4feabcd0ba0961f4bd06a662f89c50cb">time_convert_factor</a>,<a class="code" href="namespacemod__global__parameters.html#a47213c2deabf33173fab8d80bc64aa79">level_io</a>,<a class="code" href="namespacemod__global__parameters.html#a09bdaca578aec7457ae3779ef78cd8eb">level_io_min</a>, <a class="code" href="namespacemod__global__parameters.html#acff6d1a4095e8d228d4c288f433ab99a">level_io_max</a>, &amp;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a701d9f0321c70f8e13a05f6c15f2fb76">autoconvert</a>,<a class="code" href="namespacemod__slice.html#aa01fdbfdbedbb831547f4797f2518fbe">slice_type</a>,<a class="code" href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">slicenext</a>,<a class="code" href="namespacemod__global__parameters.html#ae5c84337d8ace067e3744f286305044c">collapsenext</a>,<a class="code" href="namespacemod__global__parameters.html#a71fb2d1149a0e60130d7ab8dd14fa448">collapse_type</a>, &amp;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a42fb75c82b1802e1084f00b534b555c9">type_endian</a></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    namelist /savelist/ <a class="code" href="namespacemod__global__parameters.html#abb88b3a6316e2d70f8758af903c29d5e">tsave</a>,<a class="code" href="namespacemod__global__parameters.html#a2cc0f16622648beea976f73191955bfc">itsave</a>,<a class="code" href="namespacemod__global__parameters.html#a92be6d1fd210a17a74b04ef7b597b791">dtsave</a>,<a class="code" href="namespacemod__global__parameters.html#a642b591486cb72f711ffcaffacd41d84">ditsave</a>,<a class="code" href="namespacemod__slice.html#ada481ed24e7de5c84878a06e5c1920c7">nslices</a>,<a class="code" href="namespacemod__slice.html#ab03e9f445d1009207701692d48e2f4f9">slicedir</a>, &amp;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;         <a class="code" href="namespacemod__slice.html#ae261b249da78bf9f9c0fde95e943551a">slicecoord</a>,<a class="code" href="namespacemod__global__parameters.html#a65d9e0a37fc83ab3cac268509da79e46">collapse</a>,<a class="code" href="namespacemod__global__parameters.html#ac124187f1fdd4d4d1cab40d55e8abfdb">collapselevel</a>, <a class="code" href="namespacemod__global__parameters.html#a9138f9532b13609e59e135a0a3592a5d">time_between_print</a>,&amp;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;         tsave_log, tsave_dat, tsave_slice, tsave_collapsed, tsave_custom, &amp;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;         dtsave_log, dtsave_dat, dtsave_slice, dtsave_collapsed, dtsave_custom, &amp;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;         ditsave_log, ditsave_dat, ditsave_slice, ditsave_collapsed, ditsave_custom,&amp;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;         tsavestart_log, tsavestart_dat, tsavestart_slice, tsavestart_collapsed,&amp;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;         tsavestart_custom, <a class="code" href="namespacemod__global__parameters.html#a63586860c44b7ca7aeee41a26a6b2c02">tsavestart</a></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    namelist /stoplist/ <a class="code" href="namespacemod__global__parameters.html#a3b867699253875817b4abd3a348b8f53">it_init</a>,<a class="code" href="namespacemod__global__parameters.html#a32b88ccd4a2d2fd290d36b61c28488f1">time_init</a>,<a class="code" href="namespacemod__global__parameters.html#a057feb2697cc1ef7cee9e82c79d7eb27">it_max</a>,<a class="code" href="namespacemod__global__parameters.html#a2dd037f0c45d7e7ba6a10c1f16092699">time_max</a>,<a class="code" href="namespacemod__global__parameters.html#ad3e1cd1b56e8932c8186716c7c13e3e3">dtmin</a>,<a class="code" href="namespacemod__global__parameters.html#a1337000bcd79422ab891841e74f3715f">reset_it</a>,<a class="code" href="namespacemod__global__parameters.html#a5c1bf53d9221dda713b7731ca922f3d5">reset_time</a>,&amp;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a6f4b0ca677f067d9ffa334a39c81198b">wall_time_max</a>,<a class="code" href="namespacemod__global__parameters.html#aa6335d944592dac407398f06198b68d1">final_dt_reduction</a></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160; </div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    namelist /methodlist/ time_stepper,time_integrator, &amp;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a21e3e22000a7bcf45c39c5afea731371">source_split_usr</a>,typesourcesplit,<a class="code" href="namespacemod__global__parameters.html#a68bbb6233a821af90e2f693a636c0c8c">local_timestep</a>,&amp;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a122ab156050e3d8d53c27e3113d7f2a6">dimsplit</a>,<a class="code" href="namespacemod__global__parameters.html#ab9a240741796fc1c8ddb6915cfad4035">typedimsplit</a>,flux_scheme,&amp;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;         limiter,gradient_limiter,<a class="code" href="namespacemod__limiter.html#a96347554389a5a4efc7af7a496e95318">cada3_radius</a>,&amp;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a389e1d707c9b879f63b549175adc6ab3">loglimit</a>,typeboundspeed, <a class="code" href="namespacemod__global__parameters.html#a05670d1e36a9ade124b86238a3f6ecbb">h_correction</a>,&amp;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#aabacfec18ce0de899580266b28ca1d58">typetvd</a>,<a class="code" href="namespacemod__global__parameters.html#a00ec7c4fcdaf315d10fde08f15073a7f">typeentropy</a>,<a class="code" href="namespacemod__global__parameters.html#aadf4c69750b7efad63e2572d1c579f76">entropycoef</a>,<a class="code" href="namespacemod__global__parameters.html#aba532d5b27802e6e34fdd33da22c98e3">typeaverage</a>, &amp;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a12cefbb8860465ffae8acee3a4535376">typegrad</a>,<a class="code" href="namespacemod__global__parameters.html#a613cd6410f0c433a64c20dcc752eb37a">typediv</a>,typecurl,&amp;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a47fc5e2d167d5984eca70ead09e4c8e0">nxdiffusehllc</a>, <a class="code" href="namespacemod__global__parameters.html#a61e41833758134ab6a035332a3f50f33">flathllc</a>, <a class="code" href="namespacemod__global__parameters.html#a0b521cf768ad9f682b1a8baf151e1956">tvdlfeps</a>,&amp;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#ad50ed0b91e7e1038262f950fc6eed215">flatcd</a>,<a class="code" href="namespacemod__global__parameters.html#a28e9a787f5148a24968434c81cdcd153">flatsh</a>,&amp;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;         rk2_alfa,<a class="code" href="namespacemod__global__parameters.html#a6e65528deaee18d93347042916c88030">imex222_lambda</a>,<a class="code" href="namespacemod__global__parameters.html#a770ca839caef4837f0ca899602b6d454">ssprk_order</a>,<a class="code" href="namespacemod__global__parameters.html#add7419e89b39d61726fe25c033cdd88e">rk3_switch</a>,<a class="code" href="namespacemod__global__parameters.html#a8ce58d607d9ee7388a778b7d86769c75">imex_switch</a>,&amp;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a3730de6b193fa2d3fb50e979195ef518">small_temperature</a>,<a class="code" href="namespacemod__global__parameters.html#a19f0c8766e32f669bc7680685a55ea33">small_pressure</a>,<a class="code" href="namespacemod__global__parameters.html#ad147dadf78c6587c3b27c5c04039c808">small_density</a>, &amp;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;         <a class="code" href="namespacemod__small__values.html#ae9f015805b337cda4f563826c1e8b7cd">small_values_method</a>, <a class="code" href="namespacemod__small__values.html#a16ae31b4ca0d18f843c603e5f4c758d8">small_values_daverage</a>, <a class="code" href="namespacemod__global__parameters.html#ac00b1fb8c041c78556efef827450962a">fix_small_values</a>, <a class="code" href="namespacemod__global__parameters.html#afab102462aa140015d4722d99e2a5de4">check_small_values</a>, &amp;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;         <a class="code" href="namespacemod__small__values.html#a31018c4c2a11eed22cac84dadb4aa912">trace_small_values</a>, <a class="code" href="namespacemod__small__values.html#abe16023a5fd2637dd995cf180d9791fa">small_values_fix_iw</a>, &amp;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;         <a class="code" href="namespacemod__limiter.html#ae43ef009bd299ca5ea83b290e4411caf">schmid_rad</a>^d</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    namelist /boundlist/ <a class="code" href="namespacemod__global__parameters.html#ab7c7effa3bb9a3ba7e79fd548fc7c8aa">nghostcells</a>,<a class="code" href="namespacemod__global__parameters.html#a6c2595e4399ab9a2db77faf60b937237">ghost_copy</a>,&amp;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a0887552b34b60da3d7f32328ded395a6">internalboundary</a>, typeboundary_^<a class="code" href="namespacemod__global__parameters.html#a8242f42a9b14d7655e6eb74ee23e6195">l</a>, <a class="code" href="namespacemod__global__parameters.html#a4c292b82b129aa70d2d562789cd28bd5">save_physical_boundary</a></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    namelist /meshlist/ <a class="code" href="namespacemod__global__parameters.html#ad3ffd4e35e76a0b86495789e5458fdd8">refine_max_level</a>,<a class="code" href="namespacemod__global__parameters.html#aac1731aeb6f288269458ed77b7317e88">nbufferx</a>^d,<a class="code" href="namespacemod__global__parameters.html#acc91cb6c162d5ddec9755eee2a2f593a">refine_threshold</a>,&amp;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#ad7554834c993430ee77d00bf0ea95c29">derefine_ratio</a>, <a class="code" href="namespacemod__global__parameters.html#a6b2953503f51194cc6d0476650d023b8">refine_criterion</a>, &amp;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;         stretch_dim, <a class="code" href="namespacemod__global__parameters.html#a33fdab327272a72d6c67c6267a6ab51d">stretch_uncentered</a>, &amp;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a8bfacb4dd09490b8c7ab27804ca8a4e4">qstretch_baselevel</a>, <a class="code" href="namespacemod__global__parameters.html#a85452df53d9def115b87f8a5657a57b0">nstretchedblocks_baselevel</a>, &amp;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a4736ef04292da21cb89fb46425b36985">amr_wavefilter</a>,<a class="code" href="namespacemod__global__parameters.html#ad92f0d9f4cbc71571fb26c74cd2be25b">max_blocks</a>,<a class="code" href="namespacemod__global__parameters.html#a61b20ad3b87b28e636a5f74d3145a850">block_nx</a>^d,<a class="code" href="namespacemod__global__parameters.html#a23b35ecdd0fd1864d80811b347464176">domain_nx</a>^d,<a class="code" href="namespacemod__global__parameters.html#a990d040524d30b1155da2512352d8344">iprob</a>,<a class="code" href="namespacemod__global__parameters.html#a37c2dd951c58acfe58a69763e53d6bf4">xprob</a>^<a class="code" href="namespacemod__global__parameters.html#a8242f42a9b14d7655e6eb74ee23e6195">l</a>, &amp;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#ab7ea9146b4eb6733d50c489cd9ce3395">w_refine_weight</a>, <a class="code" href="namespacemod__global__parameters.html#a97dcff27c39ab92f38c63288a904f89b">prolongprimitive</a>,<a class="code" href="namespacemod__global__parameters.html#a584ce48a94cacaab9e7da7b04a6a85d6">coarsenprimitive</a>, &amp;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;         typeprolonglimit, &amp;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;         <a class="code" href="namespacemod__global__parameters.html#a32a063a74710338e40647f22e2cba2f8">logflag</a>,<a class="code" href="namespacemod__global__parameters.html#ab49a62e2ea118f2424bb612ee35d5639">tfixgrid</a>,<a class="code" href="namespacemod__global__parameters.html#a45e1d0bc4dbe15357349fdc359366fba">itfixgrid</a>,<a class="code" href="namespacemod__global__parameters.html#a3ca4430b2e1352a48833355f28427d9f">ditregrid</a></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    namelist /paramlist/  <a class="code" href="namespacemod__global__parameters.html#a6e9ec60e3266b9f605e1358cf753978d">courantpar</a>, <a class="code" href="namespacemod__global__parameters.html#a60f4f86ae97116d90e004a8125e21ede">dtpar</a>, <a class="code" href="namespacemod__global__parameters.html#a12163a591511198c1f7613eaa220e6c5">dtdiffpar</a>, &amp;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;         typecourant, <a class="code" href="namespacemod__global__parameters.html#a7697c549bfe2fdc52590606d35f7645f">slowsteps</a></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    namelist /emissionlist/ <a class="code" href="namespacemod__global__parameters.html#a38896e5173f553e8c0db326034221a64">filename_euv</a>,<a class="code" href="namespacemod__global__parameters.html#ac07dcf6afc2dfd3344a3cbabf08ad37c">wavelength</a>,&amp;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;          <a class="code" href="namespacemod__global__parameters.html#a0aadbd954bcc854018198195e2495e90">filename_sxr</a>,<a class="code" href="namespacemod__global__parameters.html#aea4a51c9905b3be09f63e71e14412a22">emin_sxr</a>,<a class="code" href="namespacemod__global__parameters.html#a5f59b38b0ad0ed44f0918452cee31bfb">emax_sxr</a>,&amp;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;          <a class="code" href="namespacemod__global__parameters.html#aa8df2f891dca11a4a18199294bb4e018">los_theta</a>,<a class="code" href="namespacemod__global__parameters.html#acee9d1c0fd5be4ecb6d0c7b1199c5e00">los_phi</a>,<a class="code" href="namespacemod__global__parameters.html#a785298c4f0e2e1ce9707e8ff814af159">image_rotate</a>,<a class="code" href="namespacemod__global__parameters.html#ae6f75a5d8ed19c05f9d3acd319f2cd09">x_origin</a>,<a class="code" href="namespacemod__global__parameters.html#ace9b925df34ceee46314d890452017d9">big_image</a>,&amp;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;          <a class="code" href="namespacemod__global__parameters.html#a0de04bb7bac409bd7d38746f5ea7b3ef">spectrum_wl</a>,<a class="code" href="namespacemod__global__parameters.html#a499251de3e6662e6956a005cfb98ea5b">location_slit</a>,<a class="code" href="namespacemod__global__parameters.html#a275f63f56e91b1535b6b9b255c6d6995">filename_spectrum</a>,&amp;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;          <a class="code" href="namespacemod__global__parameters.html#ad3d10b4e2f860ecce45f5cf3cf4743d3">spectrum_window_min</a>,<a class="code" href="namespacemod__global__parameters.html#abd0ca931a66632286f943b590ff2ed32">spectrum_window_max</a>,&amp;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;          <a class="code" href="namespacemod__global__parameters.html#acfb666485b777dea6289a235519303a6">instrument_resolution_factor</a>,<a class="code" href="namespacemod__global__parameters.html#a20c19e83ca0719c4a296a8c095f8454e">activate_unit_arcsec</a>,&amp;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;          <a class="code" href="namespacemod__global__parameters.html#a4395b960728400cb7612fc8591c39626">filename_whitelight</a>,<a class="code" href="namespacemod__global__parameters.html#a602b662328098b5b9254339adcf3cb20">whitelight_instrument</a>,<a class="code" href="namespacemod__global__parameters.html#a8488ae7a5d34bdabfe0c2f4d3d033a25">r_occultor</a>,<a class="code" href="namespacemod__global__parameters.html#a0aa11ac2e9d07626a9de1812bc893dfa">r_opt_thick</a>,&amp;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;          <a class="code" href="namespacemod__global__parameters.html#a84881fbdc47fb8c5db93cff24a57ba46">dat_resolution</a>,<a class="code" href="namespacemod__global__parameters.html#adea6be0a38ab7843e78126360184857a">direction_slit</a></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="comment">! default maximum number of grid blocks in a processor</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ad92f0d9f4cbc71571fb26c74cd2be25b">max_blocks</a>=4000</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">! allocate cell size of all levels</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#aafb7ce2cea79dc8b58a753a761a48035">dx</a>(ndim,<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>))</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    {<span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#a3accdc5892cc101cf66e709b7bd59dff">dg</a>^d(<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>))\}</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    {<span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#a5a0c4ff10aba586a1a4b285e4b93e8d1">ng</a>^d(<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>))\}</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">! default block size excluding ghost cells</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    {<a class="code" href="namespacemod__global__parameters.html#a61b20ad3b87b28e636a5f74d3145a850">block_nx</a>^d = 16\}</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">! default resolution of level-1 mesh (full domain)</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    {<a class="code" href="namespacemod__global__parameters.html#a23b35ecdd0fd1864d80811b347464176">domain_nx</a>^d = 32\}</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="comment">!! default number of ghost-cell layers at each boundary of a block</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="comment">! this is now done when the variable is defined in mod_global_parameters</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="comment">! the physics modules might set this variable in their init subroutine called earlier</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ab7c7effa3bb9a3ba7e79fd548fc7c8aa">nghostcells</a> = 2</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">! Allocate boundary conditions arrays in new and old style</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keyword">allocate</span>(typeboundary_min^d(nwfluxbc))</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keyword">allocate</span>(typeboundary_max^d(nwfluxbc))</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    typeboundary_min^d = <a class="code" href="namespacemod__global__parameters.html#aba6bd3b8579dde6b7c68f65ab628a049">undefined</a></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    typeboundary_max^d = <a class="code" href="namespacemod__global__parameters.html#aba6bd3b8579dde6b7c68f65ab628a049">undefined</a></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    }</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#a3ba92b453fe4963537afc9cca083fba8">typeboundary</a>(nwflux+nwaux,2*ndim))</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a3ba92b453fe4963537afc9cca083fba8">typeboundary</a>=0</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">! not save physical boundary in dat files by default</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a4c292b82b129aa70d2d562789cd28bd5">save_physical_boundary</a> = .false.</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160; </div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a0887552b34b60da3d7f32328ded395a6">internalboundary</a>   = .false.</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment">! defaults for specific options</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a12cefbb8860465ffae8acee3a4535376">typegrad</a>   = <span class="stringliteral">&#39;central&#39;</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a613cd6410f0c433a64c20dcc752eb37a">typediv</a>    = <span class="stringliteral">&#39;central&#39;</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    typecurl   = <span class="stringliteral">&#39;central&#39;</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">! defaults for smallest physical values allowed</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a3730de6b193fa2d3fb50e979195ef518">small_temperature</a> = 0.d0</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a19f0c8766e32f669bc7680685a55ea33">small_pressure</a>    = 0.d0</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ad147dadf78c6587c3b27c5c04039c808">small_density</a>     = 0.d0</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keyword">allocate</span>(<a class="code" href="namespacemod__small__values.html#abe16023a5fd2637dd995cf180d9791fa">small_values_fix_iw</a>(nw))</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <a class="code" href="namespacemod__small__values.html#abe16023a5fd2637dd995cf180d9791fa">small_values_fix_iw</a>(:) = .true.</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="comment">! defaults for convert behavior</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="comment">! store the -if value from argument in command line</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    restart_from_file_arg    = <a class="code" href="namespacemod__global__parameters.html#a99b70d54ff2f08fb179495e2a07d1e44">restart_from_file</a></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a892699e88d1642157a42ce148707fdf8">nwauxio</a>                  = 0</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a0f69ab118580f4dd69756f1e17754c15">nocartesian</a>              = .false.</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a41a6de0584bd346508963bfac3653ae6">saveprim</a>                 = .false.</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a701d9f0321c70f8e13a05f6c15f2fb76">autoconvert</a>              = .false.</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a43c682e6a92ae87edc89730d59af7b46">convert_type</a>             = <span class="stringliteral">&#39;vtuBCCmpi&#39;</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <a class="code" href="namespacemod__slice.html#aa01fdbfdbedbb831547f4797f2518fbe">slice_type</a>               = <span class="stringliteral">&#39;vtuCC&#39;</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a71fb2d1149a0e60130d7ab8dd14fa448">collapse_type</a>            = <span class="stringliteral">&#39;vti&#39;</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#a96ac799804cba9c9f5ceda58b1b115a4">w_write</a>(nw))</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a96ac799804cba9c9f5ceda58b1b115a4">w_write</a>(1:nw)             = .true.</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#aa81fe5c9595675cc4a2397258dca12c3">writelevel</a>(<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>))</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#aa81fe5c9595675cc4a2397258dca12c3">writelevel</a>(1:<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>)  = .true.</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a8c5fbfe3d140df19a90085e75c13973f">writespshift</a>(1:ndim,1:2) = zero</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a47213c2deabf33173fab8d80bc64aa79">level_io</a>                 = -1</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a09bdaca578aec7457ae3779ef78cd8eb">level_io_min</a>             = 1</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#acff6d1a4095e8d228d4c288f433ab99a">level_io_max</a>             = <a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="comment">! endianness: littleendian (default) is 1, bigendian otherwise</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a42fb75c82b1802e1084f00b534b555c9">type_endian</a>              = 1</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="comment">! normalization of primitive variables: only for output</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="comment">! note that length_convert_factor is for length</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="comment">! this scaling is optional, and must be set consistently if used</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#a02302cec765e4436ca70725ef811cc10">w_convert_factor</a>(nw))</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a02302cec765e4436ca70725ef811cc10">w_convert_factor</a>(:)   = 1.0d0</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a4feabcd0ba0961f4bd06a662f89c50cb">time_convert_factor</a>   = 1.0d0</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a6d25c8f0a568cc070ea9f329dd23f88f">length_convert_factor</a> = 1.0d0</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="comment">! AMR related defaults</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ad3ffd4e35e76a0b86495789e5458fdd8">refine_max_level</a>      = 1</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    {<a class="code" href="namespacemod__global__parameters.html#aac1731aeb6f288269458ed77b7317e88">nbufferx</a>^d                 = 0\}</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#acc91cb6c162d5ddec9755eee2a2f593a">refine_threshold</a>(<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>))</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#acc91cb6c162d5ddec9755eee2a2f593a">refine_threshold</a>(1:<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>)            = 0.1d0</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#ad7554834c993430ee77d00bf0ea95c29">derefine_ratio</a>(<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>))</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ad7554834c993430ee77d00bf0ea95c29">derefine_ratio</a>(1:<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>)       = 1.0d0/8.0d0</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    typeprolonglimit            = <span class="stringliteral">&#39;default&#39;</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a6b2953503f51194cc6d0476650d023b8">refine_criterion</a>               = 3</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#ab7ea9146b4eb6733d50c489cd9ce3395">w_refine_weight</a>(nw+1))</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ab7ea9146b4eb6733d50c489cd9ce3395">w_refine_weight</a>                    = 0.d0</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#a32a063a74710338e40647f22e2cba2f8">logflag</a>(nw+1))</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a32a063a74710338e40647f22e2cba2f8">logflag</a>                     = .false.</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#a4736ef04292da21cb89fb46425b36985">amr_wavefilter</a>(<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>))</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a4736ef04292da21cb89fb46425b36985">amr_wavefilter</a>(1:<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>) = 1.0d-2</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ab49a62e2ea118f2424bb612ee35d5639">tfixgrid</a>                    = bigdouble</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a45e1d0bc4dbe15357349fdc359366fba">itfixgrid</a>                   = biginteger</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a3ca4430b2e1352a48833355f28427d9f">ditregrid</a>                   = 1</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="comment">! Grid stretching defaults</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a33fdab327272a72d6c67c6267a6ab51d">stretch_uncentered</a> = .true.</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    stretch_dim(1:ndim) = <a class="code" href="namespacemod__global__parameters.html#aba6bd3b8579dde6b7c68f65ab628a049">undefined</a></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a8bfacb4dd09490b8c7ab27804ca8a4e4">qstretch_baselevel</a>(1:ndim) = bigdouble</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a85452df53d9def115b87f8a5657a57b0">nstretchedblocks_baselevel</a>(1:ndim)=0</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160; </div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="comment">! IO defaults</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a3b867699253875817b4abd3a348b8f53">it_init</a>       = 0</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a057feb2697cc1ef7cee9e82c79d7eb27">it_max</a>        = biginteger</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a32b88ccd4a2d2fd290d36b61c28488f1">time_init</a>     = 0.d0</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a2dd037f0c45d7e7ba6a10c1f16092699">time_max</a>      = bigdouble</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a6f4b0ca677f067d9ffa334a39c81198b">wall_time_max</a> = bigdouble</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacemod__global__parameters.html#a68bbb6233a821af90e2f693a636c0c8c">local_timestep</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      <a class="code" href="namespacemod__global__parameters.html#aa6335d944592dac407398f06198b68d1">final_dt_reduction</a>=.false.</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <a class="code" href="namespacemod__global__parameters.html#aa6335d944592dac407398f06198b68d1">final_dt_reduction</a>=.true.</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ae9df63ed323b77d4c3477e5fa33cc122">final_dt_exit</a>=.false.</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ad3e1cd1b56e8932c8186716c7c13e3e3">dtmin</a>         = 1.0d-10</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <a class="code" href="namespacemod__slice.html#ada481ed24e7de5c84878a06e5c1920c7">nslices</a>       = 0</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a65d9e0a37fc83ab3cac268509da79e46">collapse</a>      = .false.</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ac124187f1fdd4d4d1cab40d55e8abfdb">collapselevel</a> = 1</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a9138f9532b13609e59e135a0a3592a5d">time_between_print</a> = 30.0d0 <span class="comment">! Print status every 30 seconds</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">do</span> ifile=1,<a class="code" href="namespacemod__global__parameters.html#ad8e2f2407305f395e212d838cbd366a0">nfile</a></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keywordflow">do</span> isave=1,<a class="code" href="namespacemod__global__parameters.html#a5c6dbe29415b67eac21ed328d7a77b34">nsavehi</a></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <a class="code" href="namespacemod__global__parameters.html#abb88b3a6316e2d70f8758af903c29d5e">tsave</a>(isave,ifile)  = bigdouble  <span class="comment">! global_time  of saves into the output files</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <a class="code" href="namespacemod__global__parameters.html#a2cc0f16622648beea976f73191955bfc">itsave</a>(isave,ifile) = biginteger <span class="comment">! it of saves into the output files</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <a class="code" href="namespacemod__global__parameters.html#a92be6d1fd210a17a74b04ef7b597b791">dtsave</a>(ifile)  = bigdouble  <span class="comment">! time between saves</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <a class="code" href="namespacemod__global__parameters.html#a642b591486cb72f711ffcaffacd41d84">ditsave</a>(ifile) = biginteger <span class="comment">! timesteps between saves</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <a class="code" href="namespacemod__global__parameters.html#af6c799c5a82858e33cb6c30c691f952d">isavet</a>(ifile)  = 1          <span class="comment">! index for saves by global_time</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      <a class="code" href="namespacemod__global__parameters.html#aeb30573e6532f604a257c2705db802cf">isaveit</a>(ifile) = 1          <span class="comment">! index for saves by it</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <a class="code" href="namespacemod__global__parameters.html#a63586860c44b7ca7aeee41a26a6b2c02">tsavestart</a>(ifile) = 0.0d0</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    tsave_log       = bigdouble</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    tsave_dat       = bigdouble</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    tsave_slice     = bigdouble</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    tsave_collapsed = bigdouble</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    tsave_custom    = bigdouble</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160; </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    dtsave_log       = bigdouble</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    dtsave_dat       = bigdouble</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    dtsave_slice     = bigdouble</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    dtsave_collapsed = bigdouble</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    dtsave_custom    = bigdouble</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160; </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    ditsave_log       = biginteger</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    ditsave_dat       = biginteger</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    ditsave_slice     = biginteger</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    ditsave_collapsed = biginteger</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    ditsave_custom    = biginteger</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    tsavestart_log       = bigdouble</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    tsavestart_dat       = bigdouble</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    tsavestart_slice     = bigdouble</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    tsavestart_collapsed = bigdouble</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    tsavestart_custom    = bigdouble</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ade5d1c51af566e1f4fead3564b6739a9">typefilelog</a> = <span class="stringliteral">&#39;default&#39;</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="comment">! defaults for input</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a5c1bf53d9221dda713b7731ca922f3d5">reset_time</a> = .false.</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a1337000bcd79422ab891841e74f3715f">reset_it</a> = .false.</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a3445cbdbb5912e5da0aafc9b83ec6300">firstprocess</a>  = .false.</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ac29e1282b63a78a2c3a89d18f05675ff">reset_grid</a>     = .false.</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#acca226f88fb362bae425ca71f3742d09">base_filename</a>   = <span class="stringliteral">&#39;data&#39;</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a6b5097d61d55594c85e0f80cea175ca2">usr_filename</a>    = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <span class="comment">! Defaults for discretization methods</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#aba532d5b27802e6e34fdd33da22c98e3">typeaverage</a>     = <span class="stringliteral">&#39;default&#39;</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a0b521cf768ad9f682b1a8baf151e1956">tvdlfeps</a>        = one</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a47fc5e2d167d5984eca70ead09e4c8e0">nxdiffusehllc</a>   = 0</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a61e41833758134ab6a035332a3f50f33">flathllc</a>        = .false.</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a7697c549bfe2fdc52590606d35f7645f">slowsteps</a>       = -1</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a6e9ec60e3266b9f605e1358cf753978d">courantpar</a>      = 0.8d0</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    typecourant     = <span class="stringliteral">&#39;maxsum&#39;</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a122ab156050e3d8d53c27e3113d7f2a6">dimsplit</a>        = .false.</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ab9a240741796fc1c8ddb6915cfad4035">typedimsplit</a>    = <span class="stringliteral">&#39;default&#39;</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacemod__physics.html#a9c0b8a2dc10a59ca87e89eaa056929ad">physics_type</a>==<span class="stringliteral">&#39;mhd&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <a class="code" href="namespacemod__limiter.html#a96347554389a5a4efc7af7a496e95318">cada3_radius</a>  = 0.5d0</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <a class="code" href="namespacemod__limiter.html#a96347554389a5a4efc7af7a496e95318">cada3_radius</a>  = 0.1d0</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    {<a class="code" href="namespacemod__limiter.html#ae43ef009bd299ca5ea83b290e4411caf">schmid_rad</a>^d = 1.d0\}</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#aabacfec18ce0de899580266b28ca1d58">typetvd</a>         = <span class="stringliteral">&#39;roe&#39;</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    typeboundspeed  = <span class="stringliteral">&#39;Einfeldt&#39;</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a21e3e22000a7bcf45c39c5afea731371">source_split_usr</a>= .false.</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    time_stepper    = <span class="stringliteral">&#39;twostep&#39;</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    time_integrator = <span class="stringliteral">&#39;default&#39;</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="comment">! default PC or explicit midpoint, hence alfa=0.5</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    rk2_alfa        = half </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">! default IMEX-RK22Ln hence lambda = 1 - 1/sqrt(2)</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a6e65528deaee18d93347042916c88030">imex222_lambda</a>  = 1.0d0 - 1.0d0 / dsqrt(2.0d0)</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="comment">! default SSPRK(3,3) or Gottlieb-Shu 1998 for threestep</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="comment">! default SSPRK(4,3) or Spireti-Ruuth for fourstep</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="comment">! default SSPRK(5,4) using Gottlieb coeffs</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a770ca839caef4837f0ca899602b6d454">ssprk_order</a>    = 3</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="comment">! default RK3 butcher table: Heun 3rd order</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#add7419e89b39d61726fe25c033cdd88e">rk3_switch</a>      = 3</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="comment">! default IMEX threestep is IMEX_ARK(232)</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a8ce58d607d9ee7388a778b7d86769c75">imex_switch</a>     = 1</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160; </div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="comment">! Defaults for synthesing emission</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#aa8df2f891dca11a4a18199294bb4e018">los_theta</a> = 0.d0</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#acee9d1c0fd5be4ecb6d0c7b1199c5e00">los_phi</a> = 0.d0</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a785298c4f0e2e1ce9707e8ff814af159">image_rotate</a> = 0.d0</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ae6f75a5d8ed19c05f9d3acd319f2cd09">x_origin</a> = 0.d0</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ace9b925df34ceee46314d890452017d9">big_image</a> = .false.</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a499251de3e6662e6956a005cfb98ea5b">location_slit</a> = 0.d0</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#adea6be0a38ab7843e78126360184857a">direction_slit</a> = -1</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#acfb666485b777dea6289a235519303a6">instrument_resolution_factor</a>=1.d0</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a20c19e83ca0719c4a296a8c095f8454e">activate_unit_arcsec</a>=.true.</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a602b662328098b5b9254339adcf3cb20">whitelight_instrument</a>=<span class="stringliteral">&#39;LASCO/C2&#39;</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a8488ae7a5d34bdabfe0c2f4d3d033a25">r_occultor</a>=-1.d0</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a0aa11ac2e9d07626a9de1812bc893dfa">r_opt_thick</a>=1.d0</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a84881fbdc47fb8c5db93cff24a57ba46">dat_resolution</a>=.false.</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keyword">allocate</span>(flux_scheme(<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>),<a class="code" href="namespacemod__global__parameters.html#a10e70ded54b27760f9a507dbade67353">typepred1</a>(<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>),<a class="code" href="namespacemod__global__parameters.html#a703976b153fd00ff87ab47abd82a1c8a">flux_method</a>(<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>))</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keyword">allocate</span>(limiter(<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>),gradient_limiter(<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a>))</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">do</span> level=1,<a class="code" href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">nlevelshi</a></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;       flux_scheme(level) = <span class="stringliteral">&#39;tvdlf&#39;</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;       <a class="code" href="namespacemod__global__parameters.html#a10e70ded54b27760f9a507dbade67353">typepred1</a>(level)   = 0</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;       limiter(level)     = <span class="stringliteral">&#39;minmod&#39;</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;       gradient_limiter(level) = <span class="stringliteral">&#39;minmod&#39;</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160; </div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#ad50ed0b91e7e1038262f950fc6eed215">flatcd</a>          = .false.</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a28e9a787f5148a24968434c81cdcd153">flatsh</a>          = .false.</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    typesourcesplit = <span class="stringliteral">&#39;sfs&#39;</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#a389e1d707c9b879f63b549175adc6ab3">loglimit</a>(nw))</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a389e1d707c9b879f63b549175adc6ab3">loglimit</a>(1:nw)  = .false.</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keyword">allocate</span>(<a class="code" href="namespacemod__global__parameters.html#a00ec7c4fcdaf315d10fde08f15073a7f">typeentropy</a>(nw))</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">do</span> iw=1,nw</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;       <a class="code" href="namespacemod__global__parameters.html#a00ec7c4fcdaf315d10fde08f15073a7f">typeentropy</a>(iw)=<span class="stringliteral">&#39;nul&#39;</span>      <span class="comment">! Entropy fix type</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160; </div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a12163a591511198c1f7613eaa220e6c5">dtdiffpar</a>     = 0.5d0</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a60f4f86ae97116d90e004a8125e21ede">dtpar</a>         = -1.d0</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">! problem setup defaults</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a990d040524d30b1155da2512352d8344">iprob</a>    = 1</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="comment">! end defaults</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="comment">! Initialize Kronecker delta, and Levi-Civita tensor</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordflow">do</span> i=1,3</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;       <span class="keywordflow">do</span> j=1,3</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;          <span class="keywordflow">if</span>(i==j)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;             <a class="code" href="namespacemod__global__parameters.html#a31226ca76b94f6c33496105fd25e8fd9">kr</a>(i,j)=1</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;             <a class="code" href="namespacemod__global__parameters.html#a31226ca76b94f6c33496105fd25e8fd9">kr</a>(i,j)=0</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;          <span class="keywordflow">do</span> k=1,3</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;             <span class="keywordflow">if</span>(i==j.or.j==k.or.k==i)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                <a class="code" href="namespacemod__global__parameters.html#a1d6f8608af3df2b3b6d49fc64bcd346f">lvc</a>(i,j,k)=0</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(i+1==j.or.i-2==j)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                <a class="code" href="namespacemod__global__parameters.html#a1d6f8608af3df2b3b6d49fc64bcd346f">lvc</a>(i,j,k)=1</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                <a class="code" href="namespacemod__global__parameters.html#a1d6f8608af3df2b3b6d49fc64bcd346f">lvc</a>(i,j,k)=-1</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="keywordflow">       enddo</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160; </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">! These are used to construct file and log names from multiple par files</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    basename_full = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    basename_prev = <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordflow">do</span> i = 1, <span class="keyword">size</span>(<a class="code" href="namespacemod__global__parameters.html#a551004039cf74031e6bf9e613eb24e64">par_files</a>)</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;       <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a> == 0) print *, <span class="stringliteral">&quot;Reading &quot;</span> // trim(<a class="code" href="namespacemod__global__parameters.html#a551004039cf74031e6bf9e613eb24e64">par_files</a>(i))</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;       <span class="comment">! Check whether the file exists</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;       <span class="keyword">inquire</span>(file=trim(<a class="code" href="namespacemod__global__parameters.html#a551004039cf74031e6bf9e613eb24e64">par_files</a>(i)), exist=file_exists)</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160; </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;       <span class="keywordflow">if</span> (.not. file_exists) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;          <span class="keyword">write</span>(err_msg, *) <span class="stringliteral">&quot;The parameter file &quot;</span> // trim(<a class="code" href="namespacemod__global__parameters.html#a551004039cf74031e6bf9e613eb24e64">par_files</a>(i)) // &amp;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;               <span class="stringliteral">&quot; does not exist&quot;</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacemod__comm__lib.html#a9b6f1a8fd13bc5670e3b426151c34048">mpistop</a>(trim(err_msg))</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;       <span class="keyword">open</span>(<a class="code" href="namespacemod__global__parameters.html#a2643b30397384bf36289b3afb2d7dda3">unitpar</a>, file=trim(<a class="code" href="namespacemod__global__parameters.html#a551004039cf74031e6bf9e613eb24e64">par_files</a>(i)), status=<span class="stringliteral">&#39;old&#39;</span>)</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160; </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;       <span class="comment">! Try to read in the namelists. They can be absent or in a different</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;       <span class="comment">! order, since we rewind before each read.</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;       rewind(<a class="code" href="namespacemod__global__parameters.html#a2643b30397384bf36289b3afb2d7dda3">unitpar</a>)</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;       <span class="keyword">read</span>(<a class="code" href="namespacemod__global__parameters.html#a2643b30397384bf36289b3afb2d7dda3">unitpar</a>, filelist, <span class="keyword">end</span>=101)</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;101    rewind(unitpar)</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;       <span class="keyword">read</span>(unitpar, savelist, <span class="keyword">end</span>=102)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;102    rewind(unitpar)</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;       <span class="keyword">read</span>(unitpar, stoplist, <span class="keyword">end</span>=103)</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160; </div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;103    rewind(unitpar)</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;       <span class="keyword">read</span>(unitpar, methodlist, <span class="keyword">end</span>=104)</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;104    rewind(unitpar)</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;       <span class="keyword">read</span>(unitpar, boundlist, <span class="keyword">end</span>=105)</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;105    rewind(unitpar)</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;       <span class="keyword">read</span>(unitpar, meshlist, <span class="keyword">end</span>=106)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;106    rewind(unitpar)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;       <span class="keyword">read</span>(unitpar, paramlist, <span class="keyword">end</span>=107)</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;107    rewind(unitpar)</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;       <span class="keyword">read</span>(unitpar, emissionlist, <span class="keyword">end</span>=108)</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160; </div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;108    <span class="keyword">close</span>(unitpar)</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;       <span class="comment">! Append the log and file names given in the par files</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;       <span class="keywordflow">if</span> (base_filename /= basename_prev) &amp;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            basename_full = trim(basename_full) // trim(base_filename)</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;       basename_prev = base_filename</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    base_filename = basename_full</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="comment">! Check whether output directory is writable</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">if</span>(mype==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      dummy_file = trim(base_filename)//<span class="stringliteral">&quot;DUMMY&quot;</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="keyword">open</span>(newunit=my_unit, file=trim(dummy_file), iostat=iostate)</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="keywordflow">if</span> (iostate /= 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;         <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Can&#39;t write to output directory (&quot;</span> // &amp;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;              trim(base_filename) // <span class="stringliteral">&quot;)&quot;</span>)</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;         <span class="keyword">close</span>(my_unit, status=<span class="stringliteral">&#39;delete&#39;</span>)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordflow">if</span>(source_split_usr) any_source_split=.true.</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="comment">! restart filename from command line overwrites the one in par file</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordflow">if</span>(restart_from_file_arg /= undefined) &amp;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      restart_from_file=restart_from_file_arg</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="comment">! Root process will search snapshot</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="keywordflow">if</span> (mype == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="keywordflow">if</span>(restart_from_file == undefined) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="comment">! search file from highest index</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        file_exists=.false.</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">do</span> index_latest_data = 9999, 0, -1</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="namespacemod__input__output.html#a261f5086d85a96e13547d0e1c60928af">snapshot_exists</a>(index_latest_data)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            file_exists=.true.</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            <span class="keywordflow">exit</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="keywordflow">if</span>(.not.file_exists) index_latest_data=-1</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="comment">! get index of the given data restarted from</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        index_latest_data=<a class="code" href="namespacemod__input__output.html#a2b408b40f813e4fe523621ab4a497d76">get_snapshot_index</a>(trim(restart_from_file))</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keyword">call </span>mpi_bcast(index_latest_data, 1, mpi_integer, 0, icomm, ierrmpi)</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160; </div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordflow">if</span> (resume_previous_run) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <span class="keywordflow">if</span> (index_latest_data == -1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        <span class="keywordflow">if</span>(mype==0) <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;No snapshots found to resume from, start a new run...&quot;</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        <span class="comment">! Set file name to restart from</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="keyword">write</span>(restart_from_file, <span class="stringliteral">&quot;(a,i4.4,a)&quot;</span>) trim(base_filename),index_latest_data, <span class="stringliteral">&quot;.dat&quot;</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordflow">if</span> (restart_from_file == undefined) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      snapshotnext = 0</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      slicenext    = 0</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      collapsenext = 0</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="keywordflow">if</span> (firstprocess) &amp;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;           <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Please restart from a snapshot when firstprocess=T&quot;</span>)</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="keywordflow">if</span> (convert) &amp;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;           <span class="keyword">call </span>mpistop(<span class="stringliteral">&#39;Change convert to .false. for a new run!&#39;</span>)</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keywordflow">if</span> (small_pressure &lt; 0.d0) <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;small_pressure should be positive.&quot;</span>)</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">if</span> (small_density &lt; 0.d0) <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;small_density should be positive.&quot;</span>)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="comment">! Give priority to non-zero small temperature</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <span class="keywordflow">if</span> (small_temperature&gt;0.d0) small_pressure=small_density*small_temperature</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160; </div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordflow">if</span>(convert) autoconvert=.false.</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">where</span> (tsave_log &lt; bigdouble) tsave(:, 1) = tsave_log</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">where</span> (tsave_dat &lt; bigdouble) tsave(:, 2) = tsave_dat</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">where</span> (tsave_slice &lt; bigdouble) tsave(:, 3) = tsave_slice</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">where</span> (tsave_collapsed &lt; bigdouble) tsave(:, 4) = tsave_collapsed</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="keywordflow">where</span> (tsave_custom &lt; bigdouble) tsave(:, 5) = tsave_custom</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160; </div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">if</span> (dtsave_log &lt; bigdouble) dtsave(1) = dtsave_log</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">if</span> (dtsave_dat &lt; bigdouble) dtsave(2) = dtsave_dat</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="keywordflow">if</span> (dtsave_slice &lt; bigdouble) dtsave(3) = dtsave_slice</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keywordflow">if</span> (dtsave_collapsed &lt; bigdouble) dtsave(4) = dtsave_collapsed</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordflow">if</span> (dtsave_custom &lt; bigdouble) dtsave(5) = dtsave_custom</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keywordflow">if</span> (tsavestart_log &lt; bigdouble) tsavestart(1) = tsavestart_log</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keywordflow">if</span> (tsavestart_dat &lt; bigdouble) tsavestart(2) = tsavestart_dat</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordflow">if</span> (tsavestart_slice &lt; bigdouble) tsavestart(3) = tsavestart_slice</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="keywordflow">if</span> (tsavestart_collapsed &lt; bigdouble) tsavestart(4) = tsavestart_collapsed</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="keywordflow">if</span> (tsavestart_custom &lt; bigdouble) tsavestart(5) = tsavestart_custom</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">if</span> (ditsave_log &lt; bigdouble) ditsave(1) = ditsave_log</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="keywordflow">if</span> (ditsave_dat &lt; bigdouble) ditsave(2) = ditsave_dat</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keywordflow">if</span> (ditsave_slice &lt; bigdouble) ditsave(3) = ditsave_slice</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordflow">if</span> (ditsave_collapsed &lt; bigdouble) ditsave(4) = ditsave_collapsed</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordflow">if</span> (ditsave_custom &lt; bigdouble) ditsave(5) = ditsave_custom</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="comment">! convert hours to seconds for ending wall time</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">if</span> (wall_time_max &lt; bigdouble) wall_time_max=wall_time_max*3600.d0</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160; </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keywordflow">if</span> (mype == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;       <span class="keyword">write</span>(unitterm, *) <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;       <span class="keyword">write</span>(unitterm, *) <span class="stringliteral">&#39;Output type | tsavestart |  dtsave   | ditsave | itsave(1) | tsave(1)&#39;</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;       <span class="keyword">write</span>(fmt_string, *) <span class="stringliteral">&#39;(A12,&quot; | &quot;,E9.3E2,&quot;  | &quot;,E9.3E2,&quot; | &quot;,I6,&quot;  | &quot;&#39;</span>//&amp;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <span class="stringliteral">&#39;,I6, &quot;    | &quot;,E9.3E2)&#39;</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordflow">do</span> ifile = 1, nfile</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;       <span class="keywordflow">if</span> (mype == 0) <span class="keyword">write</span>(unitterm, fmt_string) trim(output_names(ifile)), &amp;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            tsavestart(ifile), dtsave(ifile), ditsave(ifile), itsave(1, ifile), tsave(1, ifile)</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordflow">if</span> (mype == 0) <span class="keyword">write</span>(unitterm, *) <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160; </div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">do</span> islice=1,nslices</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;       <span class="keywordflow">if</span>(slicedir(islice) &gt; ndim) &amp;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            <span class="keyword">write</span>(uniterr,*)<span class="stringliteral">&#39;Warning in read_par_files: &#39;</span>, &amp;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            <span class="stringliteral">&#39;Slice &#39;</span>, islice,<span class="stringliteral">&#39; direction&#39;</span>,slicedir(islice),<span class="stringliteral">&#39;larger than ndim=&#39;</span>,ndim</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;       <span class="keywordflow">if</span>(slicedir(islice) &lt; 1) &amp;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="keyword">write</span>(uniterr,*)<span class="stringliteral">&#39;Warning in read_par_files: &#39;</span>, &amp;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <span class="stringliteral">&#39;Slice &#39;</span>, islice,<span class="stringliteral">&#39; direction&#39;</span>,slicedir(islice),<span class="stringliteral">&#39;too small, should be [&#39;</span>,1,ndim,<span class="stringliteral">&#39;]&#39;</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    <span class="keywordflow">if</span>(it_max==biginteger .and. time_max==bigdouble.and.mype==0) <span class="keyword">write</span>(uniterr,*) &amp;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;         <span class="stringliteral">&#39;Warning in read_par_files: it_max or time_max not given!&#39;</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keywordflow">select case</span> (typecourant)</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&#39;maxsum&#39;</span>)</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      type_courant=type_maxsum</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&#39;summax&#39;</span>)</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      type_courant=type_summax</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&#39;minimum&#39;</span>)</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      type_courant=type_minimum</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="keywordflow">    case default</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;       <span class="keyword">write</span>(unitterm,*)<span class="stringliteral">&#39;Unknown typecourant=&#39;</span>,typecourant</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;       <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Error from read_par_files: no such typecourant!&quot;</span>)</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="keywordflow">    end select</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160; </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <span class="keywordflow">do</span> level=1,nlevelshi</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;       <span class="keywordflow">select case</span> (flux_scheme(level))</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;hll&#39;</span>)</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;          flux_method(level)=fs_hll</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;hllc&#39;</span>)</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;          flux_method(level)=fs_hllc</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;hlld&#39;</span>)</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;          flux_method(level)=fs_hlld</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;hllcd&#39;</span>)</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;          flux_method(level)=fs_hllcd</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;tvdlf&#39;</span>)</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;          flux_method(level)=fs_tvdlf</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;tvdmu&#39;</span>)</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;          flux_method(level)=fs_tvdmu</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;tvd&#39;</span>)</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;          flux_method(level)=fs_tvd</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;cd&#39;</span>)</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;          flux_method(level)=fs_cd</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;cd4&#39;</span>)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;          flux_method(level)=fs_cd4</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;fd&#39;</span>)</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;          flux_method(level)=fs_fd</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;source&#39;</span>)</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;          flux_method(level)=fs_source</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;nul&#39;</span>,<span class="stringliteral">&#39;null&#39;</span>)</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;          flux_method(level)=fs_nul</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="keywordflow">       case default</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;          <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;unkown or bad flux scheme&quot;</span>)</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="keywordflow">       end select</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;       <span class="keywordflow">if</span>(flux_scheme(level)==<span class="stringliteral">&#39;tvd&#39;</span>.and.time_stepper/=<span class="stringliteral">&#39;onestep&#39;</span>) &amp;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot; tvd is onestep method, reset time_stepper=&#39;onestep&#39;&quot;</span>)</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;       <span class="keywordflow">if</span>(flux_scheme(level)==<span class="stringliteral">&#39;tvd&#39;</span>)<span class="keywordflow">then</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;          <span class="keywordflow">if</span>(mype==0.and.(.not.dimsplit)) <span class="keyword">write</span>(unitterm,*) &amp;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;               <span class="stringliteral">&#39;Warning: setting dimsplit=T for tvd, as used for level=&#39;</span>,level</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;          dimsplit=.true.</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;       <span class="keywordflow">if</span>(flux_scheme(level)==<span class="stringliteral">&#39;hlld&#39;</span>.and.physics_type/=<span class="stringliteral">&#39;mhd&#39;</span> .and. physics_type/=<span class="stringliteral">&#39;twofl&#39;</span>) &amp;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;          <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Cannot use hlld flux if not using MHD or 2FL only charges physics!&quot;</span>)</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160; </div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;       <span class="keywordflow">if</span>(flux_scheme(level)==<span class="stringliteral">&#39;hllc&#39;</span>.and.physics_type==<span class="stringliteral">&#39;mf&#39;</span>) &amp;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;          <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Cannot use hllc flux if using magnetofriction physics!&quot;</span>)</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160; </div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;       <span class="keywordflow">if</span>(flux_scheme(level)==<span class="stringliteral">&#39;tvd&#39;</span>.and.physics_type==<span class="stringliteral">&#39;mf&#39;</span>) &amp;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;          <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Cannot use tvd flux if using magnetofriction physics!&quot;</span>)</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;       <span class="keywordflow">if</span>(flux_scheme(level)==<span class="stringliteral">&#39;tvdmu&#39;</span>.and.physics_type==<span class="stringliteral">&#39;mf&#39;</span>) &amp;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;          <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Cannot use tvdmu flux if using magnetofriction physics!&quot;</span>)</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160; </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;       <span class="keywordflow">if</span> (typepred1(level)==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;          <span class="keywordflow">select case</span> (flux_scheme(level))</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;          <span class="keywordflow">case</span> (<span class="stringliteral">&#39;cd&#39;</span>)</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;             typepred1(level)=fs_cd</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;          <span class="keywordflow">case</span> (<span class="stringliteral">&#39;cd4&#39;</span>)</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;             typepred1(level)=fs_cd4</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;          <span class="keywordflow">case</span> (<span class="stringliteral">&#39;fd&#39;</span>)</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;             typepred1(level)=fs_fd</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;          <span class="keywordflow">case</span> (<span class="stringliteral">&#39;tvdlf&#39;</span>,<span class="stringliteral">&#39;tvdmu&#39;</span>)</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;             typepred1(level)=fs_hancock</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;          <span class="keywordflow">case</span> (<span class="stringliteral">&#39;hll&#39;</span>)</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;             typepred1(level)=fs_hll</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;          <span class="keywordflow">case</span> (<span class="stringliteral">&#39;hllc&#39;</span>)</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;             typepred1(level)=fs_hllc</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;          <span class="keywordflow">case</span> (<span class="stringliteral">&#39;hllcd&#39;</span>)</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;             typepred1(level)=fs_hllcd</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;          <span class="keywordflow">case</span> (<span class="stringliteral">&#39;hlld&#39;</span>)</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;             typepred1(level)=fs_hlld</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;          <span class="keywordflow">case</span> (<span class="stringliteral">&#39;nul&#39;</span>,<span class="stringliteral">&#39;source&#39;</span>,<span class="stringliteral">&#39;tvd&#39;</span>)</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;             typepred1(level)=fs_nul</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="keywordflow">          case default</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;             <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;No default predictor for this full step&quot;</span>)</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="keywordflow">          end select</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160; </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="comment">! finite difference scheme fd need global maximal speed</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordflow">if</span>(any(flux_scheme==<span class="stringliteral">&#39;fd&#39;</span>)) need_global_cmax=.true.</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="keywordflow">if</span>(any(limiter==<span class="stringliteral">&#39;schmid1&#39;</span>)) need_global_a2max=.true.</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="comment">! initialize type_curl</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;     <span class="keywordflow">select case</span> (typecurl)</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;     <span class="keywordflow">case</span> (<span class="stringliteral">&quot;central&quot;</span>)</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        type_curl=central</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;     <span class="keywordflow">case</span> (<span class="stringliteral">&quot;Gaussbased&quot;</span>)</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        type_curl=gaussbased</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;     <span class="keywordflow">case</span> (<span class="stringliteral">&quot;Stokesbased&quot;</span>)</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        type_curl=stokesbased</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="keywordflow">     case default</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        <span class="keyword">write</span>(unitterm,*) <span class="stringliteral">&quot;typecurl=&quot;</span>,typecurl</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;unkown type of curl operator in read_par_files&quot;</span>)</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="keywordflow">     end select</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="comment">! initialize types of time stepper and time integrator</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keywordflow">select case</span> (time_stepper)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&quot;onestep&quot;</span>)</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;       t_stepper=onestep</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;       nstep=1</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;       <span class="keywordflow">if</span> (time_integrator==<span class="stringliteral">&#39;default&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;          time_integrator=<span class="stringliteral">&quot;Forward_Euler&quot;</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;       <span class="keywordflow">select case</span> (time_integrator)</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;Forward_Euler&quot;</span>)</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;          t_integrator=forward_euler</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;IMEX_Euler&quot;</span>)</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;          t_integrator=imex_euler</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;IMEX_SP&quot;</span>)</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;          t_integrator=imex_sp</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="keywordflow">       case default</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;          <span class="keyword">write</span>(unitterm,*) <span class="stringliteral">&quot;time_integrator=&quot;</span>,time_integrator,<span class="stringliteral">&quot;time_stepper=&quot;</span>,time_stepper</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;          <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;unkown onestep time_integrator in read_par_files&quot;</span>)</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="keywordflow">       end select</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;       use_imex_scheme=(t_integrator==imex_euler.or.t_integrator==imex_sp)</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&quot;twostep&quot;</span>)</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;       t_stepper=twostep</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;       nstep=2</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;       <span class="keywordflow">if</span> (time_integrator==<span class="stringliteral">&#39;default&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;          time_integrator=<span class="stringliteral">&quot;Predictor_Corrector&quot;</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;       <span class="keywordflow">select case</span> (time_integrator)</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;Predictor_Corrector&quot;</span>)</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;          t_integrator=predictor_corrector</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;RK2_alfa&quot;</span>)</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;          t_integrator=rk2_alf</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;ssprk2&quot;</span>)</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;          t_integrator=ssprk2</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;IMEX_Midpoint&quot;</span>)</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;          t_integrator=imex_midpoint</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;IMEX_Trapezoidal&quot;</span>)</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;          t_integrator=imex_trapezoidal</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;IMEX_222&quot;</span>)</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;          t_integrator=imex_222</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="keywordflow">       case default</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;          <span class="keyword">write</span>(unitterm,*) <span class="stringliteral">&quot;time_integrator=&quot;</span>,time_integrator,<span class="stringliteral">&quot;time_stepper=&quot;</span>,time_stepper</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;          <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;unkown twostep time_integrator in read_par_files&quot;</span>)</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="keywordflow">       end select</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;       use_imex_scheme=(t_integrator==imex_midpoint.or.t_integrator==imex_trapezoidal&amp;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            .or.t_integrator==imex_222)</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;       <span class="keywordflow">if</span> (t_integrator==rk2_alf) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;          <span class="keywordflow">if</span>(rk2_alfa&lt;smalldouble.or.rk2_alfa&gt;one)<span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;set rk2_alfa within [0,1]&quot;</span>)</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;          rk_a21=rk2_alfa </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;          rk_b2=1.0d0/(2.0d0*rk2_alfa)</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;          rk_b1=1.0d0-rk_b2</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&quot;threestep&quot;</span>)</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;       t_stepper=threestep</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;       nstep=3</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;       <span class="keywordflow">if</span> (time_integrator==<span class="stringliteral">&#39;default&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;          time_integrator=<span class="stringliteral">&#39;ssprk3&#39;</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;       <span class="keywordflow">select case</span> (time_integrator)</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;ssprk3&quot;</span>)</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;          t_integrator=ssprk3</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;RK3_BT&quot;</span>)</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;          t_integrator=rk3_bt</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;IMEX_ARS3&quot;</span>)</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;          t_integrator=imex_ars3</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;IMEX_232&quot;</span>)</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;          t_integrator=imex_232</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;IMEX_CB3a&quot;</span>)</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;          t_integrator=imex_cb3a</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="keywordflow">       case default</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;          <span class="keyword">write</span>(unitterm,*) <span class="stringliteral">&quot;time_integrator=&quot;</span>,time_integrator,<span class="stringliteral">&quot;time_stepper=&quot;</span>,time_stepper</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;          <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;unkown threestep time_integrator in read_par_files&quot;</span>)</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="keywordflow">       end select</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;       <span class="keywordflow">if</span>(t_integrator==rk3_bt) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;           <span class="keywordflow">select case</span>(rk3_switch)</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;             <span class="keywordflow">case</span>(1) </div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;              <span class="comment">! we code up Ralston 3rd order here</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;              rk3_a21=1.0d0/2.0d0</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;              rk3_a31=0.0d0</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;              rk3_a32=3.0d0/4.0d0</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;              rk3_b1=2.0d0/9.0d0</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;              rk3_b2=1.0d0/3.0d0</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;             <span class="keywordflow">case</span>(2) </div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;              <span class="comment">! we code up RK-Wray 3rd order here</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;              rk3_a21=8.0d0/15.0d0</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;              rk3_a31=1.0d0/4.0d0</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;              rk3_a32=5.0d0/12.0d0</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;              rk3_b1=1.0d0/4.0d0</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;              rk3_b2=0.0d0</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;             <span class="keywordflow">case</span>(3) </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;              <span class="comment">! we code up Heun 3rd order here</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;              rk3_a21=1.0d0/3.0d0</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;              rk3_a31=0.0d0</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;              rk3_a32=2.0d0/3.0d0</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;              rk3_b1=1.0d0/4.0d0</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;              rk3_b2=0.0d0</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;             <span class="keywordflow">case</span>(4) </div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;              <span class="comment">! we code up Nystrom 3rd order here</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;              rk3_a21=2.0d0/3.0d0</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;              rk3_a31=0.0d0</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;              rk3_a32=2.0d0/3.0d0</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;              rk3_b1=1.0d0/4.0d0</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;              rk3_b2=3.0d0/8.0d0</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="keywordflow">             case default</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Unknown rk3_switch&quot;</span>)</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="keywordflow">            end select</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;           <span class="comment">! the rest is fixed from above</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;           rk3_b3=1.0d0-rk3_b1-rk3_b2</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;           rk3_c2=rk3_a21</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;           rk3_c3=rk3_a31+rk3_a32</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;       <span class="keywordflow">if</span>(t_integrator==ssprk3) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;         <span class="keywordflow">select case</span>(ssprk_order)</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;             <span class="keywordflow">case</span>(3) <span class="comment">! this is SSPRK(3,3) Gottlieb-Shu</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                rk_beta11=1.0d0</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                rk_beta22=1.0d0/4.0d0</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                rk_beta33=2.0d0/3.0d0</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                rk_alfa21=3.0d0/4.0d0</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                rk_alfa31=1.0d0/3.0d0</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                rk_c2=1.0d0</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                rk_c3=1.0d0/2.0d0</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;             <span class="keywordflow">case</span>(2) <span class="comment">! this is SSP(3,2)</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                rk_beta11=1.0d0/2.0d0</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                rk_beta22=1.0d0/2.0d0</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                rk_beta33=1.0d0/3.0d0</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                rk_alfa21=0.0d0</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                rk_alfa31=1.0d0/3.0d0</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                rk_c2=1.0d0/2.0d0</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                rk_c3=1.0d0</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="keywordflow">             case default</span></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Unknown ssprk3_order&quot;</span>)</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="keywordflow">         end select</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;         rk_alfa22=1.0d0-rk_alfa21</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;         rk_alfa33=1.0d0-rk_alfa31</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;       <span class="keywordflow">if</span>(t_integrator==imex_ars3) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;          ars_gamma=(3.0d0+dsqrt(3.0d0))/6.0d0</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;       <span class="keywordflow">if</span>(t_integrator==imex_232) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;           <span class="keywordflow">select case</span>(imex_switch)</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;             <span class="keywordflow">case</span>(1) <span class="comment">! this is IMEX_ARK(232)</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;              im_delta=1.0d0-1.0d0/dsqrt(2.0d0)</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;              im_nu=(3.0d0+2.0d0*dsqrt(2.0d0))/6.0d0</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;              imex_a21=2.0d0*im_delta</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;              imex_a31=1.0d0-im_nu</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;              imex_a32=im_nu</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;              imex_b1=1.0d0/(2.0d0*dsqrt(2.0d0))</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;              imex_b2=1.0d0/(2.0d0*dsqrt(2.0d0))</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;              imex_ha21=im_delta</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;              imex_ha22=im_delta</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;             <span class="keywordflow">case</span>(2) <span class="comment">! this is IMEX_SSP(232)</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;              <span class="comment">! doi 10.1002/2017MS001065 Rokhzadi et al</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;              imex_a21=0.711664700366941d0</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;              imex_a31=0.077338168947683d0</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;              imex_a32=0.917273367886007d0</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;              imex_b1=0.398930808264688d0</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;              imex_b2=0.345755244189623d0</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;              imex_ha21=0.353842865099275d0</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;              imex_ha22=0.353842865099275d0</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="keywordflow">             case default</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Unknown imex_siwtch&quot;</span>)</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="keywordflow">           end select</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;           imex_c2=imex_a21</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;           imex_c3=imex_a31+imex_a32</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;           imex_b3=1.0d0-imex_b1-imex_b2</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;       <span class="keywordflow">if</span>(t_integrator==imex_cb3a) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;          imex_c2   = 0.8925502329346865</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;          imex_a22  = imex_c2</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;          imex_ha21 = imex_c2</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;          imex_c3   = imex_c2 / (6.0d0*imex_c2**2 - 3.0d0*imex_c2 + 1.0d0)</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;          imex_ha32 = imex_c3</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;          imex_b2   = (3.0d0*imex_c2 - 1.0d0) / (6.0d0*imex_c2**2)</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;          imex_b3   = (6.0d0*imex_c2**2 - 3.0d0*imex_c2 + 1.0d0) / (6.0d0*imex_c2**2)</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;          imex_a33  = (1.0d0/6.0d0 - imex_b2*imex_c2**2 - imex_b3*imex_c2*imex_c3) / (imex_b3*(imex_c3-imex_c2))</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;          imex_a32  = imex_c3 - imex_a33</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;          <span class="comment">! if (mype == 0) then</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;          <span class="comment">!    write(*,*) &quot;=================================&quot;</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;          <span class="comment">!    write(*,*) &quot;Asserting the order conditions...&quot;</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;          <span class="comment">!    ! First order convergence: OK</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;          <span class="comment">!    ! Second order convergence</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;          <span class="comment">!    write(*,*) -1.0d0/2.0d0 + imex_b2*imex_c2 + imex_b3*imex_c3</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;          <span class="comment">!    ! Third order convergence</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;          <span class="comment">!    write(*,*) -1.0d0/3.0d0 + imex_b2*imex_c2**2 + imex_b3*imex_c3**2</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;          <span class="comment">!    write(*,*) -1.0d0/6.0d0 + imex_b3*imex_ha32*imex_c2</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;          <span class="comment">!    write(*,*) -1.0d0/6.0d0 + imex_b2*imex_a22*imex_c2 + imex_b3*imex_a32*imex_c2 + imex_b3*imex_a33*imex_c3</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;          <span class="comment">!    write(*,*) &quot;=================================&quot;</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;          <span class="comment">! end if</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;       use_imex_scheme=(t_integrator==imex_ars3.or.t_integrator==imex_232.or.t_integrator==imex_cb3a)</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&quot;fourstep&quot;</span>)</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;       t_stepper=fourstep</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;       nstep=4</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;       <span class="keywordflow">if</span> (time_integrator==<span class="stringliteral">&#39;default&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;          time_integrator=<span class="stringliteral">&quot;ssprk4&quot;</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;       <span class="keywordflow">select case</span> (time_integrator)</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;ssprk4&quot;</span>)</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;          t_integrator=ssprk4</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;rk4&quot;</span>)</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;          t_integrator=rk4</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="keywordflow">       case default</span></div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;          <span class="keyword">write</span>(unitterm,*) <span class="stringliteral">&quot;time_integrator=&quot;</span>,time_integrator,<span class="stringliteral">&quot;time_stepper=&quot;</span>,time_stepper</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;          <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;unkown fourstep time_integrator in read_par_files&quot;</span>)</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="keywordflow">       end select</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;       <span class="keywordflow">if</span>(t_integrator==ssprk4) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;         <span class="keywordflow">select case</span>(ssprk_order)</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;             <span class="keywordflow">case</span>(3) <span class="comment">! this is SSPRK(4,3) Spireti-Ruuth</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                rk_beta11=1.0d0/2.0d0</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                rk_beta22=1.0d0/2.0d0</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                rk_beta33=1.0d0/6.0d0</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                rk_beta44=1.0d0/2.0d0</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                rk_alfa21=0.0d0</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                rk_alfa31=2.0d0/3.0d0</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                rk_alfa41=0.0d0</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                rk_c2=1.0d0/2.0d0</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                rk_c3=1.0d0</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                rk_c4=1.0d0/2.0d0</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;             <span class="keywordflow">case</span>(2) <span class="comment">! this is SSP(4,2)</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                rk_beta11=1.0d0/3.0d0</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                rk_beta22=1.0d0/3.0d0</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                rk_beta33=1.0d0/3.0d0</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                rk_beta44=1.0d0/4.0d0</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                rk_alfa21=0.0d0</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                rk_alfa31=0.0d0</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                rk_alfa41=1.0d0/4.0d0</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                rk_c2=1.0d0/3.0d0</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                rk_c3=2.0d0/3.0d0</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                rk_c4=1.0d0</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="keywordflow">             case default</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Unknown ssprk_order&quot;</span>)</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="keywordflow">         end select</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;         rk_alfa22=1.0d0-rk_alfa21</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;         rk_alfa33=1.0d0-rk_alfa31</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;         rk_alfa44=1.0d0-rk_alfa41</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&quot;fivestep&quot;</span>)</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;       t_stepper=fivestep</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;       nstep=5</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;       <span class="keywordflow">if</span> (time_integrator==<span class="stringliteral">&#39;default&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;          time_integrator=<span class="stringliteral">&quot;ssprk5&quot;</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;       <span class="keywordflow">select case</span> (time_integrator)</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&quot;ssprk5&quot;</span>)</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;          t_integrator=ssprk5</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="keywordflow">       case default</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;          <span class="keyword">write</span>(unitterm,*) <span class="stringliteral">&quot;time_integrator=&quot;</span>,time_integrator,<span class="stringliteral">&quot;time_stepper=&quot;</span>,time_stepper</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;          <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;unkown fivestep time_integrator in read_par_files&quot;</span>)</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="keywordflow">       end select</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;       <span class="keywordflow">if</span>(t_integrator==ssprk5) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;         <span class="keywordflow">select case</span>(ssprk_order)</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;           <span class="comment">! we use ssprk_order to intercompare the different coefficient choices </span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;           <span class="keywordflow">case</span>(3) <span class="comment">! From Gottlieb 2005</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;            rk_beta11=0.391752226571890d0</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;            rk_beta22=0.368410593050371d0</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            rk_beta33=0.251891774271694d0</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            rk_beta44=0.544974750228521d0</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            rk_beta54=0.063692468666290d0</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;            rk_beta55=0.226007483236906d0</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            rk_alfa21=0.444370493651235d0</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            rk_alfa31=0.620101851488403d0</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            rk_alfa41=0.178079954393132d0</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            rk_alfa53=0.517231671970585d0</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            rk_alfa54=0.096059710526147d0</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160; </div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            rk_alfa22=0.555629506348765d0</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            rk_alfa33=0.379898148511597d0</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;            rk_alfa44=0.821920045606868d0</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            rk_alfa55=0.386708617503269d0</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;            rk_alfa22=1.0d0-rk_alfa21</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;            rk_alfa33=1.0d0-rk_alfa31</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;            rk_alfa44=1.0d0-rk_alfa41</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;            rk_alfa55=1.0d0-rk_alfa53-rk_alfa54</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;            rk_c2=rk_beta11</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;            rk_c3=rk_alfa22*rk_c2+rk_beta22</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;            rk_c4=rk_alfa33*rk_c3+rk_beta33</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;            rk_c5=rk_alfa44*rk_c4+rk_beta44</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;           <span class="keywordflow">case</span>(2) <span class="comment">! From Spireti-Ruuth</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            rk_beta11=0.39175222700392d0</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            rk_beta22=0.36841059262959d0</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            rk_beta33=0.25189177424738d0</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            rk_beta44=0.54497475021237d0</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            <span class="comment">!rk_beta54=0.06369246925946d0</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            <span class="comment">!rk_beta55=0.22600748319395d0</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            rk_alfa21=0.44437049406734d0</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;            rk_alfa31=0.62010185138540d0</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;            rk_alfa41=0.17807995410773d0</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;            rk_alfa53=0.51723167208978d0</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;            <span class="comment">!rk_alfa54=0.09605971145044d0</span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160; </div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            rk_alfa22=1.0d0-rk_alfa21</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;            rk_alfa33=1.0d0-rk_alfa31</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;            rk_alfa44=1.0d0-rk_alfa41</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160; </div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;            rka51=0.00683325884039d0</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;            rka54=0.12759831133288d0</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;            rkb54=0.08460416338212d0</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;            rk_beta54=rkb54-rk_beta44*rka51/rk_alfa41</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;            rk_alfa54=rka54-rk_alfa44*rka51/rk_alfa41</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160; </div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            rk_alfa55=1.0d0-rk_alfa53-rk_alfa54</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;            rk_c2=rk_beta11</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;            rk_c3=rk_alfa22*rk_c2+rk_beta22</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;            rk_c4=rk_alfa33*rk_c3+rk_beta33</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;            rk_c5=rk_alfa44*rk_c4+rk_beta44</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;            rk_beta55=1.0d0-rk_beta54-rk_alfa53*rk_c3-rk_alfa54*rk_c4-rk_alfa55*rk_c5</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="keywordflow">           case default</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Unknown ssprk_order&quot;</span>)</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="keywordflow">         end select</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;         <span class="comment">! the following combinations must be unity</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;         <span class="comment">!print *,rk_beta55+rk_beta54+rk_alfa53*rk_c3+rk_alfa54*rk_c4+rk_alfa55*rk_c5</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;         <span class="comment">!print *,rk_alfa22+rk_alfa21</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;         <span class="comment">!print *,rk_alfa33+rk_alfa31</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;         <span class="comment">!print *,rk_alfa44+rk_alfa41</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;         <span class="comment">!print *,rk_alfa55+rk_alfa53+rk_alfa54</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="keywordflow">       endif</span></div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;       use_imex_scheme=.false.</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="keywordflow">    case default</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;       <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Unknown time_stepper in read_par_files&quot;</span>)</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="keywordflow">    end select</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160; </div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <span class="keywordflow">do</span> i = 1, ndim</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;       <span class="keywordflow">select case</span> (stretch_dim(i))</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;       <span class="keywordflow">case</span> (undefined, <span class="stringliteral">&#39;none&#39;</span>)</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;          stretch_type(i) = stretch_none</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;          stretched_dim(i) = .false.</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;uni&#39;</span>,<span class="stringliteral">&#39;uniform&#39;</span>)</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;          stretch_type(i) = stretch_uni</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;          stretched_dim(i) = .true.</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;symm&#39;</span>, <span class="stringliteral">&#39;symmetric&#39;</span>)</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;          stretch_type(i) = stretch_symm</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;          stretched_dim(i) = .true.</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="keywordflow">       case default</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;          stretch_type(i) = stretch_none</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;          stretched_dim(i) = .false.</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;          <span class="keywordflow">if</span> (mype == 0) print *, <span class="stringliteral">&#39;Got stretch_type = &#39;</span>, stretch_type(i)</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;          <span class="keyword">call </span>mpistop(<span class="stringliteral">&#39;Unknown stretch type&#39;</span>)</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="keywordflow">       end select</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160; </div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="comment">! Harmonize the parameters for dimensional splitting and source splitting</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="keywordflow">if</span>(typedimsplit   ==<span class="stringliteral">&#39;default&#39;</span>.and.     dimsplit)   typedimsplit=<span class="stringliteral">&#39;xyyx&#39;</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="keywordflow">if</span>(typedimsplit   ==<span class="stringliteral">&#39;default&#39;</span>.and..not.dimsplit)   typedimsplit=<span class="stringliteral">&#39;unsplit&#39;</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    dimsplit   = typedimsplit   /=<span class="stringliteral">&#39;unsplit&#39;</span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160; </div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <span class="comment">! initialize types of split-source addition</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <span class="keywordflow">select case</span> (typesourcesplit)</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&#39;sfs&#39;</span>)</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;      sourcesplit=sourcesplit_sfs</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&#39;sf&#39;</span>)</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      sourcesplit=sourcesplit_sf</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&#39;ssf&#39;</span>)</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;      sourcesplit=sourcesplit_ssf</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="keywordflow">case</span> (<span class="stringliteral">&#39;ssfss&#39;</span>)</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      sourcesplit=sourcesplit_ssfss</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="keywordflow">    case default</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;       <span class="keyword">write</span>(unitterm,*)<span class="stringliteral">&#39;No such typesourcesplit=&#39;</span>,typesourcesplit</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;       <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Error: Unknown typesourcesplit!&quot;</span>)</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="keywordflow">    end select</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160; </div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    <span class="keywordflow">if</span>(coordinate==-1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      coordinate=cartesian</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      <span class="keywordflow">if</span>(mype==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Warning: coordinate system is not specified!&#39;</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;call set_coordinate_system in usr_init in mod_usr.t&#39;</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Now use Cartesian coordinate&#39;</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160; </div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="keywordflow">if</span>(coordinate==cartesian) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      slab=.true.</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      slab_uniform=.true.</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      <span class="keywordflow">if</span>(any(stretched_dim)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        coordinate=cartesian_stretched</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        slab_uniform=.false.</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      slab=.false.</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      slab_uniform=.false.</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160; </div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordflow">if</span>(coordinate==spherical) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      <span class="keywordflow">if</span>(dimsplit) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        <span class="keywordflow">if</span>(mype==0)print *,<span class="stringliteral">&#39;Warning: spherical symmetry needs dimsplit=F, resetting&#39;</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        dimsplit=.false.</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160; </div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="keywordflow">if</span> (ndim==1) dimsplit=.false.</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160; </div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="comment">! type limiter of prolongation</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="keywordflow">select case</span>(typeprolonglimit)</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="keywordflow">case</span>(<span class="stringliteral">&#39;unlimit&#39;</span>)</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      <span class="comment">! unlimited</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      prolong_limiter=1</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="keywordflow">case</span>(<span class="stringliteral">&#39;minmod&#39;</span>)</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      prolong_limiter=2</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    <span class="keywordflow">case</span>(<span class="stringliteral">&#39;woodward&#39;</span>)</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      prolong_limiter=3</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="keywordflow">case</span>(<span class="stringliteral">&#39;koren&#39;</span>)</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      prolong_limiter=4</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="keywordflow">    case default</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      prolong_limiter=0</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="keywordflow">    end select</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160; </div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="comment">! Type limiter is of integer type for performance</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    <span class="keyword">allocate</span>(type_limiter(nlevelshi))</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    <span class="keyword">allocate</span>(type_gradient_limiter(nlevelshi))</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160; </div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    <span class="keywordflow">do</span> level=1,nlevelshi</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;       type_limiter(level) = limiter_type(limiter(level))</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;       type_gradient_limiter(level) = limiter_type(gradient_limiter(level))</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160; </div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="keywordflow">if</span> (any(limiter(1:nlevelshi)== <span class="stringliteral">&#39;ppm&#39;</span>)&amp;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;         .and.(flatsh.and.physics_type==<span class="stringliteral">&#39;rho&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;       <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot; PPM with flatsh=.true. can not be used with physics_type=&#39;rho&#39;!&quot;</span>)</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160; </div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <span class="comment">! Copy boundary conditions to typeboundary, which is used internally</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    {</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <span class="keywordflow">do</span> iw=1,nwfluxbc</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      <span class="keywordflow">select case</span>(typeboundary_min^d(iw))</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;special&quot;</span>)</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;        typeboundary(iw,2*^d-1)=bc_special</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;cont&quot;</span>)</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        typeboundary(iw,2*^d-1)=bc_cont</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;symm&quot;</span>)</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;        typeboundary(iw,2*^d-1)=bc_symm</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;asymm&quot;</span>)</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;        typeboundary(iw,2*^d-1)=bc_asymm</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;periodic&quot;</span>)</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;        typeboundary(iw,2*^d-1)=bc_periodic</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;aperiodic&quot;</span>)</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        typeboundary(iw,2*^d-1)=bc_aperiodic</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;noinflow&quot;</span>)</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        typeboundary(iw,2*^d-1)=bc_noinflow</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;pole&quot;</span>)</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        typeboundary(iw,2*^d-1)=12</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;bc_data&quot;</span>)</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;        typeboundary(iw,2*^d-1)=bc_data</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;bc_icarus&quot;</span>)</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;        typeboundary(iw,2*^d-1)=bc_icarus</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;character&quot;</span>)</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        typeboundary(iw,2*^d-1)=bc_character</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="keywordflow">      case default</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;         <span class="keyword">write</span> (unitterm,*) <span class="stringliteral">&quot;Undefined boundarytype found in read_par_files&quot;</span>, &amp;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;           typeboundary_min^d(iw),<span class="stringliteral">&quot;for variable iw=&quot;</span>,iw,<span class="stringliteral">&quot; and side iB=&quot;</span>,2*^d-1</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="keywordflow">      end select</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    <span class="keywordflow">do</span> iw=1,nwfluxbc</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      <span class="keywordflow">select case</span>(typeboundary_max^d(iw))</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;special&quot;</span>)</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;        typeboundary(iw,2*^d)=bc_special</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;cont&quot;</span>)</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;        typeboundary(iw,2*^d)=bc_cont</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;symm&quot;</span>)</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;        typeboundary(iw,2*^d)=bc_symm</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;asymm&quot;</span>)</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        typeboundary(iw,2*^d)=bc_asymm</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;periodic&quot;</span>)</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        typeboundary(iw,2*^d)=bc_periodic</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;aperiodic&quot;</span>)</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        typeboundary(iw,2*^d)=bc_aperiodic</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;noinflow&quot;</span>)</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        typeboundary(iw,2*^d)=bc_noinflow</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;pole&quot;</span>)</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        typeboundary(iw,2*^d)=12</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;bc_data&quot;</span>)</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        typeboundary(iw,2*^d)=bc_data</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;bc_icarus&quot;</span>)</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        typeboundary(iw,2*^d-1)=bc_icarus</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      <span class="keywordflow">case</span>(<span class="stringliteral">&quot;bc_character&quot;</span>)</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        typeboundary(iw,2*^d)=bc_character</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="keywordflow">      case default</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;         <span class="keyword">write</span> (unitterm,*) <span class="stringliteral">&quot;Undefined boundarytype found in read_par_files&quot;</span>, &amp;</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;           typeboundary_max^d(iw),<span class="stringliteral">&quot;for variable iw=&quot;</span>,iw,<span class="stringliteral">&quot; and side iB=&quot;</span>,2*^d</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="keywordflow">      end select</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    }</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160; </div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <span class="comment">! psi, tracers take the same boundary type as the first variable</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="keywordflow">if</span> (nwfluxbc&lt;nwflux) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      <span class="keywordflow">do</span> iw = nwfluxbc+1, nwflux</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        typeboundary(iw,:) = typeboundary(1, :)</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="comment">! auxiliary variables take the same boundary type as the first variable</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <span class="keywordflow">if</span> (nwaux&gt;0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      <span class="keywordflow">do</span> iw = nwflux+1, nwflux+nwaux</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        typeboundary(iw,:) = typeboundary(1, :)</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160; </div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="keywordflow">if</span> (any(typeboundary == 0)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Not all boundary conditions have been defined&quot;</span>)</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160; </div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="keywordflow">do</span> idim=1,ndim</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;       periodb(idim)=(any(typeboundary(:,2*idim-1:2*idim)==bc_periodic))</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;       aperiodb(idim)=(any(typeboundary(:,2*idim-1:2*idim)==bc_aperiodic))</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;       <span class="keywordflow">if</span> (periodb(idim).or.aperiodb(idim)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;          <span class="keywordflow">do</span> iw=1,nwflux</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;             <span class="keywordflow">if</span> (typeboundary(iw,2*idim-1) .ne. typeboundary(iw,2*idim)) &amp;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;                  <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Wrong counterpart in periodic boundary&quot;</span>)</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160; </div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;             <span class="keywordflow">if</span> (typeboundary(iw,2*idim-1) /= bc_periodic .and. &amp;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                  typeboundary(iw,2*idim-1) /= bc_aperiodic) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;               <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Each dimension should either have all &quot;</span>//&amp;</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                    <span class="stringliteral">&quot;or no variables periodic, some can be aperiodic&quot;</span>)</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="keywordflow">             end if</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    {^nooned</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="keywordflow">do</span> idim=1,ndim</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;      <span class="keywordflow">if</span>(any(typeboundary(:,2*idim-1)==12)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;        <span class="keywordflow">if</span>(any(typeboundary(:,2*idim-1)/=12)) typeboundary(:,2*idim-1)=12</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;        <span class="keywordflow">if</span>(phys_energy) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;          windex=2</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;          windex=1</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        typeboundary(:,2*idim-1)=bc_symm</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        <span class="keywordflow">if</span>(physics_type/=<span class="stringliteral">&#39;rho&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;          <span class="keywordflow">select case</span>(coordinate)</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;          <span class="keywordflow">case</span>(cylindrical)</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;            typeboundary(phi_+1,2*idim-1)=bc_asymm</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;            <span class="keywordflow">if</span>(physics_type==<span class="stringliteral">&#39;mhd&#39;</span>) typeboundary(ndir+windex+phi_,2*idim-1)=bc_asymm</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;          <span class="keywordflow">case</span>(spherical)</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;            typeboundary(3:ndir+1,2*idim-1)=bc_asymm</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;            <span class="keywordflow">if</span>(physics_type==<span class="stringliteral">&#39;mhd&#39;</span>) typeboundary(ndir+windex+2:ndir+windex+ndir,2*idim-1)=bc_asymm</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="keywordflow">          case default</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;            <span class="keyword">call </span>mpistop(<span class="stringliteral">&#39;Pole is in cylindrical, polar, spherical coordinates!&#39;</span>)</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="keywordflow">          end select</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;      <span class="keywordflow">if</span>(any(typeboundary(:,2*idim)==12)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        <span class="keywordflow">if</span>(any(typeboundary(:,2*idim)/=12)) typeboundary(:,2*idim)=12</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        <span class="keywordflow">if</span>(phys_energy) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;          windex=2</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;          windex=1</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        typeboundary(:,2*idim)=bc_symm</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;        <span class="keywordflow">if</span>(physics_type/=<span class="stringliteral">&#39;rho&#39;</span>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        <span class="keywordflow">select case</span>(coordinate)</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        <span class="keywordflow">case</span>(cylindrical)</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;          typeboundary(phi_+1,2*idim)=bc_asymm</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;          <span class="keywordflow">if</span>(physics_type==<span class="stringliteral">&#39;mhd&#39;</span>) typeboundary(ndir+windex+phi_,2*idim)=bc_asymm</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        <span class="keywordflow">case</span>(spherical)</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;          typeboundary(3:ndir+1,2*idim)=bc_asymm</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;          <span class="keywordflow">if</span>(physics_type==<span class="stringliteral">&#39;mhd&#39;</span>) typeboundary(ndir+windex+2:ndir+windex+ndir,2*idim)=bc_asymm</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="keywordflow">        case default</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;          <span class="keyword">call </span>mpistop(<span class="stringliteral">&#39;Pole is in cylindrical, polar, spherical coordinates!&#39;</span>)</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="keywordflow">        end select</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    }</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160; </div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    <span class="keywordflow">if</span>(.not.phys_energy) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;      flatcd=.false.</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;      flatsh=.false.</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160; </div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="keywordflow">if</span>(any(limiter(1:nlevelshi)==<span class="stringliteral">&#39;mp5&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;      nghostcells=max(nghostcells,3)</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160; </div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    <span class="keywordflow">if</span>(any(limiter(1:nlevelshi)==<span class="stringliteral">&#39;weno5&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      nghostcells=max(nghostcells,3)</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160; </div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    <span class="keywordflow">if</span>(any(limiter(1:nlevelshi)==<span class="stringliteral">&#39;weno5nm&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      nghostcells=max(nghostcells,3)</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160; </div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <span class="keywordflow">if</span>(any(limiter(1:nlevelshi)==<span class="stringliteral">&#39;wenoz5&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      nghostcells=max(nghostcells,3)</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160; </div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    <span class="keywordflow">if</span>(any(limiter(1:nlevelshi)==<span class="stringliteral">&#39;wenoz5nm&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      nghostcells=max(nghostcells,3)</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160; </div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="keywordflow">if</span>(any(limiter(1:nlevelshi)==<span class="stringliteral">&#39;wenozp5&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;      nghostcells=max(nghostcells,3)</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160; </div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordflow">if</span>(any(limiter(1:nlevelshi)==<span class="stringliteral">&#39;wenozp5nm&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      nghostcells=max(nghostcells,3)</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160; </div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <span class="keywordflow">if</span>(any(limiter(1:nlevelshi)==<span class="stringliteral">&#39;teno5ad&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      nghostcells=max(nghostcells,3)</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160; </div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordflow">if</span>(any(limiter(1:nlevelshi)==<span class="stringliteral">&#39;weno5cu6&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;      nghostcells=max(nghostcells,3)</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160; </div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="keywordflow">if</span>(any(limiter(1:nlevelshi)==<span class="stringliteral">&#39;ppm&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      <span class="keywordflow">if</span>(flatsh .or. flatcd) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        nghostcells=max(nghostcells,4)</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        nghostcells=max(nghostcells,3)</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160; </div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keywordflow">if</span>(any(limiter(1:nlevelshi)==<span class="stringliteral">&#39;weno7&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      nghostcells=max(nghostcells,4)</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160; </div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    <span class="keywordflow">if</span>(any(limiter(1:nlevelshi)==<span class="stringliteral">&#39;mpweno7&#39;</span>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;      nghostcells=max(nghostcells,4)</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160; </div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="comment">! If a wider stencil is used, extend the number of ghost cells</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    nghostcells = nghostcells + phys_wider_stencil</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160; </div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <span class="comment">! prolongation in AMR for constrained transport MHD needs even number ghosts</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    <span class="keywordflow">if</span>(stagger_grid .and. refine_max_level&gt;1 .and. mod(nghostcells,2)/=0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      nghostcells=nghostcells+1</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160; </div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;      <span class="keywordflow">select case</span> (coordinate)</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;         {^nooned</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      <span class="keywordflow">case</span> (spherical)</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;         xprob^lim^de=xprob^lim^de*two*dpi;</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;         \}</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      <span class="keywordflow">case</span> (cylindrical)</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;         {</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;         <span class="keywordflow">if</span> (^d==phi_) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;            xprob^lim^d=xprob^lim^d*two*dpi;</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="keywordflow">         end if</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;         \}</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="keywordflow">      end select</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160; </div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    <span class="comment">! full block size including ghostcells</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    {ixghi^d = block_nx^d + 2*nghostcells\}</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    {ixgshi^d = ixghi^d\}</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160; </div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    nx_vec = [{domain_nx^d|, }]</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    block_nx_vec = [{block_nx^d|, }]</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160; </div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <span class="keywordflow">if</span> (any(nx_vec &lt; 4) .or. any(mod(nx_vec, 2) == 1)) &amp;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;         <span class="keyword">call </span>mpistop(<span class="stringliteral">&#39;Grid size (domain_nx^D) has to be even and &gt;= 4&#39;</span>)</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160; </div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    <span class="keywordflow">if</span> (any(block_nx_vec &lt; 4) .or. any(mod(block_nx_vec, 2) == 1)) &amp;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;         <span class="keyword">call </span>mpistop(<span class="stringliteral">&#39;Block size (block_nx^D) has to be even and &gt;= 4&#39;</span>)</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160; </div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    { <span class="keywordflow">if</span>(mod(domain_nx^d,block_nx^d)/=0) &amp;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;       <span class="keyword">call </span>mpistop(<span class="stringliteral">&#39;Grid (domain_nx^D) and block (block_nx^D) must be consistent&#39;</span>) \}</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160; </div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    <span class="keywordflow">if</span>(refine_max_level&gt;nlevelshi.or.refine_max_level&lt;1)<span class="keywordflow">then</span></div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;       <span class="keyword">write</span>(unitterm,*)<span class="stringliteral">&#39;Error: refine_max_level&#39;</span>,refine_max_level,<span class="stringliteral">&#39;&gt;nlevelshi &#39;</span>,nlevelshi</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;       <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Reset nlevelshi and recompile!&quot;</span>)</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160; </div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keywordflow">if</span> (any(stretched_dim)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;       <span class="keyword">allocate</span>(qstretch(0:nlevelshi,1:ndim),dxfirst(0:nlevelshi,1:ndim),&amp;</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;             dxfirst_1mq(0:nlevelshi,1:ndim),dxmid(0:nlevelshi,1:ndim))</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;       <span class="keyword">allocate</span>(nstretchedblocks(1:nlevelshi,1:ndim))</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;       qstretch(0:nlevelshi,1:ndim)=0.0d0</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;       dxfirst(0:nlevelshi,1:ndim)=0.0d0</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;       nstretchedblocks(1:nlevelshi,1:ndim)=0</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;       {<span class="keywordflow">if</span> (stretch_type(^d) == stretch_uni) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;           <span class="comment">! first some sanity checks</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;           <span class="keywordflow">if</span>(qstretch_baselevel(^d)&lt;1.0d0.or.qstretch_baselevel(^d)==bigdouble) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;             <span class="keywordflow">if</span>(mype==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;               <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;stretched grid needs finite qstretch_baselevel&gt;1&#39;</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;               <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;will try default value for qstretch_baselevel in dimension&#39;</span>, ^d</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;             <span class="keywordflow">if</span>(xprobmin^d&gt;smalldouble)<span class="keywordflow">then</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;               qstretch_baselevel(^d)=(xprobmax^d/xprobmin^d)**(1.d0/dble(domain_nx^d))</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;               <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;can not set qstretch_baselevel automatically&quot;</span>)</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="keywordflow">             endif</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;           <span class="keywordflow">if</span>(mod(block_nx^d,2)==1) &amp;</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;             <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;stretched grid needs even block size block_nxD&quot;</span>)</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;           <span class="keywordflow">if</span>(mod(domain_nx^d/block_nx^d,2)/=0) &amp;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;             <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;number level 1 blocks in D must be even&quot;</span>)</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;           qstretch(1,^d)=qstretch_baselevel(^d)</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;           dxfirst(1,^d)=(xprobmax^d-xprobmin^d) &amp;</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                *(1.0d0-qstretch(1,^d))/(1.0d0-qstretch(1,^d)**domain_nx^d)</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;           qstretch(0,^d)=qstretch(1,^d)**2</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;           dxfirst(0,^d)=dxfirst(1,^d)*(1.0d0+qstretch(1,^d))</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;           <span class="keywordflow">if</span>(refine_max_level&gt;1)<span class="keywordflow">then</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;              <span class="keywordflow">do</span> ilev=2,refine_max_level</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;                 qstretch(ilev,^d)=dsqrt(qstretch(ilev-1,^d))</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;                 dxfirst(ilev,^d)=dxfirst(ilev-1,^d) &amp;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;                       /(1.0d0+dsqrt(qstretch(ilev-1,^d)))</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="keywordflow">        endif</span> \}</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <span class="keywordflow">if</span>(mype==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;           {<span class="keywordflow">if</span>(stretch_type(^d) == stretch_uni) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;              <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Stretched dimension &#39;</span>, ^d</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;              <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;Using stretched grid with qs=&#39;</span>,qstretch(0:refine_max_level,^d)</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;              <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;        and first cell sizes=&#39;</span>,dxfirst(0:refine_max_level,^d)</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;           endif\}</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;       {<span class="keywordflow">if</span>(stretch_type(^d) == stretch_symm) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;           <span class="keywordflow">if</span>(mype==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;               <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;will apply symmetric stretch in dimension&#39;</span>, ^d</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;           <span class="keywordflow">if</span>(mod(block_nx^d,2)==1) &amp;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;             <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;stretched grid needs even block size block_nxD&quot;</span>)</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;           <span class="comment">! checks on the input variable nstretchedblocks_baselevel</span></div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;           <span class="keywordflow">if</span>(nstretchedblocks_baselevel(^d)==0) &amp;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;             <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;need finite even number of stretched blocks at baselevel&quot;</span>)</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;           <span class="keywordflow">if</span>(mod(nstretchedblocks_baselevel(^d),2)==1) &amp;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;             <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;need even number of stretched blocks at baselevel&quot;</span>)</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;           <span class="keywordflow">if</span>(qstretch_baselevel(^d)&lt;1.0d0.or.qstretch_baselevel(^d)==bigdouble) &amp;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;             <span class="keyword">call </span>mpistop(<span class="stringliteral">&#39;stretched grid needs finite qstretch_baselevel&gt;1&#39;</span>)</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;           <span class="comment">! compute stretched part to ensure uniform center</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;           ipower=(nstretchedblocks_baselevel(^d)/2)*block_nx^d</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;           <span class="keywordflow">if</span>(nstretchedblocks_baselevel(^d)==domain_nx^d/block_nx^d)<span class="keywordflow">then</span></div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;              xstretch^d=0.5d0*(xprobmax^d-xprobmin^d)</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;           <span class="keywordflow">else</span></div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;              xstretch^d=(xprobmax^d-xprobmin^d) &amp;</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;                /(2.0d0+dble(domain_nx^d-nstretchedblocks_baselevel(^d)*block_nx^d) &amp;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;               *(1.0d0-qstretch_baselevel(^d))/(1.0d0-qstretch_baselevel(^d)**ipower))</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;           <span class="keywordflow">if</span>(xstretch^d&gt;(xprobmax^d-xprobmin^d)*0.5d0) &amp;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;             <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot; stretched grid part should not exceed full domain&quot;</span>)</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;           dxfirst(1,^d)=xstretch^d*(1.0d0-qstretch_baselevel(^d)) &amp;</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;                                   /(1.0d0-qstretch_baselevel(^d)**ipower)</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;           nstretchedblocks(1,^d)=nstretchedblocks_baselevel(^d)</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;           qstretch(1,^d)=qstretch_baselevel(^d)</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;           qstretch(0,^d)=qstretch(1,^d)**2</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;           dxfirst(0,^d)=dxfirst(1,^d)*(1.0d0+qstretch(1,^d))</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;           dxmid(1,^d)=dxfirst(1,^d)</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;           dxmid(0,^d)=dxfirst(1,^d)*2.0d0</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;           <span class="keywordflow">if</span>(refine_max_level&gt;1)<span class="keywordflow">then</span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;              <span class="keywordflow">do</span> ilev=2,refine_max_level</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                 nstretchedblocks(ilev,^d)=2*nstretchedblocks(ilev-1,^d)</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                 qstretch(ilev,^d)=dsqrt(qstretch(ilev-1,^d))</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;                 dxfirst(ilev,^d)=dxfirst(ilev-1,^d) &amp;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;                         /(1.0d0+dsqrt(qstretch(ilev-1,^d)))</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                 dxmid(ilev,^d)=dxmid(ilev-1,^d)/2.0d0</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;<span class="keywordflow">              enddo</span></div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;           <span class="comment">! sanity check on total domain size:</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;           sizeuniformpart^d=dxfirst(1,^d) &amp;</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;             *(domain_nx^d-nstretchedblocks_baselevel(^d)*block_nx^d)</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;           <span class="keywordflow">if</span>(mype==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;              print *,<span class="stringliteral">&#39;uniform part of size=&#39;</span>,sizeuniformpart^d</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;              print *,<span class="stringliteral">&#39;setting of domain is then=&#39;</span>,2*xstretch^d+sizeuniformpart^d</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;              print *,<span class="stringliteral">&#39;versus=&#39;</span>,xprobmax^d-xprobmin^d</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;           <span class="keywordflow">if</span>(dabs(xprobmax^d-xprobmin^d-2*xstretch^d-sizeuniformpart^d)&gt;smalldouble) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;              <span class="keyword">call </span>mpistop(<span class="stringliteral">&#39;mismatch in domain size!&#39;</span>)</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="keywordflow">           endif</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="keywordflow">        endif</span> \}</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        dxfirst_1mq(0:refine_max_level,1:ndim)=dxfirst(0:refine_max_level,1:ndim) &amp;</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                              /(1.0d0-qstretch(0:refine_max_level,1:ndim))</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160; </div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    dx_vec = [{xprobmax^d-xprobmin^d|, }] / nx_vec</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160; </div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    <span class="keywordflow">if</span> (mype==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;       <span class="keyword">write</span>(c_ndim, <span class="stringliteral">&#39;(I1)&#39;</span>) ^nd</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;       <span class="keyword">write</span>(unitterm, <span class="stringliteral">&#39;(A30,&#39;</span> // c_ndim // <span class="stringliteral">&#39;(I0,&quot; &quot;))&#39;</span>) &amp;</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;            <span class="stringliteral">&#39; Domain size (cells): &#39;</span>, nx_vec</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;       <span class="keyword">write</span>(unitterm, <span class="stringliteral">&#39;(A30,&#39;</span> // c_ndim // <span class="stringliteral">&#39;(E9.3,&quot; &quot;))&#39;</span>) &amp;</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;            <span class="stringliteral">&#39; Level one dx: &#39;</span>, dx_vec</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160; </div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    <span class="keywordflow">if</span> (any(dx_vec &lt; smalldouble)) &amp;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;         <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Incorrect domain size (too small grid spacing)&quot;</span>)</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160; </div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    dx(:, 1) = dx_vec</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160; </div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="keywordflow">if</span>(sum(w_refine_weight(:))==0) w_refine_weight(1) = 1.d0</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <span class="keywordflow">if</span>(dabs(sum(w_refine_weight(:))-1.d0)&gt;smalldouble) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      <span class="keyword">write</span>(unitterm,*) <span class="stringliteral">&quot;Sum of all elements in w_refine_weight be 1.d0&quot;</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;      <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Reset w_refine_weight so the sum is 1.d0&quot;</span>)</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160; </div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    <span class="keywordflow">select case</span> (typeboundspeed)</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    <span class="keywordflow">case</span>(<span class="stringliteral">&#39;Einfeldt&#39;</span>)</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;      boundspeed=1</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    <span class="keywordflow">case</span>(<span class="stringliteral">&#39;cmaxmean&#39;</span>)</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;      boundspeed=2</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    <span class="keywordflow">case</span>(<span class="stringliteral">&#39;cmaxleftright&#39;</span>)</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;      boundspeed=3</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="keywordflow">    case default</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;set typeboundspeed=&#39;Einfieldt&#39; or &#39;cmaxmean&#39; or &#39;cmaxleftright&#39;&quot;</span>)</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="keywordflow">    end select</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160; </div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    <span class="keywordflow">if</span> (mype==0) <span class="keyword">write</span>(unitterm, <span class="stringliteral">&#39;(A30)&#39;</span>, advance=<span class="stringliteral">&#39;no&#39;</span>) <span class="stringliteral">&#39;Refine estimation: &#39;</span></div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160; </div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    <span class="keywordflow">select case</span> (refine_criterion)</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    <span class="keywordflow">case</span> (0)</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;       <span class="keywordflow">if</span> (mype==0) <span class="keyword">write</span>(unitterm, <span class="stringliteral">&#39;(A)&#39;</span>) <span class="stringliteral">&quot;user defined&quot;</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    <span class="keywordflow">case</span> (1)</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;       <span class="keywordflow">if</span> (mype==0) <span class="keyword">write</span>(unitterm, <span class="stringliteral">&#39;(A)&#39;</span>) <span class="stringliteral">&quot;relative error&quot;</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    <span class="keywordflow">case</span> (2)</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;       <span class="keywordflow">if</span> (mype==0) <span class="keyword">write</span>(unitterm, <span class="stringliteral">&#39;(A)&#39;</span>) <span class="stringliteral">&quot;Lohner&#39;s original scheme&quot;</span></div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    <span class="keywordflow">case</span> (3)</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;       <span class="keywordflow">if</span> (mype==0) <span class="keyword">write</span>(unitterm, <span class="stringliteral">&#39;(A)&#39;</span>) <span class="stringliteral">&quot;Lohner&#39;s scheme&quot;</span></div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="keywordflow">    case default</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;       <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Unknown error estimator, change refine_criterion&quot;</span>)</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="keywordflow">    end select</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160; </div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    <span class="keywordflow">if</span> (tfixgrid&lt;bigdouble/2.0d0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;       <span class="keywordflow">if</span>(mype==0)print*,<span class="stringliteral">&#39;Warning, at time=&#39;</span>,tfixgrid,<span class="stringliteral">&#39;the grid will be fixed&#39;</span></div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    <span class="keywordflow">if</span> (itfixgrid&lt;biginteger/2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;       <span class="keywordflow">if</span>(mype==0)print*,<span class="stringliteral">&#39;Warning, at iteration=&#39;</span>,itfixgrid,<span class="stringliteral">&#39;the grid will be fixed&#39;</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    <span class="keywordflow">if</span> (ditregrid&gt;1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;       <span class="keywordflow">if</span>(mype==0)print*,<span class="stringliteral">&#39;Note, Grid is reconstructed once every&#39;</span>,ditregrid,<span class="stringliteral">&#39;iterations&#39;</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160; </div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160; </div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    <span class="keywordflow">do</span> islice=1,nslices</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;       <span class="keywordflow">select case</span>(slicedir(islice))</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;          {<span class="keywordflow">case</span>(^d)</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;          <span class="keywordflow">if</span>(slicecoord(islice)&lt;xprobmin^d.or.slicecoord(islice)&gt;xprobmax^d) &amp;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;               <span class="keyword">write</span>(uniterr,*)<span class="stringliteral">&#39;Warning in read_par_files: &#39;</span>, &amp;</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;               <span class="stringliteral">&#39;Slice &#39;</span>, islice, <span class="stringliteral">&#39; coordinate&#39;</span>,slicecoord(islice),<span class="stringliteral">&#39;out of bounds for dimension &#39;</span>,slicedir(islice)</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;          \}</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="keywordflow">       end select</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160; </div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="keywordflow">if</span> (mype==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;       <span class="keyword">write</span>(unitterm, <span class="stringliteral">&#39;(A30,A,A)&#39;</span>) <span class="stringliteral">&#39;restart_from_file: &#39;</span>, <span class="stringliteral">&#39; &#39;</span>, trim(restart_from_file)</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;       <span class="keyword">write</span>(unitterm, <span class="stringliteral">&#39;(A30,L1)&#39;</span>) <span class="stringliteral">&#39;converting: &#39;</span>, convert</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;       <span class="keyword">write</span>(unitterm, <span class="stringliteral">&#39;(A)&#39;</span>) <span class="stringliteral">&#39;&#39;</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160; </div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;    <span class="keyword">deallocate</span>(flux_scheme)</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160; </div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#a3d02333ce1529f982c89bf948cc871e7">read_par_files</a></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="comment">  !&gt; Routine to find entries in a string</span></div>
<div class="line"><a name="l01671"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#ab2d0a28e065926627226ed89b96ada9d"> 1671</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#ab2d0a28e065926627226ed89b96ada9d">get_fields_string</a>(line, delims, n_max, fields, n_found, fully_read)</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;<span class="comment">    !&gt; The line from which we want to read</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>    :: line<span class="comment"></span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="comment">    !&gt; A string with delimiters. For example delims = &quot; ,&#39;&quot;&quot;&quot;//char(9)</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span>    :: delims<span class="comment"></span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment">    !&gt; Maximum number of entries to read in</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>             :: n_max<span class="comment"></span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="comment">    !&gt; Number of entries found</span></div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(inout)</span>          :: n_found<span class="comment"></span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="comment">    !&gt; Fields in the strings</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(inout)</span> :: fields(n_max)</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span>, <span class="keywordtype">optional</span>  :: fully_read</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160; </div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <span class="keywordtype">integer</span> :: ixs_start(n_max)</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    <span class="keywordtype">integer</span> :: ixs_end(n_max)</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    <span class="keywordtype">integer</span> :: ix, ix_prev</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160; </div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    ix_prev = 0</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    n_found = 0</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160; </div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    <span class="keywordflow">do</span> <span class="keywordflow">while</span> (n_found &lt; n_max)</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;       <span class="comment">! Find the starting point of the next entry (a non-delimiter value)</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;       ix = verify(line(ix_prev+1:), delims)</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;       <span class="keywordflow">if</span> (ix == 0) <span class="keywordflow">exit</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160; </div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;       n_found            = n_found + 1</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;       ixs_start(n_found) = ix_prev + ix <span class="comment">! This is the absolute position in &#39;line&#39;</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160; </div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;       <span class="comment">! Get the end point of the current entry (next delimiter index minus one)</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;       ix = scan(line(ixs_start(n_found)+1:), delims) - 1</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160; </div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;       <span class="keywordflow">if</span> (ix == -1) <span class="keywordflow">then</span>              <span class="comment">! If there is no last delimiter,</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;          ixs_end(n_found) = len(line) <span class="comment">! the end of the line is the endpoint</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;       <span class="keywordflow">else</span></div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;          ixs_end(n_found) = ixs_start(n_found) + ix</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160; </div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;       fields(n_found) = line(ixs_start(n_found):ixs_end(n_found))</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;       ix_prev = ixs_end(n_found) <span class="comment">! We continue to search from here</span></div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160; </div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">present</span>(fully_read)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      ix = verify(line(ix_prev+1:), delims)</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;      fully_read = (ix == 0)    <span class="comment">! Are there only delimiters?</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160; </div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#ab2d0a28e065926627226ed89b96ada9d">get_fields_string</a></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160; </div>
<div class="line"><a name="l01719"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#a061b50e8aaaaf828c94809adf831ccbe"> 1719</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#a061b50e8aaaaf828c94809adf831ccbe">saveamrfile</a>(ifile)</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160; </div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__usr__methods.html">mod_usr_methods</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__usr__methods.html#a5477c9301c7327d2bed2c833a97428c2">usr_print_log</a>, <a class="code" href="namespacemod__usr__methods.html#a8e96d26dba482ea92807a1d2c6d4a833">usr_write_analysis</a></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__particles.html">mod_particles</a>, <span class="keywordtype">only</span>: write_particles_snapshot</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__slice.html">mod_slice</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__slice.html#a6a45feb00cf001fcff14f72e126a89c4">write_slice</a></div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__collapse.html">mod_collapse</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__collapse.html#ae345a692009d6f8bf85ddd4cdb30cb4e">write_collapsed</a></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__convert__files.html">mod_convert_files</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__convert__files.html#a62a6fb3fa85f5bb311485d3dc140562c">generate_plotfile</a></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;    <span class="keywordtype">integer</span>:: ifile</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160; </div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    <span class="keywordflow">select case</span> (ifile)</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="namespacemod__global__parameters.html#aa8b0f3c32c987669794c2a72cb29161e">fileout_</a>)</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;       <span class="comment">! Write .dat snapshot</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacemod__input__output.html#ae1d4a41dcf32cae3752c48ef73f42364">write_snapshot</a>()</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160; </div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;       <span class="comment">! Generate formatted output (e.g., VTK)</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;       <span class="keywordflow">if</span>(<a class="code" href="namespacemod__global__parameters.html#a701d9f0321c70f8e13a05f6c15f2fb76">autoconvert</a>) <span class="keyword">call </span><a class="code" href="namespacemod__convert__files.html#a62a6fb3fa85f5bb311485d3dc140562c">generate_plotfile</a></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160; </div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;       <span class="keywordflow">if</span>(<a class="code" href="namespacemod__global__parameters.html#a539b80e7ad5ccd313f1076e15a7cd137">use_particles</a>) <span class="keyword">call </span>write_particles_snapshot()</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160; </div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;       <a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a> = <a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a> + 1</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="namespacemod__global__parameters.html#ad6931ffa651097a2409dd069dd7bbe74">fileslice_</a>)</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacemod__slice.html#a6a45feb00cf001fcff14f72e126a89c4">write_slice</a></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="namespacemod__global__parameters.html#a45e7eb72fd08ffc0a68a5b9173da5a3b">filecollapse_</a>)</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacemod__collapse.html#ae345a692009d6f8bf85ddd4cdb30cb4e">write_collapsed</a></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="namespacemod__global__parameters.html#a9e14f8777e3d1c99500aabba1f25384f">filelog_</a>)</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;       <span class="keywordflow">select case</span> (<a class="code" href="namespacemod__global__parameters.html#ade5d1c51af566e1f4fead3564b6739a9">typefilelog</a>)</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;default&#39;</span>)</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacemod__input__output.html#ac699b426ea2d42b06de1c1798b98f96d">printlog_default</a></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;regression_test&#39;</span>)</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacemod__input__output.html#a97e4df1969002df5c3fcc551db7d354e">printlog_regression_test</a>()</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;       <span class="keywordflow">case</span> (<span class="stringliteral">&#39;special&#39;</span>)</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;          <span class="keywordflow">if</span> (.not. <span class="keyword">associated</span>(<a class="code" href="namespacemod__usr__methods.html#a5477c9301c7327d2bed2c833a97428c2">usr_print_log</a>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;             <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;usr_print_log not defined&quot;</span>)</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;             <span class="keyword">call </span><a class="code" href="namespacemod__usr__methods.html#a5477c9301c7327d2bed2c833a97428c2">usr_print_log</a>()</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;<span class="keywordflow">       case default</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;          <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Error in SaveFile: Unknown typefilelog&quot;</span>)</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="keywordflow">       end select</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    <span class="keywordflow">case</span> (<a class="code" href="namespacemod__global__parameters.html#adbbcd5c8b4225ffc9bcd128e1f66fd47">fileanalysis_</a>)</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;       <span class="keywordflow">if</span> (<span class="keyword">associated</span>(<a class="code" href="namespacemod__usr__methods.html#a8e96d26dba482ea92807a1d2c6d4a833">usr_write_analysis</a>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacemod__usr__methods.html#a8e96d26dba482ea92807a1d2c6d4a833">usr_write_analysis</a>()</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="keywordflow">    case default</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;       <span class="keyword">write</span>(*,*) <span class="stringliteral">&#39;No save method is defined for ifile=&#39;</span>,ifile</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;       <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;&quot;</span>)</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="keywordflow">    end select</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160; </div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="comment">! opedit: Flush stdout and stderr from time to time.</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <span class="keyword">flush</span>(unit=<a class="code" href="namespacemod__global__parameters.html#a9214ecd6fb45fa103a8518c45be16072">unitterm</a>)</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160; </div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#a061b50e8aaaaf828c94809adf831ccbe">saveamrfile</a></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160; </div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160; </div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;  <span class="comment">! Check if a snapshot exists</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#a261f5086d85a96e13547d0e1c60928af"> 1775</a></span>&#160;  <span class="keyword">logical </span><span class="keyword">function </span><a class="code" href="namespacemod__input__output.html#a261f5086d85a96e13547d0e1c60928af">snapshot_exists</a>(ix)</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>    :: ix<span class="comment"> !&lt; Index of snapshot</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    <span class="keywordtype">character(len=std_len)</span> :: filename</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160; </div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    <span class="keyword">write</span>(filename, <span class="stringliteral">&quot;(a,i4.4,a)&quot;</span>) trim(<a class="code" href="namespacemod__global__parameters.html#acca226f88fb362bae425ca71f3742d09">base_filename</a>), ix, <span class="stringliteral">&quot;.dat&quot;</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    <span class="keyword">inquire</span>(file=trim(filename), exist=<a class="code" href="namespacemod__input__output.html#a261f5086d85a96e13547d0e1c60928af">snapshot_exists</a>)</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  <span class="keyword">end function </span><a class="code" href="namespacemod__input__output.html#a261f5086d85a96e13547d0e1c60928af">snapshot_exists</a></div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160; </div>
<div class="line"><a name="l01784"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#a2b408b40f813e4fe523621ab4a497d76"> 1784</a></span>&#160;  <span class="keyword">integer </span><span class="keyword">function </span><a class="code" href="namespacemod__input__output.html#a2b408b40f813e4fe523621ab4a497d76">get_snapshot_index</a>(filename)</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    <span class="keywordtype">character(len=*)</span>, <span class="keywordtype">intent(in)</span> :: filename</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    <span class="keywordtype">integer</span>                      :: i</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160; </div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    <span class="comment">! Try to parse index in restart_from_file string (e.g. basename0000.dat)</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    i = len_trim(filename) - 7</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    <span class="keyword">read</span>(filename(i:i+3), <span class="stringliteral">&#39;(I4)&#39;</span>) <a class="code" href="namespacemod__input__output.html#a2b408b40f813e4fe523621ab4a497d76">get_snapshot_index</a></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;  <span class="keyword">end function </span><a class="code" href="namespacemod__input__output.html#a2b408b40f813e4fe523621ab4a497d76">get_snapshot_index</a></div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160; </div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160; </div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="comment">  !&gt; Write header for a snapshot</span></div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="comment">  !&gt;</span></div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="comment">  !&gt; If you edit the header, don&#39;t forget to update: snapshot_write_header(),</span></div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="comment">  !&gt; snapshot_read_header(), doc/fileformat.md, tools/python/dat_reader.py</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#acd293c80fe4dffe68b3bd5af075cc137"> 1799</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#acd293c80fe4dffe68b3bd5af075cc137">snapshot_write_header</a>(fh, offset_tree, offset_block)</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__forest.html">mod_forest</a></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__physics.html">mod_physics</a></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__slice.html">mod_slice</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">slicenext</a></div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__input__output__helper.html">mod_input_output_helper</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__input__output__helper.html#a9b3e3365ae87d58b382931ee36cb6d7e">snapshot_write_header1</a></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>                       :: fh<span class="comment">           !&lt; File handle</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    <span class="keywordtype">integer(kind=MPI_OFFSET_KIND)</span>, <span class="keywordtype">intent(in)</span> :: offset_tree<span class="comment">  !&lt; Offset of tree info</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;    <span class="keywordtype">integer(kind=MPI_OFFSET_KIND)</span>, <span class="keywordtype">intent(in)</span> :: offset_block<span class="comment"> !&lt; Offset of block data</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacemod__input__output__helper.html#a9b3e3365ae87d58b382931ee36cb6d7e">snapshot_write_header1</a>(fh, offset_tree, offset_block, cons_wnames, nw)</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#acd293c80fe4dffe68b3bd5af075cc137">snapshot_write_header</a></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="comment">  !&gt; Read header for a snapshot</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="comment">  !&gt;</span></div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment">  !&gt; If you edit the header, don&#39;t forget to update: snapshot_write_header(),</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;<span class="comment">  !&gt; snapshot_read_header(), doc/fileformat.md, tools/python/dat_reader.py</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#ae860a54ebdb7a0bee2fed1821d67cc99"> 1815</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#ae860a54ebdb7a0bee2fed1821d67cc99">snapshot_read_header</a>(fh, offset_tree, offset_block)</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__forest.html">mod_forest</a></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__physics.html">mod_physics</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__physics.html#a9c0b8a2dc10a59ca87e89eaa056929ad">physics_type</a></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__slice.html">mod_slice</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">slicenext</a></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>                   :: fh<span class="comment">           !&lt; File handle</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    <span class="keywordtype">integer(MPI_OFFSET_KIND)</span>, <span class="keywordtype">intent(out)</span> :: offset_tree<span class="comment">  !&lt; Offset of tree info</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    <span class="keywordtype">integer(MPI_OFFSET_KIND)</span>, <span class="keywordtype">intent(out)</span> :: offset_block<span class="comment"> !&lt; Offset of block data</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    <span class="keywordtype">integer</span>                               :: i, version</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    <span class="keywordtype">integer</span>                               :: ibuf(ndim), iw</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    <span class="keywordtype">double precision</span>                      :: rbuf(ndim)</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">dimension(MPI_STATUS_SIZE)</span>   :: st</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;    <span class="keywordtype">character(len=name_len)</span>, <span class="keywordtype">allocatable</span>  :: var_names(:), param_names(:)</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <span class="keywordtype">double precision</span>, <span class="keywordtype">allocatable</span>         :: params(:)</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    <span class="keywordtype">character(len=name_len)</span>               :: phys_name, geom_name</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    <span class="keywordtype">integer</span>                               :: er, n_par, tmp_int</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    <span class="keywordtype">logical</span>                               :: periodic(ndim)</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160; </div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    <span class="comment">! Version number</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh, version, 1, mpi_integer, st, er)</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    <span class="keywordflow">if</span> (all(<a class="code" href="namespacemod__input__output.html#af6450e39c0d1c69b17bbbb5db487231a">compatible_versions</a> /= version)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;      <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;Incompatible file version (maybe old format?)&quot;</span>)</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160; </div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    <span class="comment">! offset_tree</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh, ibuf(1), 1, mpi_integer, st, er)</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    offset_tree = ibuf(1)</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160; </div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    <span class="comment">! offset_block</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh, ibuf(1), 1, mpi_integer, st, er)</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    offset_block = ibuf(1)</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160; </div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="comment">! nw</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh, ibuf(1), 1, mpi_integer, st, er)</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    <a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>=ibuf(1)</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    <span class="keywordflow">if</span> (nw /= ibuf(1)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;      <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;nw=&quot;</span>,nw,<span class="stringliteral">&quot; and nw found in restart file=&quot;</span>,ibuf(1)</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;      <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;Please be aware of changes in w at restart.&quot;</span></div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      <span class="comment">!call mpistop(&quot;currently, changing nw at restart is not allowed&quot;)</span></div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160; </div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    <span class="comment">! ndir</span></div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh, ibuf(1), 1, mpi_integer, st, er)</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    <span class="keywordflow">if</span> (ibuf(1) /= <a class="code" href="namespacemod__global__parameters.html#a6d65136b05163940551f4704a2dc13b8">ndir</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;ndir in restart file = &quot;</span>,ibuf(1)</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;ndir = &quot;</span>,<a class="code" href="namespacemod__global__parameters.html#a6d65136b05163940551f4704a2dc13b8">ndir</a></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;      <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;reset ndir to ndir in restart file&quot;</span>)</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160; </div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    <span class="comment">! ndim</span></div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh, ibuf(1), 1, mpi_integer, st, er)</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    <span class="keywordflow">if</span> (ibuf(1) /= ndim) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;ndim in restart file = &quot;</span>,ibuf(1)</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;      <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;ndim = &quot;</span>,ndim</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;      <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;reset ndim to ndim in restart file&quot;</span>)</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160; </div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;    <span class="comment">! levmax</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh, ibuf(1), 1, mpi_integer, st, er)</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    <span class="keywordflow">if</span> (ibuf(1) &gt; <a class="code" href="namespacemod__global__parameters.html#ad3ffd4e35e76a0b86495789e5458fdd8">refine_max_level</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;      <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;number of levels in restart file = &quot;</span>,ibuf(1)</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;      <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;refine_max_level = &quot;</span>,<a class="code" href="namespacemod__global__parameters.html#ad3ffd4e35e76a0b86495789e5458fdd8">refine_max_level</a></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;refine_max_level &lt; num. levels in restart file&quot;</span>)</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160; </div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <span class="comment">! nleafs</span></div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh, <a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a>, 1, mpi_integer, st, er)</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160; </div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    <span class="comment">! nparents</span></div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh, <a class="code" href="namespacemod__forest.html#ac839cac53d5fa3fae1e594d3e88dfd60">nparents</a>, 1, mpi_integer, st, er)</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160; </div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    <span class="comment">! it</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh, <a class="code" href="namespacemod__global__parameters.html#a37c8bbe2457c57b29f0bca3f7e1387fa">it</a>, 1, mpi_integer, st, er)</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160; </div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    <span class="comment">! global time</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh, <a class="code" href="namespacemod__global__parameters.html#a2bdc961e7304863887ec17a92ae5ac0a">global_time</a>, 1, mpi_double_precision, st, er)</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160; </div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;    <span class="comment">! xprobmin^D</span></div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh,rbuf(1:ndim),ndim,mpi_double_precision,st,er)</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    <span class="keywordflow">if</span> (maxval(abs(rbuf(1:ndim) - [ xprobmin^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> ])) &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;      <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;Error: xprobmin differs from restart data: &quot;</span>, rbuf(1:ndim)</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;      <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;change xprobmin^D in par file&quot;</span>)</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160; </div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <span class="comment">! xprobmax^D</span></div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh,rbuf(1:ndim),ndim,mpi_double_precision,st,er)</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    <span class="keywordflow">if</span> (maxval(abs(rbuf(1:ndim) - [ xprobmax^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> ])) &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;Error: xprobmax differs from restart data: &quot;</span>, rbuf(1:ndim)</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;      <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;change xprobmax^D in par file&quot;</span>)</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160; </div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <span class="comment">! domain_nx^D</span></div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh,ibuf(1:ndim), ndim, mpi_integer,st,er)</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    <span class="keywordflow">if</span> (any(ibuf(1:ndim) /= [ <a class="code" href="namespacemod__global__parameters.html#a23b35ecdd0fd1864d80811b347464176">domain_nx</a>^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> ])) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;      <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;Error: mesh size differs from restart data: &quot;</span>, ibuf(1:ndim)</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;      <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;change domain_nx^D in par file&quot;</span>)</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160; </div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    <span class="comment">! block_nx^D</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    <span class="keyword">call </span>mpi_file_read(fh,ibuf(1:ndim), ndim, mpi_integer,st,er)</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    <span class="keywordflow">if</span> (any(ibuf(1:ndim) /= [ <a class="code" href="namespacemod__global__parameters.html#a61b20ad3b87b28e636a5f74d3145a850">block_nx</a>^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> ])) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;      <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;Error: block size differs from restart data:&quot;</span>, ibuf(1:ndim)</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;      <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;change block_nx^D in par file&quot;</span>)</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160; </div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    <span class="comment">! From version 5, read more info about the grid</span></div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    <span class="keywordflow">if</span> (version &gt; 4) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh, periodic, ndim, mpi_logical, st, er)</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;      <span class="keywordflow">if</span> ({periodic(^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a>) .and. .not.<a class="code" href="namespacemod__global__parameters.html#a9af4bac5cdacef49764bebff3e1dd01b">periodb</a>(^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a>) .or. .not.periodic(^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a>) .and. <a class="code" href="namespacemod__global__parameters.html#a9af4bac5cdacef49764bebff3e1dd01b">periodb</a>(^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a>)| .or. }) &amp;</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;           <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;change in periodicity in par file&quot;</span>)</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160; </div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh, geom_name, name_len, mpi_character, st, er)</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160; </div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      <span class="keywordflow">if</span> (geom_name /= <a class="code" href="namespacemod__global__parameters.html#a1c0505dd1692e179fd6eb8e9d8cb553b">geometry_name</a>(1:name_len)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;type of coordinates in data is: &quot;</span>, geom_name</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;        <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;select the correct coordinates in mod_usr.t file&quot;</span>)</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160; </div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh, stagger_mark_dat, 1, mpi_logical, st, er)</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a4ebd0a5ae560288eeb5dfd3b2f251429">stagger_grid</a> .and. .not. stagger_mark_dat .or. .not.<a class="code" href="namespacemod__global__parameters.html#a4ebd0a5ae560288eeb5dfd3b2f251429">stagger_grid</a>.and.stagger_mark_dat) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;Warning: stagger grid flag differs from restart data:&quot;</span>, stagger_mark_dat</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;        <span class="comment">!call mpistop(&quot;change parameter to use stagger grid&quot;)</span></div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160; </div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    <span class="comment">! From version 4 onwards, the later parts of the header must be present</span></div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <span class="keywordflow">if</span> (version &gt; 3) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;      <span class="comment">! w_names (not used here)</span></div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;      <span class="keyword">allocate</span>(var_names(<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>))</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;      <span class="keywordflow">do</span> iw = 1, <a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;        <span class="keyword">call </span>mpi_file_read(fh, var_names(iw), name_len, mpi_character, st, er)</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160; </div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      <span class="comment">! Physics related information</span></div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh, phys_name, name_len, mpi_character, st, er)</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160; </div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;      <span class="keywordflow">if</span> (phys_name /= <a class="code" href="namespacemod__physics.html#a9c0b8a2dc10a59ca87e89eaa056929ad">physics_type</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;<span class="comment">!        call mpistop(&quot;Cannot restart with a different physics type&quot;)</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160; </div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh, n_par, 1, mpi_integer, st, er)</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;      <span class="keyword">allocate</span>(params(n_par))</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      <span class="keyword">allocate</span>(param_names(n_par))</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh, params, n_par, mpi_double_precision, st, er)</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh, param_names, name_len * n_par, mpi_character, st, er)</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160; </div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;      <span class="comment">! Read snapshotnext etc. for restarting</span></div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh, tmp_int, 1, mpi_integer, st, er)</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160; </div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;      <span class="comment">! Only set snapshotnext if the user hasn&#39;t specified it</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a> == -1) <a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a> = tmp_int</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160; </div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh, tmp_int, 1, mpi_integer, st, er)</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">slicenext</a> == -1) <a class="code" href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">slicenext</a> = tmp_int</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160; </div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh, tmp_int, 1, mpi_integer, st, er)</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#ae5c84337d8ace067e3744f286305044c">collapsenext</a> == -1) <a class="code" href="namespacemod__global__parameters.html#ae5c84337d8ace067e3744f286305044c">collapsenext</a> = tmp_int</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;      <span class="comment">! Guess snapshotnext from file name if not set</span></div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a> == -1) &amp;</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;           <a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a> = <a class="code" href="namespacemod__input__output.html#a2b408b40f813e4fe523621ab4a497d76">get_snapshot_index</a>(trim(<a class="code" href="namespacemod__global__parameters.html#a99b70d54ff2f08fb179495e2a07d1e44">restart_from_file</a>)) + 1</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;      <span class="comment">! Set slicenext and collapsenext if not set</span></div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">slicenext</a> == -1) <a class="code" href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">slicenext</a> = 0</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#ae5c84337d8ace067e3744f286305044c">collapsenext</a> == -1) <a class="code" href="namespacemod__global__parameters.html#ae5c84337d8ace067e3744f286305044c">collapsenext</a> = 0</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160; </div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <span class="comment">! Still used in convert</span></div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    <a class="code" href="namespacemod__global__parameters.html#a370863264a3b2f3734b6cfacdd8b2bed">snapshotini</a> = <a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a>-1</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160; </div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#ae860a54ebdb7a0bee2fed1821d67cc99">snapshot_read_header</a></div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160; </div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160; </div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160; </div>
<div class="line"><a name="l01988"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#ae1d4a41dcf32cae3752c48ef73f42364"> 1988</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#ae1d4a41dcf32cae3752c48ef73f42364">write_snapshot</a></div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__forest.html">mod_forest</a></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__physics.html">mod_physics</a></div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__input__output__helper.html">mod_input_output_helper</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__input__output__helper.html#a54d24b33757cb6dc549aeb19a2563964">count_ix</a>,<a class="code" href="namespacemod__input__output__helper.html#ac03c76ebf22aa6a66b2b1677e00a82d9">block_shape_io</a>,<a class="code" href="namespacemod__input__output__helper.html#a208f91df2b8f3fdbcbbd029668802c26">create_output_file</a></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__functions__forest.html">mod_functions_forest</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__functions__forest.html#a5fe089544b6f559e305b5b6e41544191">write_forest</a></div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160; </div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    <span class="keywordtype">integer</span>                       :: file_handle, igrid, Morton_no, iwrite</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    <span class="keywordtype">integer</span>                       :: ipe, ix_buffer(2*ndim+1), n_values</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    <span class="keywordtype">integer</span>                       :: ixO^L, n_ghost(2*ndim)</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    <span class="keywordtype">integer</span>                       :: ixOs^L,n_values_stagger</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    <span class="keywordtype">integer</span>                       :: iorecvstatus(MPI_STATUS_SIZE)</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    <span class="keywordtype">integer</span>                       :: ioastatus(MPI_STATUS_SIZE)</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;    <span class="keywordtype">integer</span>                       :: igrecvstatus(MPI_STATUS_SIZE)</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    <span class="keywordtype">integer</span>                       :: istatus(MPI_STATUS_SIZE)</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structmod__forest_1_1tree__node.html">tree_node</a>), <span class="keywordtype">pointer</span>      :: pnode</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    <span class="keywordtype">integer(kind=MPI_OFFSET_KIND)</span> :: offset_tree_info</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;    <span class="keywordtype">integer(kind=MPI_OFFSET_KIND)</span> :: offset_block_data</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    <span class="keywordtype">integer(kind=MPI_OFFSET_KIND)</span> :: offset_offsets</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;    <span class="keywordtype">double precision</span>, <span class="keywordtype">allocatable</span> :: w_buffer(:)</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160; </div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span>                       :: block_ig(:, :)</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span>                       :: block_lvl(:)</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    <span class="keywordtype">integer(kind=MPI_OFFSET_KIND)</span>, <span class="keywordtype">allocatable</span> :: block_offset(:)</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160; </div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <span class="keyword">call </span>mpi_barrier(<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160; </div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;    <span class="comment">! Allocate send/receive buffer</span></div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    n_values = <a class="code" href="namespacemod__input__output__helper.html#a54d24b33757cb6dc549aeb19a2563964">count_ix</a>(ixg^<a class="code" href="namespacemod__global__parameters.html#a66b6d102b0c1abd62b12a11b7fdb31b3">ll</a>) * nw</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacemod__global__parameters.html#a4ebd0a5ae560288eeb5dfd3b2f251429">stagger_grid</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;      n_values = n_values + <a class="code" href="namespacemod__input__output__helper.html#a54d24b33757cb6dc549aeb19a2563964">count_ix</a>(ixgs^<a class="code" href="namespacemod__global__parameters.html#a66b6d102b0c1abd62b12a11b7fdb31b3">ll</a>) * nws</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    <span class="keyword">allocate</span>(w_buffer(n_values))</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160; </div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    <span class="comment">! Allocate arrays with information about grid blocks</span></div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    <span class="keyword">allocate</span>(block_ig(ndim, <a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a>))</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    <span class="keyword">allocate</span>(block_lvl(<a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a>))</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    <span class="keyword">allocate</span>(block_offset(<a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a>+1))</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160; </div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;    <span class="comment">! master processor</span></div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemod__input__output__helper.html#a208f91df2b8f3fdbcbbd029668802c26">create_output_file</a>(file_handle, <a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a>, <span class="stringliteral">&quot;.dat&quot;</span>)</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160; </div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;      <span class="comment">! Don&#39;t know offsets yet, we will write header again later</span></div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      offset_tree_info = -1</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;      offset_block_data = -1</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemod__input__output.html#acd293c80fe4dffe68b3bd5af075cc137">snapshot_write_header</a>(file_handle, offset_tree_info, &amp;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;           offset_block_data)</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160; </div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;      <span class="keyword">call </span>mpi_file_get_position(file_handle, offset_tree_info, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160; </div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemod__functions__forest.html#a5fe089544b6f559e305b5b6e41544191">write_forest</a>(file_handle)</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160; </div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      <span class="comment">! Collect information about the spatial index (ig^D) and refinement level</span></div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      <span class="comment">! of leaves</span></div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;      <span class="keywordflow">do</span> morton_no = <a class="code" href="namespacemod__forest.html#a4404ff14f2bb4b3a5ff3a95649b5e403">morton_start</a>(0), <a class="code" href="namespacemod__forest.html#ab13fdb8137df0624e14825e47efe67da">morton_stop</a>(<a class="code" href="namespacemod__global__parameters.html#a879ff9a3d86e228553c9e44151a31574">npe</a>-1)</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;         igrid = <a class="code" href="namespacemod__forest.html#ac396678668afad23e0f2f84cd8dcf8e8">sfc</a>(1, morton_no)</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;         ipe = <a class="code" href="namespacemod__forest.html#ac396678668afad23e0f2f84cd8dcf8e8">sfc</a>(2, morton_no)</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;         pnode =&gt; <a class="code" href="namespacemod__forest.html#acc8a365fd94c525036cef5fb1d67e2ca">igrid_to_node</a>(igrid, ipe)%node</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160; </div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;         block_ig(:, morton_no) = [ pnode%ig^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> ]</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;         block_lvl(morton_no) = pnode%level</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;         block_offset(morton_no) = 0 <span class="comment">! Will be determined later</span></div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160; </div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;      <span class="keyword">call </span>mpi_file_write(file_handle, block_lvl, <span class="keyword">size</span>(block_lvl), &amp;</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;           mpi_integer, istatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160; </div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;      <span class="keyword">call </span>mpi_file_write(file_handle, block_ig, <span class="keyword">size</span>(block_ig), &amp;</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;           mpi_integer, istatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160; </div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;      <span class="comment">! Block offsets are currently unknown, but will be overwritten later</span></div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      <span class="keyword">call </span>mpi_file_get_position(file_handle, offset_offsets, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;      <span class="keyword">call </span>mpi_file_write(file_handle, block_offset(1:<a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a>), <a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a>, &amp;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;           mpi_offset, istatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160; </div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;      <span class="keyword">call </span>mpi_file_get_position(file_handle, offset_block_data, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160; </div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;      <span class="comment">! Check whether data was written as expected</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;      <span class="keywordflow">if</span> (offset_block_data - offset_tree_info /= &amp;</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;           (<a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a> + <a class="code" href="namespacemod__forest.html#ac839cac53d5fa3fae1e594d3e88dfd60">nparents</a>) * size_logical + &amp;</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;           <a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a> * ((1+ndim) * size_int + 2 * size_int)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a> == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;          print *, <span class="stringliteral">&quot;Warning: MPI_OFFSET type /= 8 bytes&quot;</span></div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;          print *, <span class="stringliteral">&quot;This *could* cause problems when reading .dat files&quot;</span></div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160; </div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      block_offset(1) = offset_block_data</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;      iwrite = 0</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160; </div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;    <span class="keywordflow">do</span> morton_no=<a class="code" href="namespacemod__forest.html#a4404ff14f2bb4b3a5ff3a95649b5e403">morton_start</a>(<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>), <a class="code" href="namespacemod__forest.html#ab13fdb8137df0624e14825e47efe67da">morton_stop</a>(<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>)</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;      igrid  = <a class="code" href="namespacemod__forest.html#a0baec555ee17dcbc0a479ce1ffcec985">sfc_to_igrid</a>(morton_no)</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;      itag   = morton_no</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160; </div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemod__input__output__helper.html#ac03c76ebf22aa6a66b2b1677e00a82d9">block_shape_io</a>(igrid, n_ghost, ixo^l, n_values)</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="namespacemod__global__parameters.html#a4ebd0a5ae560288eeb5dfd3b2f251429">stagger_grid</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;        w_buffer(1:n_values) = pack(ps(igrid)%w(ixo^s, 1:nw), .true.)</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;        {ixosmin^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> = ixomin^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> -1\}</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;        {ixosmax^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> = ixomax^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> \}</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;        n_values_stagger= <a class="code" href="namespacemod__input__output__helper.html#a54d24b33757cb6dc549aeb19a2563964">count_ix</a>(ixos^l)*nws</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        w_buffer(n_values+1:n_values+n_values_stagger) = pack(ps(igrid)%ws(ixos^s, 1:nws), .true.)</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;        n_values=n_values+n_values_stagger</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;        w_buffer(1:n_values) = pack(ps(igrid)%w(ixo^s, 1:nw), .true.)</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;      ix_buffer(1) = n_values</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;      ix_buffer(2:) = n_ghost</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160; </div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a> /= 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        <span class="keyword">call </span>mpi_send(ix_buffer, 2*ndim+1, &amp;</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;             mpi_integer, 0, itag, <a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;        <span class="keyword">call </span>mpi_send(w_buffer, n_values, &amp;</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;             mpi_double_precision, 0, itag, <a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;        iwrite = iwrite+1</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;        <span class="keyword">call </span>mpi_file_write(file_handle, ix_buffer(2:), &amp;</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;             2*ndim, mpi_integer, istatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;        <span class="keyword">call </span>mpi_file_write(file_handle, w_buffer, &amp;</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;             n_values, mpi_double_precision, istatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160; </div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;        <span class="comment">! Set offset of next block</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;        block_offset(iwrite+1) = block_offset(iwrite) + &amp;</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;             int(n_values, mpi_offset_kind) * size_double + &amp;</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;             2 * ndim * size_int</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160; </div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;    <span class="comment">! Write data communicated from other processors</span></div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a> == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;      <span class="keywordflow">do</span> ipe = 1, <a class="code" href="namespacemod__global__parameters.html#a879ff9a3d86e228553c9e44151a31574">npe</a>-1</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;        <span class="keywordflow">do</span> morton_no=<a class="code" href="namespacemod__forest.html#a4404ff14f2bb4b3a5ff3a95649b5e403">morton_start</a>(ipe), <a class="code" href="namespacemod__forest.html#ab13fdb8137df0624e14825e47efe67da">morton_stop</a>(ipe)</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;          iwrite=iwrite+1</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;          itag=morton_no</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160; </div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;          <span class="keyword">call </span>mpi_recv(ix_buffer, 2*ndim+1, mpi_integer, ipe, itag, <a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,&amp;</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;               igrecvstatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;          n_values = ix_buffer(1)</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160; </div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;          <span class="keyword">call </span>mpi_recv(w_buffer, n_values, mpi_double_precision,&amp;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;               ipe, itag, <a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>, iorecvstatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160; </div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;          <span class="keyword">call </span>mpi_file_write(file_handle, ix_buffer(2:), &amp;</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;             2*ndim, mpi_integer, istatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;          <span class="keyword">call </span>mpi_file_write(file_handle, w_buffer, &amp;</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;             n_values, mpi_double_precision, istatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160; </div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;          <span class="comment">! Set offset of next block</span></div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;          block_offset(iwrite+1) = block_offset(iwrite) + &amp;</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;               int(n_values, mpi_offset_kind) * size_double + &amp;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;               2 * ndim * size_int</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160; </div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;      <span class="comment">! Write block offsets (now we know them)</span></div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;      <span class="keyword">call </span>mpi_file_seek(file_handle, offset_offsets, mpi_seek_set, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;      <span class="keyword">call </span>mpi_file_write(file_handle, block_offset(1:<a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a>), <a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a>, &amp;</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;           mpi_offset, istatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160; </div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      <span class="comment">! Write header again, now with correct offsets</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;      <span class="keyword">call </span>mpi_file_seek(file_handle, 0_mpi_offset_kind, mpi_seek_set, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemod__input__output.html#acd293c80fe4dffe68b3bd5af075cc137">snapshot_write_header</a>(file_handle, offset_tree_info, &amp;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;           offset_block_data)</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160; </div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;      <span class="keyword">call </span>mpi_file_close(file_handle, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160; </div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;    <span class="keyword">call </span>mpi_barrier(<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160; </div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#ae1d4a41dcf32cae3752c48ef73f42364">write_snapshot</a></div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;<span class="comment">  !&gt; Routine to read in snapshots (.dat files). When it cannot recognize the</span></div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;<span class="comment">  !&gt; file version, it will automatically try the &#39;old&#39; reader.</span></div>
<div class="line"><a name="l02162"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#aa2d00e56c4444b0b4806a9c13ce2eff7"> 2162</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#aa2d00e56c4444b0b4806a9c13ce2eff7">read_snapshot</a></div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__usr__methods.html">mod_usr_methods</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__usr__methods.html#ae95367023a331f1118de73c42283b348">usr_transform_w</a></div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__input__output__helper.html">mod_input_output_helper</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__input__output__helper.html#a54d24b33757cb6dc549aeb19a2563964">count_ix</a></div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__forest.html">mod_forest</a></div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__slice.html">mod_slice</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">slicenext</a></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__amr__solution__node.html">mod_amr_solution_node</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__amr__solution__node.html#a5360422247c76466eb60cf0a2d6fd5e9">alloc_node</a></div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__functions__forest.html">mod_functions_forest</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__functions__forest.html#a693fb7f8cc66f54e57220b83e219320e">read_forest</a></div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160; </div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    <span class="keywordtype">integer</span>                       :: ix_buffer(2*ndim+1), n_values, n_values_stagger</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    <span class="keywordtype">integer</span>                       :: ixO^L, ixOs^L</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    <span class="keywordtype">integer</span>                       :: file_handle, amode, igrid, Morton_no, iread</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;    <span class="keywordtype">integer</span>                       :: istatus(MPI_STATUS_SIZE)</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;    <span class="keywordtype">integer</span>                       :: iorecvstatus(MPI_STATUS_SIZE)</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    <span class="keywordtype">integer</span>                       :: ipe,inrecv,nrecv, file_version</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    <span class="keywordtype">logical</span>                       :: fexist</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    <span class="keywordtype">integer(MPI_OFFSET_KIND)</span>      :: offset_tree_info</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    <span class="keywordtype">integer(MPI_OFFSET_KIND)</span>      :: offset_block_data</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    <span class="keywordtype">double precision</span>, <span class="keywordtype">allocatable</span> :: w_buffer(:)</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    <span class="keywordtype">double precision</span>, <span class="keywordtype">dimension(:^D&amp;,:)</span>, <span class="keywordtype">allocatable</span> :: w</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <span class="keywordtype">double precision</span> :: ws(ixGs^T,1:ndim)</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160; </div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;      <span class="keyword">inquire</span>(file=trim(<a class="code" href="namespacemod__global__parameters.html#a99b70d54ff2f08fb179495e2a07d1e44">restart_from_file</a>), exist=fexist)</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;      <span class="keywordflow">if</span> (.not.fexist) <span class="keyword">call </span>mpistop(trim(<a class="code" href="namespacemod__global__parameters.html#a99b70d54ff2f08fb179495e2a07d1e44">restart_from_file</a>)//<span class="stringliteral">&quot; not found!&quot;</span>)</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160; </div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;      <span class="keyword">call </span>mpi_file_open(mpi_comm_self,<a class="code" href="namespacemod__global__parameters.html#a99b70d54ff2f08fb179495e2a07d1e44">restart_from_file</a>,mpi_mode_rdonly, &amp;</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;           mpi_info_null,file_handle,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;      <span class="keyword">call </span>mpi_file_read(file_handle, file_version, 1, mpi_integer, &amp;</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;           istatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160; </div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    <span class="keyword">call </span>mpi_bcast(file_version,1,mpi_integer,0,<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160; </div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    <span class="keywordflow">if</span> (all(<a class="code" href="namespacemod__input__output.html#af6450e39c0d1c69b17bbbb5db487231a">compatible_versions</a> /= file_version)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a> == 0) print *, <span class="stringliteral">&quot;Unknown version, trying old snapshot reader...&quot;</span></div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;      <span class="keyword">call </span>mpi_file_close(file_handle,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemod__input__output.html#afa9ed59afcf773a8f071c30b69d1bceb">read_snapshot_old</a>()</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160; </div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;      <span class="comment">! Guess snapshotnext from file name if not set</span></div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a> == -1) &amp;</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;           <a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a> = <a class="code" href="namespacemod__input__output.html#a2b408b40f813e4fe523621ab4a497d76">get_snapshot_index</a>(trim(<a class="code" href="namespacemod__global__parameters.html#a99b70d54ff2f08fb179495e2a07d1e44">restart_from_file</a>)) + 1</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      <span class="comment">! Set slicenext and collapsenext if not set</span></div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">slicenext</a> == -1) <a class="code" href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">slicenext</a> = 0</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#ae5c84337d8ace067e3744f286305044c">collapsenext</a> == -1) <a class="code" href="namespacemod__global__parameters.html#ae5c84337d8ace067e3744f286305044c">collapsenext</a> = 0</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160; </div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;      <span class="comment">! Still used in convert</span></div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;      <a class="code" href="namespacemod__global__parameters.html#a370863264a3b2f3734b6cfacdd8b2bed">snapshotini</a> = <a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a>-1</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160; </div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      <span class="keywordflow">return</span> <span class="comment">! Leave this routine</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a> == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;      <span class="keyword">call </span>mpi_file_seek(file_handle, 0_mpi_offset_kind, mpi_seek_set, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemod__input__output.html#ae860a54ebdb7a0bee2fed1821d67cc99">snapshot_read_header</a>(file_handle, offset_tree_info, &amp;</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;           offset_block_data)</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160; </div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    <span class="comment">! Share information about restart file</span></div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;    <span class="keyword">call </span>mpi_bcast(<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>,1,mpi_integer,0,<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;    <span class="keyword">call </span>mpi_bcast(<a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a>,1,mpi_integer,0,<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;    <span class="keyword">call </span>mpi_bcast(<a class="code" href="namespacemod__forest.html#ac839cac53d5fa3fae1e594d3e88dfd60">nparents</a>,1,mpi_integer,0,<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;    <span class="keyword">call </span>mpi_bcast(<a class="code" href="namespacemod__global__parameters.html#a37c8bbe2457c57b29f0bca3f7e1387fa">it</a>,1,mpi_integer,0,<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    <span class="keyword">call </span>mpi_bcast(<a class="code" href="namespacemod__global__parameters.html#a2bdc961e7304863887ec17a92ae5ac0a">global_time</a>,1,mpi_double_precision,0,<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160; </div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    <span class="keyword">call </span>mpi_bcast(<a class="code" href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">snapshotnext</a>,1,mpi_integer,0,<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;    <span class="keyword">call </span>mpi_bcast(<a class="code" href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">slicenext</a>,1,mpi_integer,0,<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;    <span class="keyword">call </span>mpi_bcast(<a class="code" href="namespacemod__global__parameters.html#ae5c84337d8ace067e3744f286305044c">collapsenext</a>,1,mpi_integer,0,<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    <span class="keyword">call </span>mpi_bcast(stagger_mark_dat,1,mpi_logical,0,<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160; </div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;    <span class="comment">! Allocate send/receive buffer</span></div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    n_values = <a class="code" href="namespacemod__input__output__helper.html#a54d24b33757cb6dc549aeb19a2563964">count_ix</a>(ixg^<a class="code" href="namespacemod__global__parameters.html#a66b6d102b0c1abd62b12a11b7fdb31b3">ll</a>) * <a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;    <span class="keywordflow">if</span>(stagger_mark_dat) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;      n_values = n_values + <a class="code" href="namespacemod__input__output__helper.html#a54d24b33757cb6dc549aeb19a2563964">count_ix</a>(ixgs^<a class="code" href="namespacemod__global__parameters.html#a66b6d102b0c1abd62b12a11b7fdb31b3">ll</a>) * nws</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;    <span class="keyword">allocate</span>(w_buffer(n_values))</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    <span class="keyword">allocate</span>(w(ixg^t,1:<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>))</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160; </div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    <a class="code" href="namespacemod__forest.html#a2698b7425dadfb438f2d8e2a9e70b497">nleafs_active</a> = <a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a></div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160; </div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a> == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;      <span class="keyword">call </span>mpi_file_seek(file_handle, offset_tree_info, &amp;</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;           mpi_seek_set, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160; </div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacemod__functions__forest.html#a693fb7f8cc66f54e57220b83e219320e">read_forest</a>(file_handle)</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160; </div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;    <span class="keywordflow">do</span> morton_no=<a class="code" href="namespacemod__forest.html#a4404ff14f2bb4b3a5ff3a95649b5e403">morton_start</a>(<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>),<a class="code" href="namespacemod__forest.html#ab13fdb8137df0624e14825e47efe67da">morton_stop</a>(<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>)</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;      igrid=<a class="code" href="namespacemod__forest.html#a0baec555ee17dcbc0a479ce1ffcec985">sfc_to_igrid</a>(morton_no)</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemod__amr__solution__node.html#a5360422247c76466eb60cf0a2d6fd5e9">alloc_node</a>(igrid)</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160; </div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;      <span class="keyword">call </span>mpi_file_seek(file_handle, offset_block_data, mpi_seek_set, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160; </div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;      iread = 0</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;      <span class="keywordflow">do</span> ipe = 0, <a class="code" href="namespacemod__global__parameters.html#a879ff9a3d86e228553c9e44151a31574">npe</a>-1</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;        <span class="keywordflow">do</span> morton_no=<a class="code" href="namespacemod__forest.html#a4404ff14f2bb4b3a5ff3a95649b5e403">morton_start</a>(ipe),<a class="code" href="namespacemod__forest.html#ab13fdb8137df0624e14825e47efe67da">morton_stop</a>(ipe)</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;          iread=iread+1</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;          itag=morton_no</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160; </div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;          <span class="keyword">call </span>mpi_file_read(file_handle,ix_buffer(1:2*ndim), 2*ndim, &amp;</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;               mpi_integer, istatus,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160; </div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;          <span class="comment">! Construct ixO^L array from number of ghost cells</span></div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;          {ixomin^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> = ixmlo^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> - ix_buffer(^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a>)\}</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;          {ixomax^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> = ixmhi^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> + ix_buffer(ndim+^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a>)\}</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;          n_values = <a class="code" href="namespacemod__input__output__helper.html#a54d24b33757cb6dc549aeb19a2563964">count_ix</a>(ixo^l) * <a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a></div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;          <span class="keywordflow">if</span>(stagger_mark_dat) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;            {ixosmin^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> = ixomin^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> - 1\}</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;            {ixosmax^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> = ixomax^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a>\}</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;            n_values_stagger = n_values</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;            n_values = n_values + <a class="code" href="namespacemod__input__output__helper.html#a54d24b33757cb6dc549aeb19a2563964">count_ix</a>(ixos^l) * nws</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160; </div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;          <span class="keyword">call </span>mpi_file_read(file_handle, w_buffer, n_values, &amp;</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;               mpi_double_precision, istatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160; </div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a> == ipe) <span class="keywordflow">then</span> <span class="comment">! Root task</span></div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;            igrid=<a class="code" href="namespacemod__forest.html#a0baec555ee17dcbc0a479ce1ffcec985">sfc_to_igrid</a>(morton_no)</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;            <a class="code" href="namespacemod__global__parameters.html#a026d4f7c417820e04a0731db6833204b">block</a>=&gt;ps(igrid)</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;            <span class="keywordflow">if</span>(stagger_mark_dat) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;              w(ixo^s, 1:<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>) = reshape(w_buffer(1:n_values_stagger), &amp;</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;                   shape(w(ixo^s, 1:<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>)))</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;              <span class="keywordflow">if</span>(<a class="code" href="namespacemod__global__parameters.html#a4ebd0a5ae560288eeb5dfd3b2f251429">stagger_grid</a>) &amp;</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;              ps(igrid)%ws(ixos^s,1:nws)=reshape(w_buffer(n_values_stagger+1:n_values), &amp;</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                   shape(ws(ixos^s, 1:nws)))</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;              w(ixo^s, 1:<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>) = reshape(w_buffer(1:n_values), &amp;</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;                   shape(w(ixo^s, 1:<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>)))</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;<span class="keywordflow">            end if</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>&lt;nw) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;              <span class="keywordflow">if</span> (<span class="keyword">associated</span>(<a class="code" href="namespacemod__usr__methods.html#ae95367023a331f1118de73c42283b348">usr_transform_w</a>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;                <span class="keyword">call </span><a class="code" href="namespacemod__usr__methods.html#ae95367023a331f1118de73c42283b348">usr_transform_w</a>(ixg^<a class="code" href="namespacemod__global__parameters.html#a66b6d102b0c1abd62b12a11b7fdb31b3">ll</a>,<a class="code" href="namespacemod__global__parameters.html#a6f52fc825865569352db4ebc034361b4">ixm</a>^<a class="code" href="namespacemod__global__parameters.html#a66b6d102b0c1abd62b12a11b7fdb31b3">ll</a>,<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>,w,ps(igrid)%x,ps(igrid)%w)</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;                ps(igrid)%w(ixo^s,1:<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>)=w(ixo^s,1:<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>)</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="keywordflow">              end if</span></div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>&gt;nw) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;              <span class="keywordflow">if</span> (<span class="keyword">associated</span>(<a class="code" href="namespacemod__usr__methods.html#ae95367023a331f1118de73c42283b348">usr_transform_w</a>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;                <span class="keyword">call </span><a class="code" href="namespacemod__usr__methods.html#ae95367023a331f1118de73c42283b348">usr_transform_w</a>(ixg^<a class="code" href="namespacemod__global__parameters.html#a66b6d102b0c1abd62b12a11b7fdb31b3">ll</a>,<a class="code" href="namespacemod__global__parameters.html#a6f52fc825865569352db4ebc034361b4">ixm</a>^<a class="code" href="namespacemod__global__parameters.html#a66b6d102b0c1abd62b12a11b7fdb31b3">ll</a>,<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>,w,ps(igrid)%x,ps(igrid)%w)</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;              <span class="keywordflow">else</span></div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;                ps(igrid)%w(ixo^s,1:nw)=w(ixo^s,1:nw)</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;<span class="keywordflow">              end if</span></div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;              ps(igrid)%w(ixo^s,1:nw)=w(ixo^s,1:nw)</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;<span class="keywordflow">            end if</span></div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;            <span class="keyword">call </span>mpi_send([ ixo^l, n_values ], 2*ndim+1, &amp;</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;                 mpi_integer, ipe, itag, <a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;            <span class="keyword">call </span>mpi_send(w_buffer, n_values, &amp;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;                 mpi_double_precision, ipe, itag, <a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160; </div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;      <span class="keyword">call </span>mpi_file_close(file_handle,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160; </div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;    <span class="keywordflow">else</span> <span class="comment">! mype &gt; 0</span></div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160; </div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;      <span class="keywordflow">do</span> morton_no=<a class="code" href="namespacemod__forest.html#a4404ff14f2bb4b3a5ff3a95649b5e403">morton_start</a>(<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>),<a class="code" href="namespacemod__forest.html#ab13fdb8137df0624e14825e47efe67da">morton_stop</a>(<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>)</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;        igrid=<a class="code" href="namespacemod__forest.html#a0baec555ee17dcbc0a479ce1ffcec985">sfc_to_igrid</a>(morton_no)</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;        <a class="code" href="namespacemod__global__parameters.html#a026d4f7c417820e04a0731db6833204b">block</a>=&gt;ps(igrid)</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        itag=morton_no</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160; </div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;        <span class="keyword">call </span>mpi_recv(ix_buffer, 2*ndim+1, mpi_integer, 0, itag, <a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,&amp;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;             iorecvstatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;        {ixomin^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> = ix_buffer(^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a>)\}</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;        {ixomax^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> = ix_buffer(ndim+^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a>)\}</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;        n_values = ix_buffer(2*ndim+1)</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160; </div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;        <span class="keyword">call </span>mpi_recv(w_buffer, n_values, mpi_double_precision,&amp;</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;             0, itag, <a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>, iorecvstatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160; </div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;        <span class="keywordflow">if</span>(stagger_mark_dat) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;          n_values_stagger = <a class="code" href="namespacemod__input__output__helper.html#a54d24b33757cb6dc549aeb19a2563964">count_ix</a>(ixo^l) * <a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a></div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;          {ixosmin^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> = ixomin^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> - 1\}</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;          {ixosmax^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a> = ixomax^<a class="code" href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">d</a>\}</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;          w(ixo^s, 1:<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>) = reshape(w_buffer(1:n_values_stagger), &amp;</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;               shape(w(ixo^s, 1:<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>)))</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="namespacemod__global__parameters.html#a4ebd0a5ae560288eeb5dfd3b2f251429">stagger_grid</a>) &amp;</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;          ps(igrid)%ws(ixos^s,1:nws)=reshape(w_buffer(n_values_stagger+1:n_values), &amp;</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;               shape(ws(ixos^s, 1:nws)))</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;          w(ixo^s, 1:<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>) = reshape(w_buffer(1:n_values), &amp;</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;               shape(w(ixo^s, 1:<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>)))</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>&lt;nw) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(<a class="code" href="namespacemod__usr__methods.html#ae95367023a331f1118de73c42283b348">usr_transform_w</a>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;            <span class="keyword">call </span><a class="code" href="namespacemod__usr__methods.html#ae95367023a331f1118de73c42283b348">usr_transform_w</a>(ixg^<a class="code" href="namespacemod__global__parameters.html#a66b6d102b0c1abd62b12a11b7fdb31b3">ll</a>,<a class="code" href="namespacemod__global__parameters.html#a6f52fc825865569352db4ebc034361b4">ixm</a>^<a class="code" href="namespacemod__global__parameters.html#a66b6d102b0c1abd62b12a11b7fdb31b3">ll</a>,<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>,w,ps(igrid)%x,ps(igrid)%w)</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;            ps(igrid)%w(ixo^s,1:<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>)=w(ixo^s,1:<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>)</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>&gt;nw) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">associated</span>(<a class="code" href="namespacemod__usr__methods.html#ae95367023a331f1118de73c42283b348">usr_transform_w</a>)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;            <span class="keyword">call </span><a class="code" href="namespacemod__usr__methods.html#ae95367023a331f1118de73c42283b348">usr_transform_w</a>(ixg^<a class="code" href="namespacemod__global__parameters.html#a66b6d102b0c1abd62b12a11b7fdb31b3">ll</a>,<a class="code" href="namespacemod__global__parameters.html#a6f52fc825865569352db4ebc034361b4">ixm</a>^<a class="code" href="namespacemod__global__parameters.html#a66b6d102b0c1abd62b12a11b7fdb31b3">ll</a>,<a class="code" href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">nw_found</a>,w,ps(igrid)%x,ps(igrid)%w)</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;            ps(igrid)%w(ixo^s,1:nw)=w(ixo^s,1:nw)</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;          ps(igrid)%w(ixo^s,1:nw)=w(ixo^s,1:nw)</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;<span class="keywordflow">        end if</span></div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160; </div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    <span class="keyword">call </span>mpi_barrier(<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160; </div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#aa2d00e56c4444b0b4806a9c13ce2eff7">read_snapshot</a></div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160; </div>
<div class="line"><a name="l02368"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#afa9ed59afcf773a8f071c30b69d1bceb"> 2368</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#afa9ed59afcf773a8f071c30b69d1bceb">read_snapshot_old</a>()</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__forest.html">mod_forest</a></div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__amr__solution__node.html">mod_amr_solution_node</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__amr__solution__node.html#a5360422247c76466eb60cf0a2d6fd5e9">alloc_node</a></div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__functions__forest.html">mod_functions_forest</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__functions__forest.html#a693fb7f8cc66f54e57220b83e219320e">read_forest</a></div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160; </div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;    <span class="keywordtype">double precision</span>              :: wio(ixG^T,1:nw)</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;    <span class="keywordtype">integer</span>                       :: fh, igrid, Morton_no, iread</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;    <span class="keywordtype">integer</span>                       :: levmaxini, ndimini, ndirini</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;    <span class="keywordtype">integer</span>                       :: nwini, neqparini, nxini^D</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;    <span class="keywordtype">integer(kind=MPI_OFFSET_KIND)</span> :: offset</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;    <span class="keywordtype">integer</span>                       :: istatus(MPI_STATUS_SIZE)</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">allocatable</span>          :: iorecvstatus(:,:)</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;    <span class="keywordtype">integer</span>                       :: ipe,inrecv,nrecv</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;    <span class="keywordtype">integer</span>                       :: sendini(7+^ND)</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;    <span class="keywordtype">character(len=80)</span>             :: filename</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;    <span class="keywordtype">logical</span>                       :: fexist</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;    <span class="keywordtype">double precision</span>              :: eqpar_dummy(100)</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160; </div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;      <span class="keyword">call </span>mpi_file_open(mpi_comm_self,trim(<a class="code" href="namespacemod__global__parameters.html#a99b70d54ff2f08fb179495e2a07d1e44">restart_from_file</a>), &amp;</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;           mpi_mode_rdonly,mpi_info_null,fh,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160; </div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;      offset=-int(7*size_int+size_double,kind=mpi_offset_kind)</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;      <span class="keyword">call </span>mpi_file_seek(fh,offset,mpi_seek_end,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160; </div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh,<a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a>,1,mpi_integer,istatus,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;      <a class="code" href="namespacemod__forest.html#a2698b7425dadfb438f2d8e2a9e70b497">nleafs_active</a> = <a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a></div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh,levmaxini,1,mpi_integer,istatus,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh,ndimini,1,mpi_integer,istatus,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh,ndirini,1,mpi_integer,istatus,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh,nwini,1,mpi_integer,istatus,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh,neqparini,1,mpi_integer,istatus,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh,<a class="code" href="namespacemod__global__parameters.html#a37c8bbe2457c57b29f0bca3f7e1387fa">it</a>,1,mpi_integer,istatus,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh,<a class="code" href="namespacemod__global__parameters.html#a2bdc961e7304863887ec17a92ae5ac0a">global_time</a>,1,mpi_double_precision,istatus,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160; </div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;      <span class="comment">! check if settings are suitable for restart</span></div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;      <span class="keywordflow">if</span> (levmaxini&gt;<a class="code" href="namespacemod__global__parameters.html#ad3ffd4e35e76a0b86495789e5458fdd8">refine_max_level</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;number of levels in restart file = &quot;</span>,levmaxini</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;refine_max_level = &quot;</span>,<a class="code" href="namespacemod__global__parameters.html#ad3ffd4e35e76a0b86495789e5458fdd8">refine_max_level</a></div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;        <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;refine_max_level &lt; number of levels in restart file&quot;</span>)</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;      <span class="keywordflow">if</span> (ndimini/=<a class="code" href="namespacemod__global__parameters.html#a44dda3cb334ff384ee40e1797717cc38">ndim</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;ndim in restart file = &quot;</span>,ndimini</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;ndim = &quot;</span>,<a class="code" href="namespacemod__global__parameters.html#a44dda3cb334ff384ee40e1797717cc38">ndim</a></div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;        <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;reset ndim to ndim in restart file&quot;</span>)</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;      <span class="keywordflow">if</span> (ndirini/=<a class="code" href="namespacemod__global__parameters.html#a6d65136b05163940551f4704a2dc13b8">ndir</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;ndir in restart file = &quot;</span>,ndirini</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;ndir = &quot;</span>,<a class="code" href="namespacemod__global__parameters.html#a6d65136b05163940551f4704a2dc13b8">ndir</a></div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;        <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;reset ndir to ndir in restart file&quot;</span>)</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;      <span class="keywordflow">if</span> (nw/=nwini) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;nw=&quot;</span>,nw,<span class="stringliteral">&quot; and nw in restart file=&quot;</span>,nwini</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;        <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;currently, changing nw at restart is not allowed&quot;</span>)</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160; </div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      offset=offset-int(ndimini*size_int+neqparini*size_double,kind=mpi_offset_kind)</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;      <span class="keyword">call </span>mpi_file_seek(fh,offset,mpi_seek_end,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160; </div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;      {<span class="keyword">call </span>mpi_file_read(fh,nxini^d,1,mpi_integer,istatus,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)\}</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a1ae1204f8ad0508b0a13de9c48217b97">ixghi</a>^d/=nxini^d+2*<a class="code" href="namespacemod__global__parameters.html#ab7c7effa3bb9a3ba7e79fd548fc7c8aa">nghostcells</a>|.or.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;        <span class="keyword">write</span>(*,*) <span class="stringliteral">&quot;Error: reset resolution to &quot;</span>,nxini^d+2*<a class="code" href="namespacemod__global__parameters.html#ab7c7effa3bb9a3ba7e79fd548fc7c8aa">nghostcells</a></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;        <span class="keyword">call </span>mpistop(<span class="stringliteral">&quot;change with setamrvac&quot;</span>)</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160; </div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      <span class="keyword">call </span>mpi_file_read(fh,eqpar_dummy,neqparini, &amp;</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;           mpi_double_precision,istatus,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160; </div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;    <span class="comment">! broadcast the global parameters first</span></div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a879ff9a3d86e228553c9e44151a31574">npe</a>&gt;1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>==0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;        sendini=(/<a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a>,levmaxini,ndimini,ndirini,nwini,neqparini,<a class="code" href="namespacemod__global__parameters.html#a37c8bbe2457c57b29f0bca3f7e1387fa">it</a> ,^d&amp;nxini^d /)</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;      <span class="keyword">call </span>mpi_bcast(sendini,7+^nd,mpi_integer,0,<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;      <a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a>=sendini(1);levmaxini=sendini(2);ndimini=sendini(3);</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;      ndirini=sendini(4);nwini=sendini(5);</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;      neqparini=sendini(6);<a class="code" href="namespacemod__global__parameters.html#a37c8bbe2457c57b29f0bca3f7e1387fa">it</a>=sendini(7);</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;      nxini^d=sendini(7+^d);</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;      <a class="code" href="namespacemod__forest.html#a2698b7425dadfb438f2d8e2a9e70b497">nleafs_active</a> = <a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;      <span class="keyword">call </span>mpi_bcast(<a class="code" href="namespacemod__global__parameters.html#a2bdc961e7304863887ec17a92ae5ac0a">global_time</a>,1,mpi_double_precision,0,<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160; </div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a> == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;      offset = int(<a class="code" href="namespacemod__global__parameters.html#a9a0ac2f9464c2fc8e1c8a8cf4c613ac2">size_block_io</a>,kind=mpi_offset_kind) * &amp;</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;           int(<a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a>,kind=mpi_offset_kind)</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;      <span class="keyword">call </span>mpi_file_seek(fh,offset,mpi_seek_set,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160; </div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacemod__functions__forest.html#a693fb7f8cc66f54e57220b83e219320e">read_forest</a>(fh)</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160; </div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;    <span class="keywordflow">do</span> morton_no=<a class="code" href="namespacemod__forest.html#a4404ff14f2bb4b3a5ff3a95649b5e403">morton_start</a>(<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>),<a class="code" href="namespacemod__forest.html#ab13fdb8137df0624e14825e47efe67da">morton_stop</a>(<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>)</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;      igrid=<a class="code" href="namespacemod__forest.html#a0baec555ee17dcbc0a479ce1ffcec985">sfc_to_igrid</a>(morton_no)</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemod__amr__solution__node.html#a5360422247c76466eb60cf0a2d6fd5e9">alloc_node</a>(igrid)</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160; </div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>==0)<span class="keywordflow">then</span></div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;      iread=0</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160; </div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;      <span class="keywordflow">do</span> morton_no=<a class="code" href="namespacemod__forest.html#a4404ff14f2bb4b3a5ff3a95649b5e403">morton_start</a>(0),<a class="code" href="namespacemod__forest.html#ab13fdb8137df0624e14825e47efe67da">morton_stop</a>(0)</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;        igrid=<a class="code" href="namespacemod__forest.html#a0baec555ee17dcbc0a479ce1ffcec985">sfc_to_igrid</a>(morton_no)</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;        iread=iread+1</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;        offset=int(<a class="code" href="namespacemod__global__parameters.html#a9a0ac2f9464c2fc8e1c8a8cf4c613ac2">size_block_io</a>,kind=mpi_offset_kind) &amp;</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;             *int(morton_no-1,kind=mpi_offset_kind)</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;        <span class="keyword">call </span>mpi_file_read_at(fh,offset,ps(igrid)%w,1,<a class="code" href="namespacemod__global__parameters.html#a62bde5d85360265109ddae5ed9970686">type_block_io</a>, &amp;</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;             istatus,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a879ff9a3d86e228553c9e44151a31574">npe</a>&gt;1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;        <span class="keywordflow">do</span> ipe=1,<a class="code" href="namespacemod__global__parameters.html#a879ff9a3d86e228553c9e44151a31574">npe</a>-1</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;          <span class="keywordflow">do</span> morton_no=<a class="code" href="namespacemod__forest.html#a4404ff14f2bb4b3a5ff3a95649b5e403">morton_start</a>(ipe),<a class="code" href="namespacemod__forest.html#ab13fdb8137df0624e14825e47efe67da">morton_stop</a>(ipe)</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;            iread=iread+1</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;            itag=morton_no</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;            offset=int(<a class="code" href="namespacemod__global__parameters.html#a9a0ac2f9464c2fc8e1c8a8cf4c613ac2">size_block_io</a>,kind=mpi_offset_kind)&amp;</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;                 *int(morton_no-1,kind=mpi_offset_kind)</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;            <span class="keyword">call </span>mpi_file_read_at(fh,offset,wio,1,<a class="code" href="namespacemod__global__parameters.html#a62bde5d85360265109ddae5ed9970686">type_block_io</a>,&amp;</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;                 istatus,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;            <span class="keyword">call </span>mpi_send(wio,1,<a class="code" href="namespacemod__global__parameters.html#a62bde5d85360265109ddae5ed9970686">type_block_io</a>,ipe,itag,<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;<span class="keywordflow">        end do</span></div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;<span class="keywordflow">      end if</span></div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;      <span class="keyword">call </span>mpi_file_close(fh,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;      nrecv=(<a class="code" href="namespacemod__forest.html#ab13fdb8137df0624e14825e47efe67da">morton_stop</a>(<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>)-<a class="code" href="namespacemod__forest.html#a4404ff14f2bb4b3a5ff3a95649b5e403">morton_start</a>(<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>)+1)</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;      <span class="keyword">allocate</span>(iorecvstatus(mpi_status_size,nrecv))</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;      inrecv=0</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;      <span class="keywordflow">do</span> morton_no=<a class="code" href="namespacemod__forest.html#a4404ff14f2bb4b3a5ff3a95649b5e403">morton_start</a>(<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>),<a class="code" href="namespacemod__forest.html#ab13fdb8137df0624e14825e47efe67da">morton_stop</a>(<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a>)</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;        igrid=<a class="code" href="namespacemod__forest.html#a0baec555ee17dcbc0a479ce1ffcec985">sfc_to_igrid</a>(morton_no)</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;        itag=morton_no</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;        inrecv=inrecv+1</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;        <span class="keyword">call </span>mpi_recv(ps(igrid)%w,1,<a class="code" href="namespacemod__global__parameters.html#a62bde5d85360265109ddae5ed9970686">type_block_io</a>,0,itag,<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,&amp;</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;             iorecvstatus(:,inrecv),<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;<span class="keywordflow">      end do</span></div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;      <span class="keyword">deallocate</span>(iorecvstatus)</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160; </div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;    <span class="keyword">call </span>mpi_barrier(<a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>,<a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160; </div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#afa9ed59afcf773a8f071c30b69d1bceb">read_snapshot_old</a></div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;<span class="comment">  !&gt; Write volume-averaged values and other information to the log file</span></div>
<div class="line"><a name="l02509"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#ac699b426ea2d42b06de1c1798b98f96d"> 2509</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#ac699b426ea2d42b06de1c1798b98f96d">printlog_default</a></div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160; </div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__timing.html">mod_timing</a></div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__forest.html">mod_forest</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">nleafs</a>, <a class="code" href="namespacemod__forest.html#a2698b7425dadfb438f2d8e2a9e70b497">nleafs_active</a>, <a class="code" href="namespacemod__forest.html#a0a711678c456850a035b5c4a714533ab">nleafs_level</a></div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160; </div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;    <span class="keywordtype">logical</span>              :: fileopen</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;    <span class="keywordtype">integer</span>              :: i, iw, level</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;    <span class="keywordtype">double precision</span>     :: wmean(1:nw), total_volume</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;    <span class="keywordtype">double precision</span>     :: volume_coverage(refine_max_level)</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;    <span class="keywordtype">integer</span>              :: nx^D, nc, ncells, dit</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;    <span class="keywordtype">double precision</span>     :: dtTimeLast, now, cellupdatesPerSecond</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;    <span class="keywordtype">double precision</span>     :: activeBlocksPerCore, wctPerCodeTime, timeToFinish</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;    <span class="keywordtype">character(len=40)</span>    :: fmt_string</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    <span class="keywordtype">character(len=80)</span>    :: filename</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    <span class="keywordtype">character(len=2048)</span>  :: line</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">save</span>        :: opened  = .false.</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;    <span class="keywordtype">integer</span>              :: amode, istatus(MPI_STATUS_SIZE)</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>   :: my_unit = 20</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160; </div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    <span class="comment">! Compute the volume-average of w**1 = w</span></div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacemod__input__output.html#a9cf9ab211dc4836b216f1fe919d969ed">get_volume_average</a>(1, wmean, total_volume)</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160; </div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;    <span class="comment">! Compute the volume coverage</span></div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacemod__input__output.html#ab8da1bad0d6ad49b56081e6fe6bbcc85">get_volume_coverage</a>(volume_coverage)</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160; </div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a> == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160; </div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;       <span class="comment">! To compute cell updates per second, we do the following:</span></div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;       nx^d=ixmhi^d-ixmlo^d+1;</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;       nc={nx^d*}</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;       ncells = nc * <a class="code" href="namespacemod__forest.html#a2698b7425dadfb438f2d8e2a9e70b497">nleafs_active</a></div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160; </div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;       <span class="comment">! assumes the number of active leafs haven&#39;t changed since last compute.</span></div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;       now        = mpi_wtime()</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;       dit        = <a class="code" href="namespacemod__global__parameters.html#a37c8bbe2457c57b29f0bca3f7e1387fa">it</a> - <a class="code" href="namespacemod__timing.html#a235af821f4ab48e15d285460766ca0c6">ittimelast</a></div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;       dttimelast = now - <a class="code" href="namespacemod__timing.html#a7eaa0c0e6abb95dd60b30c345156d180">timelast</a></div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;       <a class="code" href="namespacemod__timing.html#a235af821f4ab48e15d285460766ca0c6">ittimelast</a> = <a class="code" href="namespacemod__global__parameters.html#a37c8bbe2457c57b29f0bca3f7e1387fa">it</a></div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;       <a class="code" href="namespacemod__timing.html#a7eaa0c0e6abb95dd60b30c345156d180">timelast</a>   = now</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;       cellupdatespersecond = dble(ncells) * dble(<a class="code" href="namespacemod__global__parameters.html#a04d1a4206037847c3c566b73b266fa64">nstep</a>) * &amp;</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;            dble(dit) / (dttimelast * dble(<a class="code" href="namespacemod__global__parameters.html#a879ff9a3d86e228553c9e44151a31574">npe</a>))</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160; </div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;       <span class="comment">! blocks per core:</span></div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;       activeblockspercore = dble(<a class="code" href="namespacemod__forest.html#a2698b7425dadfb438f2d8e2a9e70b497">nleafs_active</a>) / dble(<a class="code" href="namespacemod__global__parameters.html#a879ff9a3d86e228553c9e44151a31574">npe</a>)</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160; </div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;       <span class="comment">! Wall clock time per code time unit in seconds:</span></div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;       wctpercodetime = dttimelast / max(dit * <a class="code" href="namespacemod__global__parameters.html#a696248795de3f887232834d6136b8501">dt</a>, epsilon(1.0d0))</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160; </div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;       <span class="comment">! Wall clock time to finish in hours:</span></div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;       timetofinish = (<a class="code" href="namespacemod__global__parameters.html#a2dd037f0c45d7e7ba6a10c1f16092699">time_max</a> - <a class="code" href="namespacemod__global__parameters.html#a2bdc961e7304863887ec17a92ae5ac0a">global_time</a>) * wctpercodetime / 3600.0d0</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160; </div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;       <span class="comment">! On first entry, open the file and generate the header</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;       <span class="keywordflow">if</span> (.not. opened) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160; </div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;          filename = trim(<a class="code" href="namespacemod__global__parameters.html#acca226f88fb362bae425ca71f3742d09">base_filename</a>) // <span class="stringliteral">&quot;.log&quot;</span></div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160; </div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;          <span class="comment">! Delete the log when not doing a restart run</span></div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a99b70d54ff2f08fb179495e2a07d1e44">restart_from_file</a> == <a class="code" href="namespacemod__global__parameters.html#aba6bd3b8579dde6b7c68f65ab628a049">undefined</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;             <span class="keyword">open</span>(unit=my_unit,file=trim(filename),status=<span class="stringliteral">&#39;replace&#39;</span>)</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;             <span class="keyword">close</span>(my_unit, status=<span class="stringliteral">&#39;delete&#39;</span>)</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160; </div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;          amode    = ior(mpi_mode_create,mpi_mode_wronly)</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;          amode    = ior(amode,mpi_mode_append)</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160; </div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;          <span class="keyword">call </span>mpi_file_open(mpi_comm_self, filename, amode, &amp;</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;               mpi_info_null, <a class="code" href="namespacemod__global__parameters.html#afffa1fd3e8b551b3f2ba9defbcc88f50">log_fh</a>, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160; </div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;          opened = .true.</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160; </div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;          <span class="comment">! Start of file headern</span></div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;          line = <span class="stringliteral">&quot;it global_time dt&quot;</span></div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;          <span class="keywordflow">do</span> level=1,nw</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;             i = len_trim(line) + 2</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;             <span class="keyword">write</span>(line(i:),<span class="stringliteral">&quot;(a,a)&quot;</span>) trim(cons_wnames(level)), <span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160; </div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;          <span class="comment">! Volume coverage per level</span></div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;          <span class="keywordflow">do</span> level = 1, refine_max_level</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;             i = len_trim(line) + 2</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;             <span class="keyword">write</span>(line(i:), <span class="stringliteral">&quot;(a,i0)&quot;</span>) <span class="stringliteral">&quot;c&quot;</span>, level</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160; </div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;          <span class="comment">! Cell counts per level</span></div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;          <span class="keywordflow">do</span> level=1,refine_max_level</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;             i = len_trim(line) + 2</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;             <span class="keyword">write</span>(line(i:), <span class="stringliteral">&quot;(a,i0)&quot;</span>) <span class="stringliteral">&quot;n&quot;</span>, level</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160; </div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;          <span class="comment">! Rest of file header</span></div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;          line = trim(line) // <span class="stringliteral">&quot; | Xload Xmemory &#39;Cell_Updates /second/core&#39;&quot;</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;          line = trim(line) // <span class="stringliteral">&quot; &#39;Active_Blocks/Core&#39; &#39;Wct Per Code Time [s]&#39;&quot;</span></div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;          line = trim(line) // <span class="stringliteral">&quot; &#39;TimeToFinish [hrs]&#39;&quot;</span></div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160; </div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;          <span class="comment">! Only write header if not restarting</span></div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a99b70d54ff2f08fb179495e2a07d1e44">restart_from_file</a> == <a class="code" href="namespacemod__global__parameters.html#aba6bd3b8579dde6b7c68f65ab628a049">undefined</a> .or. <a class="code" href="namespacemod__global__parameters.html#a5c1bf53d9221dda713b7731ca922f3d5">reset_time</a>) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;            <span class="keyword">call </span>mpi_file_write(<a class="code" href="namespacemod__global__parameters.html#afffa1fd3e8b551b3f2ba9defbcc88f50">log_fh</a>, trim(line) // new_line(<span class="stringliteral">&#39;a&#39;</span>), &amp;</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;                 len_trim(line)+1, mpi_character, istatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160; </div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;       <span class="comment">! Construct the line to be added to the log</span></div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160; </div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;       fmt_string = <span class="stringliteral">&#39;(&#39;</span> // <a class="code" href="namespacemod__input__output.html#abd164abbe2712c03076283f266ae3d52">fmt_i</a> // <span class="stringliteral">&#39;,2&#39;</span> // <a class="code" href="namespacemod__input__output.html#a5a4c8ad20085895e6afea0b6da413313">fmt_r</a> // <span class="stringliteral">&#39;)&#39;</span></div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;       <span class="keyword">write</span>(line, fmt_string) <a class="code" href="namespacemod__global__parameters.html#a37c8bbe2457c57b29f0bca3f7e1387fa">it</a>, <a class="code" href="namespacemod__global__parameters.html#a2bdc961e7304863887ec17a92ae5ac0a">global_time</a>, <a class="code" href="namespacemod__global__parameters.html#a696248795de3f887232834d6136b8501">dt</a></div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;       i = len_trim(line) + 2</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160; </div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;       <span class="keyword">write</span>(fmt_string, <span class="stringliteral">&#39;(a,i0,a)&#39;</span>) <span class="stringliteral">&#39;(&#39;</span>, nw, <a class="code" href="namespacemod__input__output.html#a5a4c8ad20085895e6afea0b6da413313">fmt_r</a> // <span class="stringliteral">&#39;)&#39;</span></div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;       <span class="keyword">write</span>(line(i:), fmt_string) wmean(1:nw)</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;       i = len_trim(line) + 2</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160; </div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;       <span class="keyword">write</span>(fmt_string, <span class="stringliteral">&#39;(a,i0,a)&#39;</span>) <span class="stringliteral">&#39;(&#39;</span>, refine_max_level, <a class="code" href="namespacemod__input__output.html#a5a4c8ad20085895e6afea0b6da413313">fmt_r</a> // <span class="stringliteral">&#39;)&#39;</span></div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;       <span class="keyword">write</span>(line(i:), fmt_string) volume_coverage(1:refine_max_level)</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;       i = len_trim(line) + 2</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160; </div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;       <span class="keyword">write</span>(fmt_string, <span class="stringliteral">&#39;(a,i0,a)&#39;</span>) <span class="stringliteral">&#39;(&#39;</span>, refine_max_level, <a class="code" href="namespacemod__input__output.html#abd164abbe2712c03076283f266ae3d52">fmt_i</a> // <span class="stringliteral">&#39;)&#39;</span></div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;       <span class="keyword">write</span>(line(i:), fmt_string) <a class="code" href="namespacemod__forest.html#a0a711678c456850a035b5c4a714533ab">nleafs_level</a>(1:refine_max_level)</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;       i = len_trim(line) + 2</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160; </div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;       fmt_string = <span class="stringliteral">&#39;(a,6&#39;</span> // <a class="code" href="namespacemod__input__output.html#ab0092e81ef07b5ca84ceddacc7c4d9f9">fmt_r2</a> // <span class="stringliteral">&#39;)&#39;</span></div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;       <span class="keyword">write</span>(line(i:), fmt_string) <span class="stringliteral">&#39;| &#39;</span>, <a class="code" href="namespacemod__global__parameters.html#a035d6325e94a0902078a9bb3e97a0565">xload</a>, <a class="code" href="namespacemod__global__parameters.html#ae7afe8b1acfca6926173e1a276056e2c">xmemory</a>, cellupdatespersecond, &amp;</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;            activeblockspercore, wctpercodetime, timetofinish</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160; </div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;       <span class="keyword">call </span>mpi_file_write(<a class="code" href="namespacemod__global__parameters.html#afffa1fd3e8b551b3f2ba9defbcc88f50">log_fh</a>, trim(line) // new_line(<span class="stringliteral">&#39;a&#39;</span>) , &amp;</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;            len_trim(line)+1, mpi_character, istatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160; </div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#ac699b426ea2d42b06de1c1798b98f96d">printlog_default</a></div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;<span class="comment">  !&gt; Print a log that can be used to check whether the code still produces the</span></div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;<span class="comment">  !&gt; same output (regression test)</span></div>
<div class="line"><a name="l02640"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#a97e4df1969002df5c3fcc551db7d354e"> 2640</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#a97e4df1969002df5c3fcc551db7d354e">printlog_regression_test</a>()</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160; </div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: n_modes = 2</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;    <span class="keywordtype">character(len=40)</span>  :: fmt_string</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;    <span class="keywordtype">character(len=2048)</span>  :: line</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">save</span>      :: file_open = .false.</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;    <span class="keywordtype">integer</span>            :: power</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;    <span class="keywordtype">double precision</span>   :: modes(nw, n_modes), volume</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;    <span class="keywordtype">integer</span>              :: amode, istatus(MPI_STATUS_SIZE)</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;    <span class="keywordtype">character(len=80)</span>    :: filename</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160; </div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;    <span class="keywordflow">do</span> power = 1, n_modes</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacemod__input__output.html#a9cf9ab211dc4836b216f1fe919d969ed">get_volume_average</a>(power, modes(:, power), volume)</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160; </div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mype</a> == 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;       <span class="keywordflow">if</span> (.not. file_open) <span class="keywordflow">then</span></div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;          filename = trim(<a class="code" href="namespacemod__global__parameters.html#acca226f88fb362bae425ca71f3742d09">base_filename</a>) // <span class="stringliteral">&quot;.log&quot;</span></div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;          amode    = ior(mpi_mode_create,mpi_mode_wronly)</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;          amode    = ior(amode,mpi_mode_append)</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160; </div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;          <span class="keyword">call </span>mpi_file_open(mpi_comm_self, filename, amode, &amp;</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;               mpi_info_null, <a class="code" href="namespacemod__global__parameters.html#afffa1fd3e8b551b3f2ba9defbcc88f50">log_fh</a>, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;          file_open = .true.</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160; </div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;          line= <span class="stringliteral">&quot;# time mean(w) mean(w**2)&quot;</span></div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;          <span class="keyword">call </span>mpi_file_write(<a class="code" href="namespacemod__global__parameters.html#afffa1fd3e8b551b3f2ba9defbcc88f50">log_fh</a>, trim(line) // new_line(<span class="stringliteral">&#39;a&#39;</span>), &amp;</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;                 len_trim(line)+1, mpi_character, istatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160; </div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;       <span class="keyword">write</span>(fmt_string, <span class="stringliteral">&quot;(a,i0,a)&quot;</span>) <span class="stringliteral">&quot;(&quot;</span>, nw * n_modes + 1, <a class="code" href="namespacemod__input__output.html#a5a4c8ad20085895e6afea0b6da413313">fmt_r</a> // <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;       <span class="keyword">write</span>(line, fmt_string) <a class="code" href="namespacemod__global__parameters.html#a2bdc961e7304863887ec17a92ae5ac0a">global_time</a>, modes</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;       <span class="keyword">call </span>mpi_file_write(<a class="code" href="namespacemod__global__parameters.html#afffa1fd3e8b551b3f2ba9defbcc88f50">log_fh</a>, trim(line) // new_line(<span class="stringliteral">&#39;a&#39;</span>) , &amp;</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;            len_trim(line)+1, mpi_character, istatus, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#a97e4df1969002df5c3fcc551db7d354e">printlog_regression_test</a></div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;<span class="comment">  !&gt; Compute mean(w**power) over the leaves of the grid. The first mode</span></div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;<span class="comment">  !&gt; (power=1) corresponds to the mean, the second to the mean squared values</span></div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;<span class="comment">  !&gt; and so on.</span></div>
<div class="line"><a name="l02681"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#a9cf9ab211dc4836b216f1fe919d969ed"> 2681</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#a9cf9ab211dc4836b216f1fe919d969ed">get_volume_average</a>(power, mode, volume)</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160; </div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>           :: power<span class="comment">     !&lt; Which mode to compute</span></div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;    <span class="keywordtype">double precision</span>, <span class="keywordtype">intent(out)</span> :: mode(nw)<span class="comment">  !&lt; The computed mode</span></div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;    <span class="keywordtype">double precision</span>, <span class="keywordtype">intent(out)</span> :: volume<span class="comment">    !&lt; The total grid volume</span></div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;    <span class="keywordtype">integer</span>                       :: iigrid, igrid, iw</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;    <span class="keywordtype">double precision</span>              :: wsum(nw+1)</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;    <span class="keywordtype">double precision</span>              :: dsum_recv(1:nw+1)</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160; </div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;    wsum(:) = 0</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160; </div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;    <span class="comment">! Loop over all the grids</span></div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;    <span class="keywordflow">do</span> iigrid = 1, igridstail</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;       igrid = igrids(iigrid)</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160; </div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;       <span class="comment">! Store total volume in last element</span></div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;       wsum(nw+1) = wsum(nw+1) + sum(ps(igrid)%dvolume(<a class="code" href="namespacemod__global__parameters.html#a6f52fc825865569352db4ebc034361b4">ixm</a>^t))</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160; </div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;       <span class="comment">! Compute the modes of the cell-centered variables, weighted by volume</span></div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;       <span class="keywordflow">do</span> iw = 1, nw</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;          wsum(iw) = wsum(iw) + &amp;</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;               sum(ps(igrid)%dvolume(<a class="code" href="namespacemod__global__parameters.html#a6f52fc825865569352db4ebc034361b4">ixm</a>^t)*ps(igrid)%w(<a class="code" href="namespacemod__global__parameters.html#a6f52fc825865569352db4ebc034361b4">ixm</a>^t,iw)**power)</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160; </div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;    <span class="comment">! Make the information available on all tasks</span></div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;    <span class="keyword">call </span>mpi_allreduce(wsum, dsum_recv, nw+1, mpi_double_precision, &amp;</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;         mpi_sum, <a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160; </div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    <span class="comment">! Set the volume and the average</span></div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;    volume = dsum_recv(nw+1)</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;    mode   = dsum_recv(1:nw) / volume</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160; </div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#a9cf9ab211dc4836b216f1fe919d969ed">get_volume_average</a></div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;<span class="comment">  !&gt; Compute how much of the domain is covered by each grid level. This routine</span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;<span class="comment">  !&gt; does not take a non-Cartesian geometry into account.</span></div>
<div class="line"><a name="l02719"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#ab8da1bad0d6ad49b56081e6fe6bbcc85"> 2719</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#ab8da1bad0d6ad49b56081e6fe6bbcc85">get_volume_coverage</a>(vol_cov)</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160; </div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    <span class="keywordtype">double precision</span>, <span class="keywordtype">intent(out)</span> :: vol_cov(1:refine_max_level)</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;    <span class="keywordtype">double precision</span>              :: dsum_recv(1:refine_max_level)</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    <span class="keywordtype">integer</span>                       :: iigrid, igrid, iw, level</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160; </div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;    <span class="comment">! First determine the total &#39;flat&#39; volume in each level</span></div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;    vol_cov(1:refine_max_level)=zero</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160; </div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;    <span class="keywordflow">do</span> iigrid = 1, igridstail</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;       igrid          = igrids(iigrid);</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;       level          = <a class="code" href="namespacemod__global__parameters.html#aed90569afef4769570ed43ec84c80975">node</a>(<a class="code" href="namespacemod__global__parameters.html#a6491b365821029b96f98797234dd2839">plevel_</a>,igrid)</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;       vol_cov(level) = vol_cov(level)+ &amp;</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;            {(<a class="code" href="namespacemod__global__parameters.html#a9dd666c3ecb8ef351f14f46cf32a3a62">rnode</a>(<a class="code" href="namespacemod__global__parameters.html#ac7028ff82a4d1fd8d5ddf936665837c3">rpxmax</a>^<a class="code" href="namespacemod__global__parameters.html#aa3194833cc9e7e739ed1fa396655a636">d_</a>,igrid)-<a class="code" href="namespacemod__global__parameters.html#a9dd666c3ecb8ef351f14f46cf32a3a62">rnode</a>(<a class="code" href="namespacemod__global__parameters.html#a479b16476da7b1ec12a73e7815a61614">rpxmin</a>^<a class="code" href="namespacemod__global__parameters.html#aa3194833cc9e7e739ed1fa396655a636">d_</a>,igrid))|*}</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160; </div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;    <span class="comment">! Make the information available on all tasks</span></div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;    <span class="keyword">call </span>mpi_allreduce(vol_cov, dsum_recv, refine_max_level, mpi_double_precision, &amp;</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;         mpi_sum, <a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160; </div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;    <span class="comment">! Normalize</span></div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;    vol_cov = dsum_recv / sum(dsum_recv)</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#ab8da1bad0d6ad49b56081e6fe6bbcc85">get_volume_coverage</a></div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;<span class="comment">  !&gt; Compute the volume average of func(w) over the leaves of the grid.</span></div>
<div class="line"><a name="l02745"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#a846c54d7767425c6f966c4db1ad1c235"> 2745</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#a846c54d7767425c6f966c4db1ad1c235">get_volume_average_func</a>(func, f_avg, volume)</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160; </div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;    <span class="keyword">interface</span></div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;       <span class="keywordtype">pure</span> <span class="keyword">function </span>func(w_vec, w_size) <span class="keyword">result</span>(val)</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;         <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span>          :: w_size</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;         <span class="keywordtype">double precision</span>, <span class="keywordtype">intent(in)</span> :: w_vec(w_size)</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;         <span class="keywordtype">double precision</span>             :: val</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;       <span class="keyword">end function </span>func</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;    <span class="keyword">end interface</span></div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;    <span class="keywordtype">double precision</span>, <span class="keywordtype">intent(out)</span> :: f_avg<span class="comment">  !&lt; The volume average of func</span></div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;    <span class="keywordtype">double precision</span>, <span class="keywordtype">intent(out)</span> :: volume<span class="comment">    !&lt; The total grid volume</span></div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;    <span class="keywordtype">integer</span>                       :: iigrid, igrid, i^D</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;    <span class="keywordtype">double precision</span>              :: wsum(2)</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;    <span class="keywordtype">double precision</span>              :: dsum_recv(2)</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160; </div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;    wsum(:) = 0</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160; </div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;    <span class="comment">! Loop over all the grids</span></div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    <span class="keywordflow">do</span> iigrid = 1, igridstail</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;       igrid = igrids(iigrid)</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160; </div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;       <span class="comment">! Store total volume in last element</span></div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;       wsum(2) = wsum(2) + sum(ps(igrid)%dvolume(<a class="code" href="namespacemod__global__parameters.html#a6f52fc825865569352db4ebc034361b4">ixm</a>^t))</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160; </div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;       <span class="comment">! Compute the modes of the cell-centered variables, weighted by volume</span></div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;       {<span class="keywordflow">do</span> i^d = ixmlo^d, ixmhi^d\}</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;       wsum(1) = wsum(1) + ps(igrid)%dvolume(i^d) * &amp;</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;            func(ps(igrid)%w(i^d, :), nw)</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;       {<span class="keyword">end </span>do\}</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160; </div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    <span class="comment">! Make the information available on all tasks</span></div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;    <span class="keyword">call </span>mpi_allreduce(wsum, dsum_recv, 2, mpi_double_precision, &amp;</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;         mpi_sum, icomm, ierrmpi)</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160; </div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;    <span class="comment">! Set the volume and the average</span></div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    volume = dsum_recv(2)</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;    f_avg  = dsum_recv(1) / volume</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160; </div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#a846c54d7767425c6f966c4db1ad1c235">get_volume_average_func</a></div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;<span class="comment">  !&gt; Compute global maxima of iw variables over the leaves of the grid.</span></div>
<div class="line"><a name="l02788"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#a86886a7d99e5a874352cfb6385dbd1f0"> 2788</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#a86886a7d99e5a874352cfb6385dbd1f0">get_global_maxima</a>(wmax)</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160; </div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;    <span class="keywordtype">double precision</span>, <span class="keywordtype">intent(out)</span> :: wmax(nw)<span class="comment">  !&lt; The global maxima</span></div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160; </div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;    <span class="keywordtype">integer</span>                       :: iigrid, igrid, iw</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;    <span class="keywordtype">double precision</span>              :: wmax_mype(nw),wmax_recv(nw)</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160; </div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;    wmax_mype(1:nw) = -bigdouble</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160; </div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;    <span class="comment">! Loop over all the grids</span></div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;    <span class="keywordflow">do</span> iigrid = 1, igridstail</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;       igrid = igrids(iigrid)</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;       <span class="keywordflow">do</span> iw = 1, nw</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;          wmax_mype(iw)=max(wmax_mype(iw),maxval(ps(igrid)%w(<a class="code" href="namespacemod__global__parameters.html#a6f52fc825865569352db4ebc034361b4">ixm</a>^t,iw)))</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160; </div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    <span class="comment">! Make the information available on all tasks</span></div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    <span class="keyword">call </span>mpi_allreduce(wmax_mype, wmax_recv, nw, mpi_double_precision, &amp;</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;         mpi_max, <a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160; </div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;    wmax(1:nw)=wmax_recv(1:nw)</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160; </div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#a86886a7d99e5a874352cfb6385dbd1f0">get_global_maxima</a></div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;<span class="comment">  !&gt; Compute global minima of iw variables over the leaves of the grid.</span></div>
<div class="line"><a name="l02815"></a><span class="lineno"><a class="line" href="namespacemod__input__output.html#a84c632bdd9b080c72ef3b930138ee80a"> 2815</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacemod__input__output.html#a84c632bdd9b080c72ef3b930138ee80a">get_global_minima</a>(wmin)</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacemod__global__parameters.html">mod_global_parameters</a></div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160; </div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;    <span class="keywordtype">double precision</span>, <span class="keywordtype">intent(out)</span> :: wmin(nw)<span class="comment">  !&lt; The global maxima</span></div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160; </div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;    <span class="keywordtype">integer</span>                       :: iigrid, igrid, iw</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;    <span class="keywordtype">double precision</span>              :: wmin_mype(nw),wmin_recv(nw)</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160; </div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;    wmin_mype(1:nw) = bigdouble</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160; </div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;    <span class="comment">! Loop over all the grids</span></div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;    <span class="keywordflow">do</span> iigrid = 1, igridstail</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;       igrid = igrids(iigrid)</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;       <span class="keywordflow">do</span> iw = 1, nw</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;          wmin_mype(iw)=min(wmin_mype(iw),minval(ps(igrid)%w(<a class="code" href="namespacemod__global__parameters.html#a6f52fc825865569352db4ebc034361b4">ixm</a>^t,iw)))</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160; </div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;    <span class="comment">! Make the information available on all tasks</span></div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;    <span class="keyword">call </span>mpi_allreduce(wmin_mype, wmin_recv, nw, mpi_double_precision, &amp;</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;         mpi_min, <a class="code" href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">icomm</a>, <a class="code" href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">ierrmpi</a>)</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160; </div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;    wmin(1:nw)=wmin_recv(1:nw)</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160; </div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacemod__input__output.html#a84c632bdd9b080c72ef3b930138ee80a">get_global_minima</a></div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160; </div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160; </div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160; </div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;<span class="keyword">end module </span><a class="code" href="namespacemod__input__output.html">mod_input_output</a></div>
<div class="ttc" id="anamespacemod__amr__solution__node_html"><div class="ttname"><a href="namespacemod__amr__solution__node.html">mod_amr_solution_node</a></div><div class="ttdef"><b>Definition:</b> <a href="mod__amr__solution__node_8t_source.html#l00001">mod_amr_solution_node.t:1</a></div></div>
<div class="ttc" id="anamespacemod__amr__solution__node_html_a5360422247c76466eb60cf0a2d6fd5e9"><div class="ttname"><a href="namespacemod__amr__solution__node.html#a5360422247c76466eb60cf0a2d6fd5e9">mod_amr_solution_node::alloc_node</a></div><div class="ttdeci">subroutine, public alloc_node(igrid)</div><div class="ttdoc">allocate arrays on igrid node</div><div class="ttdef"><b>Definition:</b> <a href="mod__amr__solution__node_8t_source.html#l00060">mod_amr_solution_node.t:61</a></div></div>
<div class="ttc" id="anamespacemod__collapse_html"><div class="ttname"><a href="namespacemod__collapse.html">mod_collapse</a></div><div class="ttdoc">Collapses D-dimensional output to D-1 view by line-of-sight integration.</div><div class="ttdef"><b>Definition:</b> <a href="mod__collapse_8t_source.html#l00004">mod_collapse.t:4</a></div></div>
<div class="ttc" id="anamespacemod__collapse_html_ae345a692009d6f8bf85ddd4cdb30cb4e"><div class="ttname"><a href="namespacemod__collapse.html#ae345a692009d6f8bf85ddd4cdb30cb4e">mod_collapse::write_collapsed</a></div><div class="ttdeci">subroutine write_collapsed</div><div class="ttdef"><b>Definition:</b> <a href="mod__collapse_8t_source.html#l00011">mod_collapse.t:12</a></div></div>
<div class="ttc" id="anamespacemod__comm__lib_html"><div class="ttname"><a href="namespacemod__comm__lib.html">mod_comm_lib</a></div><div class="ttdef"><b>Definition:</b> <a href="mod__comm__lib_8t_source.html#l00001">mod_comm_lib.t:1</a></div></div>
<div class="ttc" id="anamespacemod__comm__lib_html_a9b6f1a8fd13bc5670e3b426151c34048"><div class="ttname"><a href="namespacemod__comm__lib.html#a9b6f1a8fd13bc5670e3b426151c34048">mod_comm_lib::mpistop</a></div><div class="ttdeci">subroutine, public mpistop(message)</div><div class="ttdoc">Exit MPI-AMRVAC with an error message.</div><div class="ttdef"><b>Definition:</b> <a href="mod__comm__lib_8t_source.html#l00207">mod_comm_lib.t:208</a></div></div>
<div class="ttc" id="anamespacemod__convert__files_html"><div class="ttname"><a href="namespacemod__convert__files.html">mod_convert_files</a></div><div class="ttdef"><b>Definition:</b> <a href="mod__convert__files_8t_source.html#l00001">mod_convert_files.t:1</a></div></div>
<div class="ttc" id="anamespacemod__convert__files_html_a62a6fb3fa85f5bb311485d3dc140562c"><div class="ttname"><a href="namespacemod__convert__files.html#a62a6fb3fa85f5bb311485d3dc140562c">mod_convert_files::generate_plotfile</a></div><div class="ttdeci">subroutine generate_plotfile</div><div class="ttdef"><b>Definition:</b> <a href="mod__convert__files_8t_source.html#l00009">mod_convert_files.t:10</a></div></div>
<div class="ttc" id="anamespacemod__forest_html"><div class="ttname"><a href="namespacemod__forest.html">mod_forest</a></div><div class="ttdoc">Module with basic grid data structures.</div><div class="ttdef"><b>Definition:</b> <a href="mod__forest_8t_source.html#l00002">mod_forest.t:2</a></div></div>
<div class="ttc" id="anamespacemod__forest_html_a0a711678c456850a035b5c4a714533ab"><div class="ttname"><a href="namespacemod__forest.html#a0a711678c456850a035b5c4a714533ab">mod_forest::nleafs_level</a></div><div class="ttdeci">integer, dimension(:), allocatable, save nleafs_level</div><div class="ttdoc">How many leaves are present per refinement level.</div><div class="ttdef"><b>Definition:</b> <a href="mod__forest_8t_source.html#l00081">mod_forest.t:81</a></div></div>
<div class="ttc" id="anamespacemod__forest_html_a0baec555ee17dcbc0a479ce1ffcec985"><div class="ttname"><a href="namespacemod__forest.html#a0baec555ee17dcbc0a479ce1ffcec985">mod_forest::sfc_to_igrid</a></div><div class="ttdeci">integer, dimension(:), allocatable, save sfc_to_igrid</div><div class="ttdoc">Go from a Morton number to an igrid index (for a single processor)</div><div class="ttdef"><b>Definition:</b> <a href="mod__forest_8t_source.html#l00053">mod_forest.t:53</a></div></div>
<div class="ttc" id="anamespacemod__forest_html_a2698b7425dadfb438f2d8e2a9e70b497"><div class="ttname"><a href="namespacemod__forest.html#a2698b7425dadfb438f2d8e2a9e70b497">mod_forest::nleafs_active</a></div><div class="ttdeci">integer nleafs_active</div><div class="ttdef"><b>Definition:</b> <a href="mod__forest_8t_source.html#l00078">mod_forest.t:78</a></div></div>
<div class="ttc" id="anamespacemod__forest_html_a4404ff14f2bb4b3a5ff3a95649b5e403"><div class="ttname"><a href="namespacemod__forest.html#a4404ff14f2bb4b3a5ff3a95649b5e403">mod_forest::morton_start</a></div><div class="ttdeci">integer, dimension(:), allocatable, save morton_start</div><div class="ttdoc">First Morton number per processor.</div><div class="ttdef"><b>Definition:</b> <a href="mod__forest_8t_source.html#l00062">mod_forest.t:62</a></div></div>
<div class="ttc" id="anamespacemod__forest_html_a5e704b8ee68d0f687cc5e6472b0a9cde"><div class="ttname"><a href="namespacemod__forest.html#a5e704b8ee68d0f687cc5e6472b0a9cde">mod_forest::nleafs</a></div><div class="ttdeci">integer, save nleafs</div><div class="ttdoc">Number of leaf block.</div><div class="ttdef"><b>Definition:</b> <a href="mod__forest_8t_source.html#l00076">mod_forest.t:76</a></div></div>
<div class="ttc" id="anamespacemod__forest_html_ab13fdb8137df0624e14825e47efe67da"><div class="ttname"><a href="namespacemod__forest.html#ab13fdb8137df0624e14825e47efe67da">mod_forest::morton_stop</a></div><div class="ttdeci">integer, dimension(:), allocatable, save morton_stop</div><div class="ttdoc">Last Morton number per processor.</div><div class="ttdef"><b>Definition:</b> <a href="mod__forest_8t_source.html#l00065">mod_forest.t:65</a></div></div>
<div class="ttc" id="anamespacemod__forest_html_ac396678668afad23e0f2f84cd8dcf8e8"><div class="ttname"><a href="namespacemod__forest.html#ac396678668afad23e0f2f84cd8dcf8e8">mod_forest::sfc</a></div><div class="ttdeci">integer, dimension(:,:), allocatable, save sfc</div><div class="ttdoc">Array to go from a Morton number to an igrid and processor index. Sfc(1:3, MN) contains [igrid,...</div><div class="ttdef"><b>Definition:</b> <a href="mod__forest_8t_source.html#l00043">mod_forest.t:43</a></div></div>
<div class="ttc" id="anamespacemod__forest_html_ac839cac53d5fa3fae1e594d3e88dfd60"><div class="ttname"><a href="namespacemod__forest.html#ac839cac53d5fa3fae1e594d3e88dfd60">mod_forest::nparents</a></div><div class="ttdeci">integer, save nparents</div><div class="ttdoc">Number of parent blocks.</div><div class="ttdef"><b>Definition:</b> <a href="mod__forest_8t_source.html#l00073">mod_forest.t:73</a></div></div>
<div class="ttc" id="anamespacemod__forest_html_acc8a365fd94c525036cef5fb1d67e2ca"><div class="ttname"><a href="namespacemod__forest.html#acc8a365fd94c525036cef5fb1d67e2ca">mod_forest::igrid_to_node</a></div><div class="ttdeci">type(tree_node_ptr), dimension(:,:), allocatable, save igrid_to_node</div><div class="ttdoc">Array to go from an [igrid, ipe] index to a node pointer.</div><div class="ttdef"><b>Definition:</b> <a href="mod__forest_8t_source.html#l00032">mod_forest.t:32</a></div></div>
<div class="ttc" id="anamespacemod__functions__forest_html"><div class="ttname"><a href="namespacemod__functions__forest.html">mod_functions_forest</a></div><div class="ttdef"><b>Definition:</b> <a href="mod__functions__forest_8t_source.html#l00001">mod_functions_forest.t:1</a></div></div>
<div class="ttc" id="anamespacemod__functions__forest_html_a5fe089544b6f559e305b5b6e41544191"><div class="ttname"><a href="namespacemod__functions__forest.html#a5fe089544b6f559e305b5b6e41544191">mod_functions_forest::write_forest</a></div><div class="ttdeci">subroutine, public write_forest(file_handle)</div><div class="ttdef"><b>Definition:</b> <a href="mod__functions__forest_8t_source.html#l00300">mod_functions_forest.t:301</a></div></div>
<div class="ttc" id="anamespacemod__functions__forest_html_a693fb7f8cc66f54e57220b83e219320e"><div class="ttname"><a href="namespacemod__functions__forest.html#a693fb7f8cc66f54e57220b83e219320e">mod_functions_forest::read_forest</a></div><div class="ttdeci">subroutine, public read_forest(file_handle)</div><div class="ttdef"><b>Definition:</b> <a href="mod__functions__forest_8t_source.html#l00335">mod_functions_forest.t:336</a></div></div>
<div class="ttc" id="anamespacemod__geometry_html"><div class="ttname"><a href="namespacemod__geometry.html">mod_geometry</a></div><div class="ttdoc">Module with geometry-related routines (e.g., divergence, curl)</div><div class="ttdef"><b>Definition:</b> <a href="mod__geometry_8t_source.html#l00002">mod_geometry.t:2</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html"><div class="ttname"><a href="namespacemod__global__parameters.html">mod_global_parameters</a></div><div class="ttdoc">This module contains definitions of global parameters and variables and some generic functions/subrou...</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00004">mod_global_parameters.t:4</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a00ec7c4fcdaf315d10fde08f15073a7f"><div class="ttname"><a href="namespacemod__global__parameters.html#a00ec7c4fcdaf315d10fde08f15073a7f">mod_global_parameters::typeentropy</a></div><div class="ttdeci">character(len=std_len), dimension(:), allocatable typeentropy</div><div class="ttdoc">Which type of entropy fix to use with Riemann-type solvers.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00602">mod_global_parameters.t:602</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a02302cec765e4436ca70725ef811cc10"><div class="ttname"><a href="namespacemod__global__parameters.html#a02302cec765e4436ca70725ef811cc10">mod_global_parameters::w_convert_factor</a></div><div class="ttdeci">double precision, dimension(:), allocatable w_convert_factor</div><div class="ttdoc">Conversion factors the primitive variables.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00302">mod_global_parameters.t:302</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a026d4f7c417820e04a0731db6833204b"><div class="ttname"><a href="namespacemod__global__parameters.html#a026d4f7c417820e04a0731db6833204b">mod_global_parameters::block</a></div><div class="ttdeci">type(state), pointer block</div><div class="ttdoc">Block pointer for using one block and its previous state.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00747">mod_global_parameters.t:747</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a035d6325e94a0902078a9bb3e97a0565"><div class="ttname"><a href="namespacemod__global__parameters.html#a035d6325e94a0902078a9bb3e97a0565">mod_global_parameters::xload</a></div><div class="ttdeci">double precision xload</div><div class="ttdoc">Stores the memory and load imbalance, used in printlog.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00310">mod_global_parameters.t:310</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a04d1a4206037847c3c566b73b266fa64"><div class="ttname"><a href="namespacemod__global__parameters.html#a04d1a4206037847c3c566b73b266fa64">mod_global_parameters::nstep</a></div><div class="ttdeci">integer nstep</div><div class="ttdoc">How many sub-steps the time integrator takes.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00533">mod_global_parameters.t:533</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a05670d1e36a9ade124b86238a3f6ecbb"><div class="ttname"><a href="namespacemod__global__parameters.html#a05670d1e36a9ade124b86238a3f6ecbb">mod_global_parameters::h_correction</a></div><div class="ttdeci">logical h_correction</div><div class="ttdoc">If true, do H-correction to fix the carbuncle problem at grid-aligned shocks.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00512">mod_global_parameters.t:512</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a057feb2697cc1ef7cee9e82c79d7eb27"><div class="ttname"><a href="namespacemod__global__parameters.html#a057feb2697cc1ef7cee9e82c79d7eb27">mod_global_parameters::it_max</a></div><div class="ttdeci">integer it_max</div><div class="ttdoc">Stop the simulation after this many time steps have been taken.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00518">mod_global_parameters.t:518</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a0887552b34b60da3d7f32328ded395a6"><div class="ttname"><a href="namespacemod__global__parameters.html#a0887552b34b60da3d7f32328ded395a6">mod_global_parameters::internalboundary</a></div><div class="ttdeci">logical internalboundary</div><div class="ttdoc">if there is an internal boundary</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00703">mod_global_parameters.t:703</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a09bdaca578aec7457ae3779ef78cd8eb"><div class="ttname"><a href="namespacemod__global__parameters.html#a09bdaca578aec7457ae3779ef78cd8eb">mod_global_parameters::level_io_min</a></div><div class="ttdeci">integer level_io_min</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00262">mod_global_parameters.t:262</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a0aa11ac2e9d07626a9de1812bc893dfa"><div class="ttname"><a href="namespacemod__global__parameters.html#a0aa11ac2e9d07626a9de1812bc893dfa">mod_global_parameters::r_opt_thick</a></div><div class="ttdeci">double precision r_opt_thick</div><div class="ttdoc">for spherical coordinate, region below it (unit=Rsun) is treated as not transparent</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00742">mod_global_parameters.t:742</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a0aadbd954bcc854018198195e2495e90"><div class="ttname"><a href="namespacemod__global__parameters.html#a0aadbd954bcc854018198195e2495e90">mod_global_parameters::filename_sxr</a></div><div class="ttdeci">character(len=std_len) filename_sxr</div><div class="ttdoc">Base file name for synthetic SXR emission output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00714">mod_global_parameters.t:714</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a0b521cf768ad9f682b1a8baf151e1956"><div class="ttname"><a href="namespacemod__global__parameters.html#a0b521cf768ad9f682b1a8baf151e1956">mod_global_parameters::tvdlfeps</a></div><div class="ttdeci">double precision tvdlfeps</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00617">mod_global_parameters.t:617</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a0de04bb7bac409bd7d38746f5ea7b3ef"><div class="ttname"><a href="namespacemod__global__parameters.html#a0de04bb7bac409bd7d38746f5ea7b3ef">mod_global_parameters::spectrum_wl</a></div><div class="ttdeci">integer spectrum_wl</div><div class="ttdoc">wave length for spectrum</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00734">mod_global_parameters.t:734</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a0f69ab118580f4dd69756f1e17754c15"><div class="ttname"><a href="namespacemod__global__parameters.html#a0f69ab118580f4dd69756f1e17754c15">mod_global_parameters::nocartesian</a></div><div class="ttdeci">logical nocartesian</div><div class="ttdoc">IO switches for conversion.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00258">mod_global_parameters.t:258</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a10e70ded54b27760f9a507dbade67353"><div class="ttname"><a href="namespacemod__global__parameters.html#a10e70ded54b27760f9a507dbade67353">mod_global_parameters::typepred1</a></div><div class="ttdeci">integer, dimension(:), allocatable typepred1</div><div class="ttdoc">The spatial discretization for the predictor step when using a two step PC method.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00540">mod_global_parameters.t:540</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a12163a591511198c1f7613eaa220e6c5"><div class="ttname"><a href="namespacemod__global__parameters.html#a12163a591511198c1f7613eaa220e6c5">mod_global_parameters::dtdiffpar</a></div><div class="ttdeci">double precision dtdiffpar</div><div class="ttdoc">For resistive MHD, the time step is also limited by the diffusion time: .</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00475">mod_global_parameters.t:475</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a122ab156050e3d8d53c27e3113d7f2a6"><div class="ttname"><a href="namespacemod__global__parameters.html#a122ab156050e3d8d53c27e3113d7f2a6">mod_global_parameters::dimsplit</a></div><div class="ttdeci">logical dimsplit</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00624">mod_global_parameters.t:624</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a12cefbb8860465ffae8acee3a4535376"><div class="ttname"><a href="namespacemod__global__parameters.html#a12cefbb8860465ffae8acee3a4535376">mod_global_parameters::typegrad</a></div><div class="ttdeci">character(len=std_len) typegrad</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00650">mod_global_parameters.t:650</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a1337000bcd79422ab891841e74f3715f"><div class="ttname"><a href="namespacemod__global__parameters.html#a1337000bcd79422ab891841e74f3715f">mod_global_parameters::reset_it</a></div><div class="ttdeci">logical reset_it</div><div class="ttdoc">If true, reset iteration count to 0.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00500">mod_global_parameters.t:500</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a19f0c8766e32f669bc7680685a55ea33"><div class="ttname"><a href="namespacemod__global__parameters.html#a19f0c8766e32f669bc7680685a55ea33">mod_global_parameters::small_pressure</a></div><div class="ttdeci">double precision small_pressure</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00357">mod_global_parameters.t:357</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a1ae1204f8ad0508b0a13de9c48217b97"><div class="ttname"><a href="namespacemod__global__parameters.html#a1ae1204f8ad0508b0a13de9c48217b97">mod_global_parameters::ixghi</a></div><div class="ttdeci">integer ixghi</div><div class="ttdoc">Upper index of grid block arrays.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00102">mod_global_parameters.t:102</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a1c0505dd1692e179fd6eb8e9d8cb553b"><div class="ttname"><a href="namespacemod__global__parameters.html#a1c0505dd1692e179fd6eb8e9d8cb553b">mod_global_parameters::geometry_name</a></div><div class="ttdeci">character(len=std_len) geometry_name</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00612">mod_global_parameters.t:612</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a1d6f8608af3df2b3b6d49fc64bcd346f"><div class="ttname"><a href="namespacemod__global__parameters.html#a1d6f8608af3df2b3b6d49fc64bcd346f">mod_global_parameters::lvc</a></div><div class="ttdeci">integer, dimension(3, 3, 3) lvc</div><div class="ttdoc">Levi-Civita tensor.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00451">mod_global_parameters.t:451</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a20c19e83ca0719c4a296a8c095f8454e"><div class="ttname"><a href="namespacemod__global__parameters.html#a20c19e83ca0719c4a296a8c095f8454e">mod_global_parameters::activate_unit_arcsec</a></div><div class="ttdeci">logical activate_unit_arcsec</div><div class="ttdoc">use arcsec as length unit of images/spectra</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00712">mod_global_parameters.t:712</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a21e3e22000a7bcf45c39c5afea731371"><div class="ttname"><a href="namespacemod__global__parameters.html#a21e3e22000a7bcf45c39c5afea731371">mod_global_parameters::source_split_usr</a></div><div class="ttdeci">logical source_split_usr</div><div class="ttdoc">Use split or unsplit way to add user's source terms, default: unsplit.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00621">mod_global_parameters.t:621</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a23b35ecdd0fd1864d80811b347464176"><div class="ttname"><a href="namespacemod__global__parameters.html#a23b35ecdd0fd1864d80811b347464176">mod_global_parameters::domain_nx</a></div><div class="ttdeci">integer domain_nx</div><div class="ttdoc">number of cells for each dimension in level-one mesh</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00093">mod_global_parameters.t:93</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a2643b30397384bf36289b3afb2d7dda3"><div class="ttname"><a href="namespacemod__global__parameters.html#a2643b30397384bf36289b3afb2d7dda3">mod_global_parameters::unitpar</a></div><div class="ttdeci">integer, parameter unitpar</div><div class="ttdoc">file handle for IO</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00247">mod_global_parameters.t:247</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a275f63f56e91b1535b6b9b255c6d6995"><div class="ttname"><a href="namespacemod__global__parameters.html#a275f63f56e91b1535b6b9b255c6d6995">mod_global_parameters::filename_spectrum</a></div><div class="ttdeci">character(len=std_len) filename_spectrum</div><div class="ttdoc">Base file name for synthetic EUV spectrum output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00732">mod_global_parameters.t:732</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a28e9a787f5148a24968434c81cdcd153"><div class="ttname"><a href="namespacemod__global__parameters.html#a28e9a787f5148a24968434c81cdcd153">mod_global_parameters::flatsh</a></div><div class="ttdeci">logical flatsh</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00619">mod_global_parameters.t:619</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a2bb0b481a238e6de804ec476a9cc0f2f"><div class="ttname"><a href="namespacemod__global__parameters.html#a2bb0b481a238e6de804ec476a9cc0f2f">mod_global_parameters::resume_previous_run</a></div><div class="ttdeci">logical resume_previous_run</div><div class="ttdoc">If true, restart a previous run from the latest snapshot.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00280">mod_global_parameters.t:280</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a2bdc961e7304863887ec17a92ae5ac0a"><div class="ttname"><a href="namespacemod__global__parameters.html#a2bdc961e7304863887ec17a92ae5ac0a">mod_global_parameters::global_time</a></div><div class="ttdeci">double precision global_time</div><div class="ttdoc">The global simulation time.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00478">mod_global_parameters.t:478</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a2cc0f16622648beea976f73191955bfc"><div class="ttname"><a href="namespacemod__global__parameters.html#a2cc0f16622648beea976f73191955bfc">mod_global_parameters::itsave</a></div><div class="ttdeci">integer, dimension(nsavehi, nfile) itsave</div><div class="ttdoc">Save output of type N on iterations itsave(:, N)</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00190">mod_global_parameters.t:190</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a2dd037f0c45d7e7ba6a10c1f16092699"><div class="ttname"><a href="namespacemod__global__parameters.html#a2dd037f0c45d7e7ba6a10c1f16092699">mod_global_parameters::time_max</a></div><div class="ttdeci">double precision time_max</div><div class="ttdoc">End time for the simulation.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00484">mod_global_parameters.t:484</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a31226ca76b94f6c33496105fd25e8fd9"><div class="ttname"><a href="namespacemod__global__parameters.html#a31226ca76b94f6c33496105fd25e8fd9">mod_global_parameters::kr</a></div><div class="ttdeci">integer, dimension(3, 3) kr</div><div class="ttdoc">Kronecker delta tensor.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00448">mod_global_parameters.t:448</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a32a063a74710338e40647f22e2cba2f8"><div class="ttname"><a href="namespacemod__global__parameters.html#a32a063a74710338e40647f22e2cba2f8">mod_global_parameters::logflag</a></div><div class="ttdeci">logical, dimension(:), allocatable logflag</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00618">mod_global_parameters.t:618</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a32b88ccd4a2d2fd290d36b61c28488f1"><div class="ttname"><a href="namespacemod__global__parameters.html#a32b88ccd4a2d2fd290d36b61c28488f1">mod_global_parameters::time_init</a></div><div class="ttdeci">double precision time_init</div><div class="ttdoc">Start time for the simulation.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00481">mod_global_parameters.t:481</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a33fdab327272a72d6c67c6267a6ab51d"><div class="ttname"><a href="namespacemod__global__parameters.html#a33fdab327272a72d6c67c6267a6ab51d">mod_global_parameters::stretch_uncentered</a></div><div class="ttdeci">logical stretch_uncentered</div><div class="ttdoc">If true, adjust mod_geometry routines to account for grid stretching (but the flux computation will n...</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00119">mod_global_parameters.t:119</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a3445cbdbb5912e5da0aafc9b83ec6300"><div class="ttname"><a href="namespacemod__global__parameters.html#a3445cbdbb5912e5da0aafc9b83ec6300">mod_global_parameters::firstprocess</a></div><div class="ttdeci">logical firstprocess</div><div class="ttdoc">If true, call initonegrid_usr upon restarting.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00506">mod_global_parameters.t:506</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a370863264a3b2f3734b6cfacdd8b2bed"><div class="ttname"><a href="namespacemod__global__parameters.html#a370863264a3b2f3734b6cfacdd8b2bed">mod_global_parameters::snapshotini</a></div><div class="ttdeci">integer snapshotini</div><div class="ttdoc">Resume from the snapshot with this index.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00277">mod_global_parameters.t:277</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a3730de6b193fa2d3fb50e979195ef518"><div class="ttname"><a href="namespacemod__global__parameters.html#a3730de6b193fa2d3fb50e979195ef518">mod_global_parameters::small_temperature</a></div><div class="ttdeci">double precision small_temperature</div><div class="ttdoc">error handling</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00357">mod_global_parameters.t:357</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a37c2dd951c58acfe58a69763e53d6bf4"><div class="ttname"><a href="namespacemod__global__parameters.html#a37c2dd951c58acfe58a69763e53d6bf4">mod_global_parameters::xprob</a></div><div class="ttdeci">double precision xprob</div><div class="ttdoc">minimum and maximum domain boundaries for each dimension</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00054">mod_global_parameters.t:54</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a37c8bbe2457c57b29f0bca3f7e1387fa"><div class="ttname"><a href="namespacemod__global__parameters.html#a37c8bbe2457c57b29f0bca3f7e1387fa">mod_global_parameters::it</a></div><div class="ttdeci">integer it</div><div class="ttdoc">Number of time steps taken.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00515">mod_global_parameters.t:515</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a38896e5173f553e8c0db326034221a64"><div class="ttname"><a href="namespacemod__global__parameters.html#a38896e5173f553e8c0db326034221a64">mod_global_parameters::filename_euv</a></div><div class="ttdeci">character(len=std_len) filename_euv</div><div class="ttdoc">Base file name for synthetic EUV emission output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00706">mod_global_parameters.t:706</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a389e1d707c9b879f63b549175adc6ab3"><div class="ttname"><a href="namespacemod__global__parameters.html#a389e1d707c9b879f63b549175adc6ab3">mod_global_parameters::loglimit</a></div><div class="ttdeci">logical, dimension(:), allocatable loglimit</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00618">mod_global_parameters.t:618</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a3accdc5892cc101cf66e709b7bd59dff"><div class="ttname"><a href="namespacemod__global__parameters.html#a3accdc5892cc101cf66e709b7bd59dff">mod_global_parameters::dg</a></div><div class="ttdeci">double precision, dimension(:), allocatable dg</div><div class="ttdoc">extent of grid blocks in domain per dimension, in array over levels</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00090">mod_global_parameters.t:90</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a3b867699253875817b4abd3a348b8f53"><div class="ttname"><a href="namespacemod__global__parameters.html#a3b867699253875817b4abd3a348b8f53">mod_global_parameters::it_init</a></div><div class="ttdeci">integer it_init</div><div class="ttdoc">initial iteration count</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00521">mod_global_parameters.t:521</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a3ba92b453fe4963537afc9cca083fba8"><div class="ttname"><a href="namespacemod__global__parameters.html#a3ba92b453fe4963537afc9cca083fba8">mod_global_parameters::typeboundary</a></div><div class="ttdeci">integer, dimension(:, :), allocatable typeboundary</div><div class="ttdoc">Array indicating the type of boundary condition per variable and per physical boundary.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00686">mod_global_parameters.t:686</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a3ca4430b2e1352a48833355f28427d9f"><div class="ttname"><a href="namespacemod__global__parameters.html#a3ca4430b2e1352a48833355f28427d9f">mod_global_parameters::ditregrid</a></div><div class="ttdeci">integer ditregrid</div><div class="ttdoc">Reconstruct the AMR grid once every ditregrid iteration(s)</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00415">mod_global_parameters.t:415</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a41a6de0584bd346508963bfac3653ae6"><div class="ttname"><a href="namespacemod__global__parameters.html#a41a6de0584bd346508963bfac3653ae6">mod_global_parameters::saveprim</a></div><div class="ttdeci">logical saveprim</div><div class="ttdoc">If true, convert from conservative to primitive variables in output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00290">mod_global_parameters.t:290</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a42fb75c82b1802e1084f00b534b555c9"><div class="ttname"><a href="namespacemod__global__parameters.html#a42fb75c82b1802e1084f00b534b555c9">mod_global_parameters::type_endian</a></div><div class="ttdeci">integer type_endian</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00262">mod_global_parameters.t:262</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a4395b960728400cb7612fc8591c39626"><div class="ttname"><a href="namespacemod__global__parameters.html#a4395b960728400cb7612fc8591c39626">mod_global_parameters::filename_whitelight</a></div><div class="ttdeci">character(len=std_len) filename_whitelight</div><div class="ttdoc">Base file name for synthetic white light.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00718">mod_global_parameters.t:718</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a43c682e6a92ae87edc89730d59af7b46"><div class="ttname"><a href="namespacemod__global__parameters.html#a43c682e6a92ae87edc89730d59af7b46">mod_global_parameters::convert_type</a></div><div class="ttdeci">character(len=std_len) convert_type</div><div class="ttdoc">Which format to use when converting.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00297">mod_global_parameters.t:297</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a44dda3cb334ff384ee40e1797717cc38"><div class="ttname"><a href="namespacemod__global__parameters.html#a44dda3cb334ff384ee40e1797717cc38">mod_global_parameters::ndim</a></div><div class="ttdeci">integer, parameter ndim</div><div class="ttdoc">Number of spatial dimensions for grid variables.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00062">mod_global_parameters.t:62</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a45e1d0bc4dbe15357349fdc359366fba"><div class="ttname"><a href="namespacemod__global__parameters.html#a45e1d0bc4dbe15357349fdc359366fba">mod_global_parameters::itfixgrid</a></div><div class="ttdeci">integer itfixgrid</div><div class="ttdoc">Fix the AMR grid after this many time steps.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00412">mod_global_parameters.t:412</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a45e7eb72fd08ffc0a68a5b9173da5a3b"><div class="ttname"><a href="namespacemod__global__parameters.html#a45e7eb72fd08ffc0a68a5b9173da5a3b">mod_global_parameters::filecollapse_</a></div><div class="ttdeci">integer, parameter filecollapse_</div><div class="ttdoc">Constant indicating collapsed output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00232">mod_global_parameters.t:232</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a47213c2deabf33173fab8d80bc64aa79"><div class="ttname"><a href="namespacemod__global__parameters.html#a47213c2deabf33173fab8d80bc64aa79">mod_global_parameters::level_io</a></div><div class="ttdeci">integer level_io</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00262">mod_global_parameters.t:262</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a4736ef04292da21cb89fb46425b36985"><div class="ttname"><a href="namespacemod__global__parameters.html#a4736ef04292da21cb89fb46425b36985">mod_global_parameters::amr_wavefilter</a></div><div class="ttdeci">double precision, dimension(:), allocatable amr_wavefilter</div><div class="ttdoc">refinement: lohner estimate wavefilter setting</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00418">mod_global_parameters.t:418</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a479b16476da7b1ec12a73e7815a61614"><div class="ttname"><a href="namespacemod__global__parameters.html#a479b16476da7b1ec12a73e7815a61614">mod_global_parameters::rpxmin</a></div><div class="ttdeci">integer, parameter rpxmin</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00148">mod_global_parameters.t:148</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a47fc5e2d167d5984eca70ead09e4c8e0"><div class="ttname"><a href="namespacemod__global__parameters.html#a47fc5e2d167d5984eca70ead09e4c8e0">mod_global_parameters::nxdiffusehllc</a></div><div class="ttdeci">integer nxdiffusehllc</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00615">mod_global_parameters.t:615</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a47fcfbf341c2a93f7d90896ad4032692"><div class="ttname"><a href="namespacemod__global__parameters.html#a47fcfbf341c2a93f7d90896ad4032692">mod_global_parameters::nlevelshi</a></div><div class="ttdeci">integer, parameter nlevelshi</div><div class="ttdoc">The maximum number of levels in the grid refinement.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00397">mod_global_parameters.t:397</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a499251de3e6662e6956a005cfb98ea5b"><div class="ttname"><a href="namespacemod__global__parameters.html#a499251de3e6662e6956a005cfb98ea5b">mod_global_parameters::location_slit</a></div><div class="ttdeci">double precision location_slit</div><div class="ttdoc">location of the slit</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00738">mod_global_parameters.t:738</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a4c292b82b129aa70d2d562789cd28bd5"><div class="ttname"><a href="namespacemod__global__parameters.html#a4c292b82b129aa70d2d562789cd28bd5">mod_global_parameters::save_physical_boundary</a></div><div class="ttdeci">logical save_physical_boundary</div><div class="ttdoc">True for save physical boundary cells in dat files.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00679">mod_global_parameters.t:679</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a4ebd0a5ae560288eeb5dfd3b2f251429"><div class="ttname"><a href="namespacemod__global__parameters.html#a4ebd0a5ae560288eeb5dfd3b2f251429">mod_global_parameters::stagger_grid</a></div><div class="ttdeci">logical stagger_grid</div><div class="ttdoc">True for using stagger grid.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00431">mod_global_parameters.t:431</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a4feabcd0ba0961f4bd06a662f89c50cb"><div class="ttname"><a href="namespacemod__global__parameters.html#a4feabcd0ba0961f4bd06a662f89c50cb">mod_global_parameters::time_convert_factor</a></div><div class="ttdeci">double precision time_convert_factor</div><div class="ttdoc">Conversion factor for time unit.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00307">mod_global_parameters.t:307</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a539b80e7ad5ccd313f1076e15a7cd137"><div class="ttname"><a href="namespacemod__global__parameters.html#a539b80e7ad5ccd313f1076e15a7cd137">mod_global_parameters::use_particles</a></div><div class="ttdeci">logical use_particles</div><div class="ttdoc">Use particles module or not.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00386">mod_global_parameters.t:386</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a551004039cf74031e6bf9e613eb24e64"><div class="ttname"><a href="namespacemod__global__parameters.html#a551004039cf74031e6bf9e613eb24e64">mod_global_parameters::par_files</a></div><div class="ttdeci">character(len=std_len), dimension(:), allocatable par_files</div><div class="ttdoc">Which par files are used as input.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00265">mod_global_parameters.t:265</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a5704f1c57aa09935d3491f65ad240861"><div class="ttname"><a href="namespacemod__global__parameters.html#a5704f1c57aa09935d3491f65ad240861">mod_global_parameters::icomm</a></div><div class="ttdeci">integer icomm</div><div class="ttdoc">The MPI communicator.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00025">mod_global_parameters.t:25</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a584ce48a94cacaab9e7da7b04a6a85d6"><div class="ttname"><a href="namespacemod__global__parameters.html#a584ce48a94cacaab9e7da7b04a6a85d6">mod_global_parameters::coarsenprimitive</a></div><div class="ttdeci">logical coarsenprimitive</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00422">mod_global_parameters.t:422</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a5a0c4ff10aba586a1a4b285e4b93e8d1"><div class="ttname"><a href="namespacemod__global__parameters.html#a5a0c4ff10aba586a1a4b285e4b93e8d1">mod_global_parameters::ng</a></div><div class="ttdeci">integer, dimension(:), allocatable ng</div><div class="ttdoc">number of grid blocks in domain per dimension, in array over levels</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00088">mod_global_parameters.t:88</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a5c1bf53d9221dda713b7731ca922f3d5"><div class="ttname"><a href="namespacemod__global__parameters.html#a5c1bf53d9221dda713b7731ca922f3d5">mod_global_parameters::reset_time</a></div><div class="ttdeci">logical reset_time</div><div class="ttdoc">If true, reset iteration count and global_time to original values, and start writing snapshots at ind...</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00497">mod_global_parameters.t:497</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a5c6dbe29415b67eac21ed328d7a77b34"><div class="ttname"><a href="namespacemod__global__parameters.html#a5c6dbe29415b67eac21ed328d7a77b34">mod_global_parameters::nsavehi</a></div><div class="ttdeci">integer, parameter nsavehi</div><div class="ttdoc">Maximum number of saves that can be defined by tsave or itsave.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00163">mod_global_parameters.t:163</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a5f59b38b0ad0ed44f0918452cee31bfb"><div class="ttname"><a href="namespacemod__global__parameters.html#a5f59b38b0ad0ed44f0918452cee31bfb">mod_global_parameters::emax_sxr</a></div><div class="ttdeci">integer emax_sxr</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00716">mod_global_parameters.t:716</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a602b662328098b5b9254339adcf3cb20"><div class="ttname"><a href="namespacemod__global__parameters.html#a602b662328098b5b9254339adcf3cb20">mod_global_parameters::whitelight_instrument</a></div><div class="ttdeci">character(len=std_len) whitelight_instrument</div><div class="ttdoc">white light observation instrument</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00720">mod_global_parameters.t:720</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a605b2c8e7a386f644c7f8817421b6d67"><div class="ttname"><a href="namespacemod__global__parameters.html#a605b2c8e7a386f644c7f8817421b6d67">mod_global_parameters::mype</a></div><div class="ttdeci">integer mype</div><div class="ttdoc">The rank of the current MPI task.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00022">mod_global_parameters.t:22</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a60f4f86ae97116d90e004a8125e21ede"><div class="ttname"><a href="namespacemod__global__parameters.html#a60f4f86ae97116d90e004a8125e21ede">mod_global_parameters::dtpar</a></div><div class="ttdeci">double precision dtpar</div><div class="ttdoc">If dtpar is positive, it sets the timestep dt, otherwise courantpar is used to limit the time step ba...</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00471">mod_global_parameters.t:471</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a613cd6410f0c433a64c20dcc752eb37a"><div class="ttname"><a href="namespacemod__global__parameters.html#a613cd6410f0c433a64c20dcc752eb37a">mod_global_parameters::typediv</a></div><div class="ttdeci">character(len=std_len) typediv</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00650">mod_global_parameters.t:650</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a61b20ad3b87b28e636a5f74d3145a850"><div class="ttname"><a href="namespacemod__global__parameters.html#a61b20ad3b87b28e636a5f74d3145a850">mod_global_parameters::block_nx</a></div><div class="ttdeci">integer block_nx</div><div class="ttdoc">number of cells for each dimension in grid block excluding ghostcells</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00096">mod_global_parameters.t:96</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a61e41833758134ab6a035332a3f50f33"><div class="ttname"><a href="namespacemod__global__parameters.html#a61e41833758134ab6a035332a3f50f33">mod_global_parameters::flathllc</a></div><div class="ttdeci">logical flathllc</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00619">mod_global_parameters.t:619</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a62bde5d85360265109ddae5ed9970686"><div class="ttname"><a href="namespacemod__global__parameters.html#a62bde5d85360265109ddae5ed9970686">mod_global_parameters::type_block_io</a></div><div class="ttdeci">integer type_block_io</div><div class="ttdoc">MPI type for IO: block excluding ghost cells.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00039">mod_global_parameters.t:39</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a63586860c44b7ca7aeee41a26a6b2c02"><div class="ttname"><a href="namespacemod__global__parameters.html#a63586860c44b7ca7aeee41a26a6b2c02">mod_global_parameters::tsavestart</a></div><div class="ttdeci">double precision, dimension(nfile) tsavestart</div><div class="ttdoc">Start of read out (not counting specified read outs)</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00202">mod_global_parameters.t:202</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a642b591486cb72f711ffcaffacd41d84"><div class="ttname"><a href="namespacemod__global__parameters.html#a642b591486cb72f711ffcaffacd41d84">mod_global_parameters::ditsave</a></div><div class="ttdeci">integer, dimension(nfile) ditsave</div><div class="ttdoc">Repeatedly save output of type N when ditsave(N) time steps have passed.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00195">mod_global_parameters.t:195</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a6491b365821029b96f98797234dd2839"><div class="ttname"><a href="namespacemod__global__parameters.html#a6491b365821029b96f98797234dd2839">mod_global_parameters::plevel_</a></div><div class="ttdeci">integer, parameter plevel_</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00139">mod_global_parameters.t:139</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a65d9e0a37fc83ab3cac268509da79e46"><div class="ttname"><a href="namespacemod__global__parameters.html#a65d9e0a37fc83ab3cac268509da79e46">mod_global_parameters::collapse</a></div><div class="ttdeci">logical, dimension(ndim) collapse</div><div class="ttdoc">If collapse(DIM) is true, generate output integrated over DIM.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00179">mod_global_parameters.t:179</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a66b6d102b0c1abd62b12a11b7fdb31b3"><div class="ttname"><a href="namespacemod__global__parameters.html#a66b6d102b0c1abd62b12a11b7fdb31b3">mod_global_parameters::ll</a></div><div class="ttdeci">integer ll</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00051">mod_global_parameters.t:51</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a68549065c490d02e1de338e8a60c3f12"><div class="ttname"><a href="namespacemod__global__parameters.html#a68549065c490d02e1de338e8a60c3f12">mod_global_parameters::d</a></div><div class="ttdeci">integer, dimension(:), allocatable, parameter d</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00088">mod_global_parameters.t:88</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a68bbb6233a821af90e2f693a636c0c8c"><div class="ttname"><a href="namespacemod__global__parameters.html#a68bbb6233a821af90e2f693a636c0c8c">mod_global_parameters::local_timestep</a></div><div class="ttdeci">logical local_timestep</div><div class="ttdoc">each cell has its own timestep or not</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00085">mod_global_parameters.t:85</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a696248795de3f887232834d6136b8501"><div class="ttname"><a href="namespacemod__global__parameters.html#a696248795de3f887232834d6136b8501">mod_global_parameters::dt</a></div><div class="ttdeci">double precision dt</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00455">mod_global_parameters.t:455</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a6b2953503f51194cc6d0476650d023b8"><div class="ttname"><a href="namespacemod__global__parameters.html#a6b2953503f51194cc6d0476650d023b8">mod_global_parameters::refine_criterion</a></div><div class="ttdeci">integer refine_criterion</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00420">mod_global_parameters.t:420</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a6b5097d61d55594c85e0f80cea175ca2"><div class="ttname"><a href="namespacemod__global__parameters.html#a6b5097d61d55594c85e0f80cea175ca2">mod_global_parameters::usr_filename</a></div><div class="ttdeci">character(len=std_len) usr_filename</div><div class="ttdoc">User parameter file.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00176">mod_global_parameters.t:176</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a6c2595e4399ab9a2db77faf60b937237"><div class="ttname"><a href="namespacemod__global__parameters.html#a6c2595e4399ab9a2db77faf60b937237">mod_global_parameters::ghost_copy</a></div><div class="ttdeci">logical ghost_copy</div><div class="ttdoc">whether copy values instead of interpolation in ghost cells of finer blocks</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00700">mod_global_parameters.t:700</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a6d25c8f0a568cc070ea9f329dd23f88f"><div class="ttname"><a href="namespacemod__global__parameters.html#a6d25c8f0a568cc070ea9f329dd23f88f">mod_global_parameters::length_convert_factor</a></div><div class="ttdeci">double precision length_convert_factor</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00304">mod_global_parameters.t:304</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a6d65136b05163940551f4704a2dc13b8"><div class="ttname"><a href="namespacemod__global__parameters.html#a6d65136b05163940551f4704a2dc13b8">mod_global_parameters::ndir</a></div><div class="ttdeci">integer ndir</div><div class="ttdoc">Number of spatial dimensions (components) for vector variables.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00065">mod_global_parameters.t:65</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a6e65528deaee18d93347042916c88030"><div class="ttname"><a href="namespacemod__global__parameters.html#a6e65528deaee18d93347042916c88030">mod_global_parameters::imex222_lambda</a></div><div class="ttdeci">double precision imex222_lambda</div><div class="ttdoc">IMEX-222(lambda) one-parameter family of schemes.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00629">mod_global_parameters.t:629</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a6e9ec60e3266b9f605e1358cf753978d"><div class="ttname"><a href="namespacemod__global__parameters.html#a6e9ec60e3266b9f605e1358cf753978d">mod_global_parameters::courantpar</a></div><div class="ttdeci">double precision courantpar</div><div class="ttdoc">The Courant (CFL) number used for the simulation.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00460">mod_global_parameters.t:460</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a6f4b0ca677f067d9ffa334a39c81198b"><div class="ttname"><a href="namespacemod__global__parameters.html#a6f4b0ca677f067d9ffa334a39c81198b">mod_global_parameters::wall_time_max</a></div><div class="ttdeci">double precision wall_time_max</div><div class="ttdoc">Ending wall time (in hours) for the simulation.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00487">mod_global_parameters.t:487</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a6f52fc825865569352db4ebc034361b4"><div class="ttname"><a href="namespacemod__global__parameters.html#a6f52fc825865569352db4ebc034361b4">mod_global_parameters::ixm</a></div><div class="ttdeci">integer ixm</div><div class="ttdoc">the mesh range of a physical block without ghost cells</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00051">mod_global_parameters.t:51</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a701c9a9b2d5f02bb7c7a8181f09df2ae"><div class="ttname"><a href="namespacemod__global__parameters.html#a701c9a9b2d5f02bb7c7a8181f09df2ae">mod_global_parameters::ierrmpi</a></div><div class="ttdeci">integer ierrmpi</div><div class="ttdoc">A global MPI error return code.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00028">mod_global_parameters.t:28</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a701d9f0321c70f8e13a05f6c15f2fb76"><div class="ttname"><a href="namespacemod__global__parameters.html#a701d9f0321c70f8e13a05f6c15f2fb76">mod_global_parameters::autoconvert</a></div><div class="ttdeci">logical autoconvert</div><div class="ttdoc">If true, already convert to output format during the run.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00287">mod_global_parameters.t:287</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a703976b153fd00ff87ab47abd82a1c8a"><div class="ttname"><a href="namespacemod__global__parameters.html#a703976b153fd00ff87ab47abd82a1c8a">mod_global_parameters::flux_method</a></div><div class="ttdeci">integer, dimension(:), allocatable flux_method</div><div class="ttdoc">Which flux scheme of spatial discretization to use (per grid level)</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00536">mod_global_parameters.t:536</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a71fb2d1149a0e60130d7ab8dd14fa448"><div class="ttname"><a href="namespacemod__global__parameters.html#a71fb2d1149a0e60130d7ab8dd14fa448">mod_global_parameters::collapse_type</a></div><div class="ttdeci">character(len=std_len) collapse_type</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00299">mod_global_parameters.t:299</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a7697c549bfe2fdc52590606d35f7645f"><div class="ttname"><a href="namespacemod__global__parameters.html#a7697c549bfe2fdc52590606d35f7645f">mod_global_parameters::slowsteps</a></div><div class="ttdeci">integer slowsteps</div><div class="ttdoc">If &gt; 1, then in the first slowsteps-1 time steps dt is reduced by a factor .</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00525">mod_global_parameters.t:525</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a770ca839caef4837f0ca899602b6d454"><div class="ttname"><a href="namespacemod__global__parameters.html#a770ca839caef4837f0ca899602b6d454">mod_global_parameters::ssprk_order</a></div><div class="ttdeci">integer ssprk_order</div><div class="ttdoc">SSPRK choice of methods (both threestep and fourstep, Shu-Osher 2N* implementation) also fivestep SSP...</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00632">mod_global_parameters.t:632</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a785298c4f0e2e1ce9707e8ff814af159"><div class="ttname"><a href="namespacemod__global__parameters.html#a785298c4f0e2e1ce9707e8ff814af159">mod_global_parameters::image_rotate</a></div><div class="ttdeci">double precision image_rotate</div><div class="ttdoc">rotation of image</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00726">mod_global_parameters.t:726</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a7e84e042d8f65bd51a4c3435ebd78e35"><div class="ttname"><a href="namespacemod__global__parameters.html#a7e84e042d8f65bd51a4c3435ebd78e35">mod_global_parameters::snapshotnext</a></div><div class="ttdeci">integer snapshotnext</div><div class="ttdoc">IO: snapshot and collapsed views output numbers/labels.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00220">mod_global_parameters.t:220</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a8242f42a9b14d7655e6eb74ee23e6195"><div class="ttname"><a href="namespacemod__global__parameters.html#a8242f42a9b14d7655e6eb74ee23e6195">mod_global_parameters::l</a></div><div class="ttdeci">double precision l</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00054">mod_global_parameters.t:54</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a84881fbdc47fb8c5db93cff24a57ba46"><div class="ttname"><a href="namespacemod__global__parameters.html#a84881fbdc47fb8c5db93cff24a57ba46">mod_global_parameters::dat_resolution</a></div><div class="ttdeci">logical dat_resolution</div><div class="ttdoc">resolution of the images</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00744">mod_global_parameters.t:744</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a8488ae7a5d34bdabfe0c2f4d3d033a25"><div class="ttname"><a href="namespacemod__global__parameters.html#a8488ae7a5d34bdabfe0c2f4d3d033a25">mod_global_parameters::r_occultor</a></div><div class="ttdeci">double precision r_occultor</div><div class="ttdoc">the white light emission below it (unit=Rsun) is not visible</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00722">mod_global_parameters.t:722</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a85452df53d9def115b87f8a5657a57b0"><div class="ttname"><a href="namespacemod__global__parameters.html#a85452df53d9def115b87f8a5657a57b0">mod_global_parameters::nstretchedblocks_baselevel</a></div><div class="ttdeci">integer, dimension(ndim) nstretchedblocks_baselevel</div><div class="ttdoc">(even) number of (symmetrically) stretched blocks at AMR level 1, per dimension</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00128">mod_global_parameters.t:128</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a879ff9a3d86e228553c9e44151a31574"><div class="ttname"><a href="namespacemod__global__parameters.html#a879ff9a3d86e228553c9e44151a31574">mod_global_parameters::npe</a></div><div class="ttdeci">integer npe</div><div class="ttdoc">The number of MPI tasks.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00019">mod_global_parameters.t:19</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a892699e88d1642157a42ce148707fdf8"><div class="ttname"><a href="namespacemod__global__parameters.html#a892699e88d1642157a42ce148707fdf8">mod_global_parameters::nwauxio</a></div><div class="ttdeci">integer nwauxio</div><div class="ttdoc">Number of auxiliary variables that are only included in output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00255">mod_global_parameters.t:255</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a8bfacb4dd09490b8c7ab27804ca8a4e4"><div class="ttname"><a href="namespacemod__global__parameters.html#a8bfacb4dd09490b8c7ab27804ca8a4e4">mod_global_parameters::qstretch_baselevel</a></div><div class="ttdeci">double precision, dimension(ndim) qstretch_baselevel</div><div class="ttdoc">stretch factor between cells at AMR level 1, per dimension</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00125">mod_global_parameters.t:125</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a8c5fbfe3d140df19a90085e75c13973f"><div class="ttname"><a href="namespacemod__global__parameters.html#a8c5fbfe3d140df19a90085e75c13973f">mod_global_parameters::writespshift</a></div><div class="ttdeci">double precision, dimension(ndim, 2) writespshift</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00261">mod_global_parameters.t:261</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a8ce58d607d9ee7388a778b7d86769c75"><div class="ttname"><a href="namespacemod__global__parameters.html#a8ce58d607d9ee7388a778b7d86769c75">mod_global_parameters::imex_switch</a></div><div class="ttdeci">integer imex_switch</div><div class="ttdoc">IMEX_232 choice and parameters.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00642">mod_global_parameters.t:642</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a9138f9532b13609e59e135a0a3592a5d"><div class="ttname"><a href="namespacemod__global__parameters.html#a9138f9532b13609e59e135a0a3592a5d">mod_global_parameters::time_between_print</a></div><div class="ttdeci">double precision time_between_print</div><div class="ttdoc">to monitor timeintegration loop at given wall-clock time intervals</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00214">mod_global_parameters.t:214</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a9214ecd6fb45fa103a8518c45be16072"><div class="ttname"><a href="namespacemod__global__parameters.html#a9214ecd6fb45fa103a8518c45be16072">mod_global_parameters::unitterm</a></div><div class="ttdeci">integer, parameter unitterm</div><div class="ttdoc">Unit for standard output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00241">mod_global_parameters.t:241</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a92be6d1fd210a17a74b04ef7b597b791"><div class="ttname"><a href="namespacemod__global__parameters.html#a92be6d1fd210a17a74b04ef7b597b791">mod_global_parameters::dtsave</a></div><div class="ttdeci">double precision, dimension(nfile) dtsave</div><div class="ttdoc">Repeatedly save output of type N when dtsave(N) simulation time has passed.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00187">mod_global_parameters.t:187</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a96ac799804cba9c9f5ceda58b1b115a4"><div class="ttname"><a href="namespacemod__global__parameters.html#a96ac799804cba9c9f5ceda58b1b115a4">mod_global_parameters::w_write</a></div><div class="ttdeci">logical, dimension(:), allocatable w_write</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00259">mod_global_parameters.t:259</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a97dcff27c39ab92f38c63288a904f89b"><div class="ttname"><a href="namespacemod__global__parameters.html#a97dcff27c39ab92f38c63288a904f89b">mod_global_parameters::prolongprimitive</a></div><div class="ttdeci">logical prolongprimitive</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00421">mod_global_parameters.t:421</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a990d040524d30b1155da2512352d8344"><div class="ttname"><a href="namespacemod__global__parameters.html#a990d040524d30b1155da2512352d8344">mod_global_parameters::iprob</a></div><div class="ttdeci">integer iprob</div><div class="ttdoc">problem switch allowing different setups in same usr_mod.t</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00445">mod_global_parameters.t:445</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a99b70d54ff2f08fb179495e2a07d1e44"><div class="ttname"><a href="namespacemod__global__parameters.html#a99b70d54ff2f08fb179495e2a07d1e44">mod_global_parameters::restart_from_file</a></div><div class="ttdeci">character(len=std_len) restart_from_file</div><div class="ttdoc">If not 'unavailable', resume from snapshot with this base file name.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00271">mod_global_parameters.t:271</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a9a0ac2f9464c2fc8e1c8a8cf4c613ac2"><div class="ttname"><a href="namespacemod__global__parameters.html#a9a0ac2f9464c2fc8e1c8a8cf4c613ac2">mod_global_parameters::size_block_io</a></div><div class="ttdeci">integer size_block_io</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00039">mod_global_parameters.t:39</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a9af4bac5cdacef49764bebff3e1dd01b"><div class="ttname"><a href="namespacemod__global__parameters.html#a9af4bac5cdacef49764bebff3e1dd01b">mod_global_parameters::periodb</a></div><div class="ttdeci">logical, dimension(ndim) periodb</div><div class="ttdoc">True for dimensions with periodic boundaries.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00670">mod_global_parameters.t:670</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a9dd666c3ecb8ef351f14f46cf32a3a62"><div class="ttname"><a href="namespacemod__global__parameters.html#a9dd666c3ecb8ef351f14f46cf32a3a62">mod_global_parameters::rnode</a></div><div class="ttdeci">double precision, dimension(:,:), allocatable rnode</div><div class="ttdoc">Corner coordinates.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00154">mod_global_parameters.t:154</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_a9e14f8777e3d1c99500aabba1f25384f"><div class="ttname"><a href="namespacemod__global__parameters.html#a9e14f8777e3d1c99500aabba1f25384f">mod_global_parameters::filelog_</a></div><div class="ttdeci">integer, parameter filelog_</div><div class="ttdoc">Constant indicating log output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00223">mod_global_parameters.t:223</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_aa3194833cc9e7e739ed1fa396655a636"><div class="ttname"><a href="namespacemod__global__parameters.html#aa3194833cc9e7e739ed1fa396655a636">mod_global_parameters::d_</a></div><div class="ttdeci">integer, parameter d_</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00140">mod_global_parameters.t:140</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_aa6335d944592dac407398f06198b68d1"><div class="ttname"><a href="namespacemod__global__parameters.html#aa6335d944592dac407398f06198b68d1">mod_global_parameters::final_dt_reduction</a></div><div class="ttdeci">logical final_dt_reduction</div><div class="ttdoc">If true, allow final dt reduction for matching time_max on output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00503">mod_global_parameters.t:503</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_aa81fe5c9595675cc4a2397258dca12c3"><div class="ttname"><a href="namespacemod__global__parameters.html#aa81fe5c9595675cc4a2397258dca12c3">mod_global_parameters::writelevel</a></div><div class="ttdeci">logical, dimension(:), allocatable writelevel</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00260">mod_global_parameters.t:260</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_aa8b0f3c32c987669794c2a72cb29161e"><div class="ttname"><a href="namespacemod__global__parameters.html#aa8b0f3c32c987669794c2a72cb29161e">mod_global_parameters::fileout_</a></div><div class="ttdeci">integer, parameter fileout_</div><div class="ttdoc">Constant indicating regular output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00226">mod_global_parameters.t:226</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_aa8df2f891dca11a4a18199294bb4e018"><div class="ttname"><a href="namespacemod__global__parameters.html#aa8df2f891dca11a4a18199294bb4e018">mod_global_parameters::los_theta</a></div><div class="ttdeci">double precision los_theta</div><div class="ttdoc">direction of the line of sight (LOS)</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00724">mod_global_parameters.t:724</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_aabacfec18ce0de899580266b28ca1d58"><div class="ttname"><a href="namespacemod__global__parameters.html#aabacfec18ce0de899580266b28ca1d58">mod_global_parameters::typetvd</a></div><div class="ttdeci">character(len=std_len) typetvd</div><div class="ttdoc">Which type of TVD method to use.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00605">mod_global_parameters.t:605</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_aac1731aeb6f288269458ed77b7317e88"><div class="ttname"><a href="namespacemod__global__parameters.html#aac1731aeb6f288269458ed77b7317e88">mod_global_parameters::nbufferx</a></div><div class="ttdeci">integer nbufferx</div><div class="ttdoc">Number of cells as buffer zone.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00436">mod_global_parameters.t:436</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_aadf4c69750b7efad63e2572d1c579f76"><div class="ttname"><a href="namespacemod__global__parameters.html#aadf4c69750b7efad63e2572d1c579f76">mod_global_parameters::entropycoef</a></div><div class="ttdeci">double precision, dimension(:), allocatable entropycoef</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00616">mod_global_parameters.t:616</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_aafb7ce2cea79dc8b58a753a761a48035"><div class="ttname"><a href="namespacemod__global__parameters.html#aafb7ce2cea79dc8b58a753a761a48035">mod_global_parameters::dx</a></div><div class="ttdeci">double precision, dimension(:,:), allocatable dx</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00157">mod_global_parameters.t:157</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ab49a62e2ea118f2424bb612ee35d5639"><div class="ttname"><a href="namespacemod__global__parameters.html#ab49a62e2ea118f2424bb612ee35d5639">mod_global_parameters::tfixgrid</a></div><div class="ttdeci">double precision tfixgrid</div><div class="ttdoc">Fix the AMR grid after this time.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00406">mod_global_parameters.t:406</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ab7c7effa3bb9a3ba7e79fd548fc7c8aa"><div class="ttname"><a href="namespacemod__global__parameters.html#ab7c7effa3bb9a3ba7e79fd548fc7c8aa">mod_global_parameters::nghostcells</a></div><div class="ttdeci">integer nghostcells</div><div class="ttdoc">Number of ghost cells surrounding a grid.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00111">mod_global_parameters.t:111</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ab7ea9146b4eb6733d50c489cd9ce3395"><div class="ttname"><a href="namespacemod__global__parameters.html#ab7ea9146b4eb6733d50c489cd9ce3395">mod_global_parameters::w_refine_weight</a></div><div class="ttdeci">double precision, dimension(:), allocatable w_refine_weight</div><div class="ttdoc">Weights of variables used to calculate error for mesh refinement.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00403">mod_global_parameters.t:403</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ab9a240741796fc1c8ddb6915cfad4035"><div class="ttname"><a href="namespacemod__global__parameters.html#ab9a240741796fc1c8ddb6915cfad4035">mod_global_parameters::typedimsplit</a></div><div class="ttdeci">character(len=std_len) typedimsplit</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00611">mod_global_parameters.t:611</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_aba532d5b27802e6e34fdd33da22c98e3"><div class="ttname"><a href="namespacemod__global__parameters.html#aba532d5b27802e6e34fdd33da22c98e3">mod_global_parameters::typeaverage</a></div><div class="ttdeci">character(len=std_len) typeaverage</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00610">mod_global_parameters.t:610</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_aba6bd3b8579dde6b7c68f65ab628a049"><div class="ttname"><a href="namespacemod__global__parameters.html#aba6bd3b8579dde6b7c68f65ab628a049">mod_global_parameters::undefined</a></div><div class="ttdeci">character(len= *), parameter undefined</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00016">mod_global_parameters.t:16</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_abb88b3a6316e2d70f8758af903c29d5e"><div class="ttname"><a href="namespacemod__global__parameters.html#abb88b3a6316e2d70f8758af903c29d5e">mod_global_parameters::tsave</a></div><div class="ttdeci">double precision, dimension(nsavehi, nfile) tsave</div><div class="ttdoc">Save output of type N on times tsave(:, N)</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00182">mod_global_parameters.t:182</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_abd0ca931a66632286f943b590ff2ed32"><div class="ttname"><a href="namespacemod__global__parameters.html#abd0ca931a66632286f943b590ff2ed32">mod_global_parameters::spectrum_window_max</a></div><div class="ttdeci">double precision spectrum_window_max</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00736">mod_global_parameters.t:736</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_abeaadf7ca515b0a99e6e1e326d88e4f7"><div class="ttname"><a href="namespacemod__global__parameters.html#abeaadf7ca515b0a99e6e1e326d88e4f7">mod_global_parameters::convert</a></div><div class="ttdeci">logical convert</div><div class="ttdoc">If true and restart_from_file is given, convert snapshots to other file formats.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00284">mod_global_parameters.t:284</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ac00b1fb8c041c78556efef827450962a"><div class="ttname"><a href="namespacemod__global__parameters.html#ac00b1fb8c041c78556efef827450962a">mod_global_parameters::fix_small_values</a></div><div class="ttdeci">logical fix_small_values</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00367">mod_global_parameters.t:367</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ac07dcf6afc2dfd3344a3cbabf08ad37c"><div class="ttname"><a href="namespacemod__global__parameters.html#ac07dcf6afc2dfd3344a3cbabf08ad37c">mod_global_parameters::wavelength</a></div><div class="ttdeci">integer wavelength</div><div class="ttdoc">wavelength for output</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00708">mod_global_parameters.t:708</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ac124187f1fdd4d4d1cab40d55e8abfdb"><div class="ttname"><a href="namespacemod__global__parameters.html#ac124187f1fdd4d4d1cab40d55e8abfdb">mod_global_parameters::collapselevel</a></div><div class="ttdeci">integer collapselevel</div><div class="ttdoc">The level at which to produce line-integrated / collapsed output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00205">mod_global_parameters.t:205</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ac29e1282b63a78a2c3a89d18f05675ff"><div class="ttname"><a href="namespacemod__global__parameters.html#ac29e1282b63a78a2c3a89d18f05675ff">mod_global_parameters::reset_grid</a></div><div class="ttdeci">logical reset_grid</div><div class="ttdoc">If true, rebuild the AMR grid upon restarting.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00429">mod_global_parameters.t:429</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ac7028ff82a4d1fd8d5ddf936665837c3"><div class="ttname"><a href="namespacemod__global__parameters.html#ac7028ff82a4d1fd8d5ddf936665837c3">mod_global_parameters::rpxmax</a></div><div class="ttdeci">integer, parameter rpxmax</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00150">mod_global_parameters.t:150</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_acc91cb6c162d5ddec9755eee2a2f593a"><div class="ttname"><a href="namespacemod__global__parameters.html#acc91cb6c162d5ddec9755eee2a2f593a">mod_global_parameters::refine_threshold</a></div><div class="ttdeci">double precision, dimension(:), allocatable refine_threshold</div><div class="ttdoc">Error tolerance for refinement decision.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00425">mod_global_parameters.t:425</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_acca226f88fb362bae425ca71f3742d09"><div class="ttname"><a href="namespacemod__global__parameters.html#acca226f88fb362bae425ca71f3742d09">mod_global_parameters::base_filename</a></div><div class="ttdeci">character(len=std_len) base_filename</div><div class="ttdoc">Base file name for simulation output, which will be followed by a number.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00268">mod_global_parameters.t:268</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ace9b925df34ceee46314d890452017d9"><div class="ttname"><a href="namespacemod__global__parameters.html#ace9b925df34ceee46314d890452017d9">mod_global_parameters::big_image</a></div><div class="ttdeci">logical big_image</div><div class="ttdoc">big image</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00730">mod_global_parameters.t:730</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_acee9d1c0fd5be4ecb6d0c7b1199c5e00"><div class="ttname"><a href="namespacemod__global__parameters.html#acee9d1c0fd5be4ecb6d0c7b1199c5e00">mod_global_parameters::los_phi</a></div><div class="ttdeci">double precision los_phi</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00724">mod_global_parameters.t:724</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_acfb666485b777dea6289a235519303a6"><div class="ttname"><a href="namespacemod__global__parameters.html#acfb666485b777dea6289a235519303a6">mod_global_parameters::instrument_resolution_factor</a></div><div class="ttdeci">double precision instrument_resolution_factor</div><div class="ttdoc">times for enhancing spatial resolution for EUV image/spectra</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00710">mod_global_parameters.t:710</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_acff6d1a4095e8d228d4c288f433ab99a"><div class="ttname"><a href="namespacemod__global__parameters.html#acff6d1a4095e8d228d4c288f433ab99a">mod_global_parameters::level_io_max</a></div><div class="ttdeci">integer level_io_max</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00262">mod_global_parameters.t:262</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ad147dadf78c6587c3b27c5c04039c808"><div class="ttname"><a href="namespacemod__global__parameters.html#ad147dadf78c6587c3b27c5c04039c808">mod_global_parameters::small_density</a></div><div class="ttdeci">double precision small_density</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00357">mod_global_parameters.t:357</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ad3d10b4e2f860ecce45f5cf3cf4743d3"><div class="ttname"><a href="namespacemod__global__parameters.html#ad3d10b4e2f860ecce45f5cf3cf4743d3">mod_global_parameters::spectrum_window_min</a></div><div class="ttdeci">double precision spectrum_window_min</div><div class="ttdoc">spectral window</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00736">mod_global_parameters.t:736</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ad3e1cd1b56e8932c8186716c7c13e3e3"><div class="ttname"><a href="namespacemod__global__parameters.html#ad3e1cd1b56e8932c8186716c7c13e3e3">mod_global_parameters::dtmin</a></div><div class="ttdeci">double precision dtmin</div><div class="ttdoc">Stop the simulation when the time step becomes smaller than this value.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00490">mod_global_parameters.t:490</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ad3ffd4e35e76a0b86495789e5458fdd8"><div class="ttname"><a href="namespacemod__global__parameters.html#ad3ffd4e35e76a0b86495789e5458fdd8">mod_global_parameters::refine_max_level</a></div><div class="ttdeci">integer refine_max_level</div><div class="ttdoc">Maximal number of AMR levels.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00400">mod_global_parameters.t:400</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ad50ed0b91e7e1038262f950fc6eed215"><div class="ttname"><a href="namespacemod__global__parameters.html#ad50ed0b91e7e1038262f950fc6eed215">mod_global_parameters::flatcd</a></div><div class="ttdeci">logical flatcd</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00619">mod_global_parameters.t:619</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ad6931ffa651097a2409dd069dd7bbe74"><div class="ttname"><a href="namespacemod__global__parameters.html#ad6931ffa651097a2409dd069dd7bbe74">mod_global_parameters::fileslice_</a></div><div class="ttdeci">integer, parameter fileslice_</div><div class="ttdoc">Constant indicating slice output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00229">mod_global_parameters.t:229</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ad7554834c993430ee77d00bf0ea95c29"><div class="ttname"><a href="namespacemod__global__parameters.html#ad7554834c993430ee77d00bf0ea95c29">mod_global_parameters::derefine_ratio</a></div><div class="ttdeci">double precision, dimension(:), allocatable derefine_ratio</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00426">mod_global_parameters.t:426</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ad8e2f2407305f395e212d838cbd366a0"><div class="ttname"><a href="namespacemod__global__parameters.html#ad8e2f2407305f395e212d838cbd366a0">mod_global_parameters::nfile</a></div><div class="ttdeci">integer, parameter nfile</div><div class="ttdoc">Number of output methods.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00166">mod_global_parameters.t:166</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ad92f0d9f4cbc71571fb26c74cd2be25b"><div class="ttname"><a href="namespacemod__global__parameters.html#ad92f0d9f4cbc71571fb26c74cd2be25b">mod_global_parameters::max_blocks</a></div><div class="ttdeci">integer max_blocks</div><div class="ttdoc">The maximum number of grid blocks in a processor.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00394">mod_global_parameters.t:394</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_adbbcd5c8b4225ffc9bcd128e1f66fd47"><div class="ttname"><a href="namespacemod__global__parameters.html#adbbcd5c8b4225ffc9bcd128e1f66fd47">mod_global_parameters::fileanalysis_</a></div><div class="ttdeci">integer, parameter fileanalysis_</div><div class="ttdoc">Constant indicating analysis output (see Writing a custom analysis subroutine)</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00235">mod_global_parameters.t:235</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_add7419e89b39d61726fe25c033cdd88e"><div class="ttname"><a href="namespacemod__global__parameters.html#add7419e89b39d61726fe25c033cdd88e">mod_global_parameters::rk3_switch</a></div><div class="ttdeci">integer rk3_switch</div><div class="ttdoc">RK3 Butcher table.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00637">mod_global_parameters.t:637</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ade5d1c51af566e1f4fead3564b6739a9"><div class="ttname"><a href="namespacemod__global__parameters.html#ade5d1c51af566e1f4fead3564b6739a9">mod_global_parameters::typefilelog</a></div><div class="ttdeci">character(len=std_len) typefilelog</div><div class="ttdoc">Which type of log to write: 'normal', 'special', 'regression_test'.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00274">mod_global_parameters.t:274</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_adea6be0a38ab7843e78126360184857a"><div class="ttname"><a href="namespacemod__global__parameters.html#adea6be0a38ab7843e78126360184857a">mod_global_parameters::direction_slit</a></div><div class="ttdeci">integer direction_slit</div><div class="ttdoc">direction of the slit (for dat resolution only)</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00740">mod_global_parameters.t:740</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ae5c84337d8ace067e3744f286305044c"><div class="ttname"><a href="namespacemod__global__parameters.html#ae5c84337d8ace067e3744f286305044c">mod_global_parameters::collapsenext</a></div><div class="ttdeci">integer collapsenext</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00220">mod_global_parameters.t:220</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ae6f75a5d8ed19c05f9d3acd319f2cd09"><div class="ttname"><a href="namespacemod__global__parameters.html#ae6f75a5d8ed19c05f9d3acd319f2cd09">mod_global_parameters::x_origin</a></div><div class="ttdeci">double precision, dimension(1:3) x_origin</div><div class="ttdoc">where the is the origin (X=0,Y=0) of image</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00728">mod_global_parameters.t:728</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ae7afe8b1acfca6926173e1a276056e2c"><div class="ttname"><a href="namespacemod__global__parameters.html#ae7afe8b1acfca6926173e1a276056e2c">mod_global_parameters::xmemory</a></div><div class="ttdeci">double precision xmemory</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00310">mod_global_parameters.t:310</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_ae9df63ed323b77d4c3477e5fa33cc122"><div class="ttname"><a href="namespacemod__global__parameters.html#ae9df63ed323b77d4c3477e5fa33cc122">mod_global_parameters::final_dt_exit</a></div><div class="ttdeci">logical final_dt_exit</div><div class="ttdoc">Force timeloop exit when final dt &lt; dtmin.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00493">mod_global_parameters.t:493</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_aea4a51c9905b3be09f63e71e14412a22"><div class="ttname"><a href="namespacemod__global__parameters.html#aea4a51c9905b3be09f63e71e14412a22">mod_global_parameters::emin_sxr</a></div><div class="ttdeci">integer emin_sxr</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00716">mod_global_parameters.t:716</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_aeb30573e6532f604a257c2705db802cf"><div class="ttname"><a href="namespacemod__global__parameters.html#aeb30573e6532f604a257c2705db802cf">mod_global_parameters::isaveit</a></div><div class="ttdeci">integer, dimension(nfile) isaveit</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00199">mod_global_parameters.t:199</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_aed90569afef4769570ed43ec84c80975"><div class="ttname"><a href="namespacemod__global__parameters.html#aed90569afef4769570ed43ec84c80975">mod_global_parameters::node</a></div><div class="ttdeci">integer, dimension(:,:), allocatable node</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00142">mod_global_parameters.t:142</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_af6c799c5a82858e33cb6c30c691f952d"><div class="ttname"><a href="namespacemod__global__parameters.html#af6c799c5a82858e33cb6c30c691f952d">mod_global_parameters::isavet</a></div><div class="ttdeci">integer, dimension(nfile) isavet</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00197">mod_global_parameters.t:197</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_afab102462aa140015d4722d99e2a5de4"><div class="ttname"><a href="namespacemod__global__parameters.html#afab102462aa140015d4722d99e2a5de4">mod_global_parameters::check_small_values</a></div><div class="ttdeci">logical check_small_values</div><div class="ttdoc">check and optionally fix unphysical small values (density, gas pressure)</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00366">mod_global_parameters.t:366</a></div></div>
<div class="ttc" id="anamespacemod__global__parameters_html_afffa1fd3e8b551b3f2ba9defbcc88f50"><div class="ttname"><a href="namespacemod__global__parameters.html#afffa1fd3e8b551b3f2ba9defbcc88f50">mod_global_parameters::log_fh</a></div><div class="ttdeci">integer log_fh</div><div class="ttdoc">MPI file handle for logfile.</div><div class="ttdef"><b>Definition:</b> <a href="mod__global__parameters_8t_source.html#l00031">mod_global_parameters.t:31</a></div></div>
<div class="ttc" id="anamespacemod__input__output__helper_html"><div class="ttname"><a href="namespacemod__input__output__helper.html">mod_input_output_helper</a></div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output__helper_8t_source.html#l00001">mod_input_output_helper.t:1</a></div></div>
<div class="ttc" id="anamespacemod__input__output__helper_html_a208f91df2b8f3fdbcbbd029668802c26"><div class="ttname"><a href="namespacemod__input__output__helper.html#a208f91df2b8f3fdbcbbd029668802c26">mod_input_output_helper::create_output_file</a></div><div class="ttdeci">subroutine, public create_output_file(fh, ix, extension, suffix)</div><div class="ttdoc">Standard method for creating a new output file.</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output__helper_8t_source.html#l00087">mod_input_output_helper.t:88</a></div></div>
<div class="ttc" id="anamespacemod__input__output__helper_html_a54d24b33757cb6dc549aeb19a2563964"><div class="ttname"><a href="namespacemod__input__output__helper.html#a54d24b33757cb6dc549aeb19a2563964">mod_input_output_helper::count_ix</a></div><div class="ttdeci">pure integer function, public count_ix(ixOL)</div><div class="ttdoc">Compute number of elements in index range.</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output__helper_8t_source.html#l00046">mod_input_output_helper.t:47</a></div></div>
<div class="ttc" id="anamespacemod__input__output__helper_html_a9b3e3365ae87d58b382931ee36cb6d7e"><div class="ttname"><a href="namespacemod__input__output__helper.html#a9b3e3365ae87d58b382931ee36cb6d7e">mod_input_output_helper::snapshot_write_header1</a></div><div class="ttdeci">subroutine, public snapshot_write_header1(fh, offset_tree, offset_block, dataset_names, nw_vars)</div><div class="ttdoc">Write header for a snapshot, generalize cons_wnames and nw.</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output__helper_8t_source.html#l00127">mod_input_output_helper.t:128</a></div></div>
<div class="ttc" id="anamespacemod__input__output__helper_html_ab75e38c0b0f267995e208c94854d9973"><div class="ttname"><a href="namespacemod__input__output__helper.html#ab75e38c0b0f267995e208c94854d9973">mod_input_output_helper::get_names_from_string</a></div><div class="ttdeci">character(len=name_len) function, dimension(1:nwc), public get_names_from_string(aux_variable_names, nwc)</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output__helper_8t_source.html#l00018">mod_input_output_helper.t:19</a></div></div>
<div class="ttc" id="anamespacemod__input__output__helper_html_ac03c76ebf22aa6a66b2b1677e00a82d9"><div class="ttname"><a href="namespacemod__input__output__helper.html#ac03c76ebf22aa6a66b2b1677e00a82d9">mod_input_output_helper::block_shape_io</a></div><div class="ttdeci">subroutine, public block_shape_io(igrid, n_ghost, ixOL, n_values)</div><div class="ttdoc">Determine the shape of a block for output (whether to include ghost cells, and on which sides)</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output__helper_8t_source.html#l00054">mod_input_output_helper.t:55</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html"><div class="ttname"><a href="namespacemod__input__output.html">mod_input_output</a></div><div class="ttdoc">Module for reading input and writing output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l00002">mod_input_output.t:2</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_a061b50e8aaaaf828c94809adf831ccbe"><div class="ttname"><a href="namespacemod__input__output.html#a061b50e8aaaaf828c94809adf831ccbe">mod_input_output::saveamrfile</a></div><div class="ttdeci">subroutine saveamrfile(ifile)</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l01719">mod_input_output.t:1720</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_a261f5086d85a96e13547d0e1c60928af"><div class="ttname"><a href="namespacemod__input__output.html#a261f5086d85a96e13547d0e1c60928af">mod_input_output::snapshot_exists</a></div><div class="ttdeci">logical function snapshot_exists(ix)</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l01775">mod_input_output.t:1776</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_a2b408b40f813e4fe523621ab4a497d76"><div class="ttname"><a href="namespacemod__input__output.html#a2b408b40f813e4fe523621ab4a497d76">mod_input_output::get_snapshot_index</a></div><div class="ttdeci">integer function get_snapshot_index(filename)</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l01784">mod_input_output.t:1785</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_a3d02333ce1529f982c89bf948cc871e7"><div class="ttname"><a href="namespacemod__input__output.html#a3d02333ce1529f982c89bf948cc871e7">mod_input_output::read_par_files</a></div><div class="ttdeci">subroutine read_par_files()</div><div class="ttdoc">Read in the user-supplied parameter-file.</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l00175">mod_input_output.t:176</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_a5a4c8ad20085895e6afea0b6da413313"><div class="ttname"><a href="namespacemod__input__output.html#a5a4c8ad20085895e6afea0b6da413313">mod_input_output::fmt_r</a></div><div class="ttdeci">character(len= *), parameter fmt_r</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l00026">mod_input_output.t:26</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_a846c54d7767425c6f966c4db1ad1c235"><div class="ttname"><a href="namespacemod__input__output.html#a846c54d7767425c6f966c4db1ad1c235">mod_input_output::get_volume_average_func</a></div><div class="ttdeci">subroutine get_volume_average_func(func, f_avg, volume)</div><div class="ttdoc">Compute the volume average of func(w) over the leaves of the grid.</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l02745">mod_input_output.t:2746</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_a84c632bdd9b080c72ef3b930138ee80a"><div class="ttname"><a href="namespacemod__input__output.html#a84c632bdd9b080c72ef3b930138ee80a">mod_input_output::get_global_minima</a></div><div class="ttdeci">subroutine get_global_minima(wmin)</div><div class="ttdoc">Compute global minima of iw variables over the leaves of the grid.</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l02815">mod_input_output.t:2816</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_a86886a7d99e5a874352cfb6385dbd1f0"><div class="ttname"><a href="namespacemod__input__output.html#a86886a7d99e5a874352cfb6385dbd1f0">mod_input_output::get_global_maxima</a></div><div class="ttdeci">subroutine get_global_maxima(wmax)</div><div class="ttdoc">Compute global maxima of iw variables over the leaves of the grid.</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l02788">mod_input_output.t:2789</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_a97e4df1969002df5c3fcc551db7d354e"><div class="ttname"><a href="namespacemod__input__output.html#a97e4df1969002df5c3fcc551db7d354e">mod_input_output::printlog_regression_test</a></div><div class="ttdeci">subroutine printlog_regression_test()</div><div class="ttdoc">Print a log that can be used to check whether the code still produces the same output (regression tes...</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l02640">mod_input_output.t:2641</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_a98a1cccd22f5c9aebc79667b1b469161"><div class="ttname"><a href="namespacemod__input__output.html#a98a1cccd22f5c9aebc79667b1b469161">mod_input_output::read_arguments</a></div><div class="ttdeci">subroutine read_arguments()</div><div class="ttdoc">Read the command line arguments passed to amrvac.</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l00036">mod_input_output.t:37</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_a9cf9ab211dc4836b216f1fe919d969ed"><div class="ttname"><a href="namespacemod__input__output.html#a9cf9ab211dc4836b216f1fe919d969ed">mod_input_output::get_volume_average</a></div><div class="ttdeci">subroutine get_volume_average(power, mode, volume)</div><div class="ttdoc">Compute mean(w**power) over the leaves of the grid. The first mode (power=1) corresponds to the mean,...</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l02681">mod_input_output.t:2682</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_aa2d00e56c4444b0b4806a9c13ce2eff7"><div class="ttname"><a href="namespacemod__input__output.html#aa2d00e56c4444b0b4806a9c13ce2eff7">mod_input_output::read_snapshot</a></div><div class="ttdeci">subroutine read_snapshot</div><div class="ttdoc">Routine to read in snapshots (.dat files). When it cannot recognize the file version,...</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l02162">mod_input_output.t:2163</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_aa90f67fcd1dcf23e3d7f0f13e3dcc87e"><div class="ttname"><a href="namespacemod__input__output.html#aa90f67fcd1dcf23e3d7f0f13e3dcc87e">mod_input_output::nw_found</a></div><div class="ttdeci">integer nw_found</div><div class="ttdoc">number of w found in dat files</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l00013">mod_input_output.t:13</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_ab0092e81ef07b5ca84ceddacc7c4d9f9"><div class="ttname"><a href="namespacemod__input__output.html#ab0092e81ef07b5ca84ceddacc7c4d9f9">mod_input_output::fmt_r2</a></div><div class="ttdeci">character(len= *), parameter fmt_r2</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l00027">mod_input_output.t:27</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_ab2d0a28e065926627226ed89b96ada9d"><div class="ttname"><a href="namespacemod__input__output.html#ab2d0a28e065926627226ed89b96ada9d">mod_input_output::get_fields_string</a></div><div class="ttdeci">subroutine get_fields_string(line, delims, n_max, fields, n_found, fully_read)</div><div class="ttdoc">Routine to find entries in a string.</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l01671">mod_input_output.t:1672</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_ab8da1bad0d6ad49b56081e6fe6bbcc85"><div class="ttname"><a href="namespacemod__input__output.html#ab8da1bad0d6ad49b56081e6fe6bbcc85">mod_input_output::get_volume_coverage</a></div><div class="ttdeci">subroutine get_volume_coverage(vol_cov)</div><div class="ttdoc">Compute how much of the domain is covered by each grid level. This routine does not take a non-Cartes...</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l02719">mod_input_output.t:2720</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_abd164abbe2712c03076283f266ae3d52"><div class="ttname"><a href="namespacemod__input__output.html#abd164abbe2712c03076283f266ae3d52">mod_input_output::fmt_i</a></div><div class="ttdeci">character(len= *), parameter fmt_i</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l00028">mod_input_output.t:28</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_ac699b426ea2d42b06de1c1798b98f96d"><div class="ttname"><a href="namespacemod__input__output.html#ac699b426ea2d42b06de1c1798b98f96d">mod_input_output::printlog_default</a></div><div class="ttdeci">subroutine printlog_default</div><div class="ttdoc">Write volume-averaged values and other information to the log file.</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l02509">mod_input_output.t:2510</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_acd293c80fe4dffe68b3bd5af075cc137"><div class="ttname"><a href="namespacemod__input__output.html#acd293c80fe4dffe68b3bd5af075cc137">mod_input_output::snapshot_write_header</a></div><div class="ttdeci">subroutine, public snapshot_write_header(fh, offset_tree, offset_block)</div><div class="ttdoc">Write header for a snapshot.</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l01799">mod_input_output.t:1800</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_ae1d4a41dcf32cae3752c48ef73f42364"><div class="ttname"><a href="namespacemod__input__output.html#ae1d4a41dcf32cae3752c48ef73f42364">mod_input_output::write_snapshot</a></div><div class="ttdeci">subroutine write_snapshot</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l01988">mod_input_output.t:1989</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_ae860a54ebdb7a0bee2fed1821d67cc99"><div class="ttname"><a href="namespacemod__input__output.html#ae860a54ebdb7a0bee2fed1821d67cc99">mod_input_output::snapshot_read_header</a></div><div class="ttdeci">subroutine snapshot_read_header(fh, offset_tree, offset_block)</div><div class="ttdoc">Read header for a snapshot.</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l01815">mod_input_output.t:1816</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_af6450e39c0d1c69b17bbbb5db487231a"><div class="ttname"><a href="namespacemod__input__output.html#af6450e39c0d1c69b17bbbb5db487231a">mod_input_output::compatible_versions</a></div><div class="ttdeci">integer, dimension(3), parameter compatible_versions</div><div class="ttdoc">List of compatible versions.</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l00010">mod_input_output.t:10</a></div></div>
<div class="ttc" id="anamespacemod__input__output_html_afa9ed59afcf773a8f071c30b69d1bceb"><div class="ttname"><a href="namespacemod__input__output.html#afa9ed59afcf773a8f071c30b69d1bceb">mod_input_output::read_snapshot_old</a></div><div class="ttdeci">subroutine read_snapshot_old()</div><div class="ttdef"><b>Definition:</b> <a href="mod__input__output_8t_source.html#l02368">mod_input_output.t:2369</a></div></div>
<div class="ttc" id="anamespacemod__limiter_html"><div class="ttname"><a href="namespacemod__limiter.html">mod_limiter</a></div><div class="ttdoc">Module with slope/flux limiters.</div><div class="ttdef"><b>Definition:</b> <a href="mod__limiter_8t_source.html#l00002">mod_limiter.t:2</a></div></div>
<div class="ttc" id="anamespacemod__limiter_html_a96347554389a5a4efc7af7a496e95318"><div class="ttname"><a href="namespacemod__limiter.html#a96347554389a5a4efc7af7a496e95318">mod_limiter::cada3_radius</a></div><div class="ttdeci">double precision cada3_radius</div><div class="ttdoc">radius of the asymptotic region [0.001, 10], larger means more accurate in smooth region but more ove...</div><div class="ttdef"><b>Definition:</b> <a href="mod__limiter_8t_source.html#l00013">mod_limiter.t:13</a></div></div>
<div class="ttc" id="anamespacemod__limiter_html_ae43ef009bd299ca5ea83b290e4411caf"><div class="ttname"><a href="namespacemod__limiter.html#ae43ef009bd299ca5ea83b290e4411caf">mod_limiter::schmid_rad</a></div><div class="ttdeci">double precision schmid_rad</div><div class="ttdef"><b>Definition:</b> <a href="mod__limiter_8t_source.html#l00014">mod_limiter.t:14</a></div></div>
<div class="ttc" id="anamespacemod__particles_html"><div class="ttname"><a href="namespacemod__particles.html">mod_particles</a></div><div class="ttdoc">Module containing all the particle routines.</div><div class="ttdef"><b>Definition:</b> <a href="mod__particles_8t_source.html#l00002">mod_particles.t:2</a></div></div>
<div class="ttc" id="anamespacemod__physics_html"><div class="ttname"><a href="namespacemod__physics.html">mod_physics</a></div><div class="ttdoc">This module defines the procedures of a physics module. It contains function pointers for the various...</div><div class="ttdef"><b>Definition:</b> <a href="mod__physics_8t_source.html#l00004">mod_physics.t:4</a></div></div>
<div class="ttc" id="anamespacemod__physics_html_a95ed0d73188b963f6d662c2e6626fb1c"><div class="ttname"><a href="namespacemod__physics.html#a95ed0d73188b963f6d662c2e6626fb1c">mod_physics::phys_wider_stencil</a></div><div class="ttdeci">integer phys_wider_stencil</div><div class="ttdoc">To use wider stencils in flux calculations. A value of 1 will extend it by one cell in both direction...</div><div class="ttdef"><b>Definition:</b> <a href="mod__physics_8t_source.html#l00020">mod_physics.t:20</a></div></div>
<div class="ttc" id="anamespacemod__physics_html_a9c0b8a2dc10a59ca87e89eaa056929ad"><div class="ttname"><a href="namespacemod__physics.html#a9c0b8a2dc10a59ca87e89eaa056929ad">mod_physics::physics_type</a></div><div class="ttdeci">character(len=name_len) physics_type</div><div class="ttdoc">String describing the physics type of the simulation.</div><div class="ttdef"><b>Definition:</b> <a href="mod__physics_8t_source.html#l00016">mod_physics.t:16</a></div></div>
<div class="ttc" id="anamespacemod__physics_html_af51a72a2fd88d69c5745864770c06f93"><div class="ttname"><a href="namespacemod__physics.html#af51a72a2fd88d69c5745864770c06f93">mod_physics::phys_energy</a></div><div class="ttdeci">logical phys_energy</div><div class="ttdoc">Solve energy equation or not.</div><div class="ttdef"><b>Definition:</b> <a href="mod__physics_8t_source.html#l00027">mod_physics.t:27</a></div></div>
<div class="ttc" id="anamespacemod__slice_html"><div class="ttname"><a href="namespacemod__slice.html">mod_slice</a></div><div class="ttdoc">Writes D-1 slice, can do so in various formats, depending on slice_type.</div><div class="ttdef"><b>Definition:</b> <a href="mod__slice_8t_source.html#l00002">mod_slice.t:2</a></div></div>
<div class="ttc" id="anamespacemod__slice_html_a3cb1cee59aefde34ff7330a6b1370be3"><div class="ttname"><a href="namespacemod__slice.html#a3cb1cee59aefde34ff7330a6b1370be3">mod_slice::slicenext</a></div><div class="ttdeci">integer slicenext</div><div class="ttdoc">the file number of slices</div><div class="ttdef"><b>Definition:</b> <a href="mod__slice_8t_source.html#l00014">mod_slice.t:14</a></div></div>
<div class="ttc" id="anamespacemod__slice_html_a6a45feb00cf001fcff14f72e126a89c4"><div class="ttname"><a href="namespacemod__slice.html#a6a45feb00cf001fcff14f72e126a89c4">mod_slice::write_slice</a></div><div class="ttdeci">subroutine write_slice</div><div class="ttdef"><b>Definition:</b> <a href="mod__slice_8t_source.html#l00030">mod_slice.t:31</a></div></div>
<div class="ttc" id="anamespacemod__slice_html_aa01fdbfdbedbb831547f4797f2518fbe"><div class="ttname"><a href="namespacemod__slice.html#aa01fdbfdbedbb831547f4797f2518fbe">mod_slice::slice_type</a></div><div class="ttdeci">character(len=std_len) slice_type</div><div class="ttdoc">choose data type of slice: vtu, vtuCC, dat, or csv</div><div class="ttdef"><b>Definition:</b> <a href="mod__slice_8t_source.html#l00023">mod_slice.t:23</a></div></div>
<div class="ttc" id="anamespacemod__slice_html_ab03e9f445d1009207701692d48e2f4f9"><div class="ttname"><a href="namespacemod__slice.html#ab03e9f445d1009207701692d48e2f4f9">mod_slice::slicedir</a></div><div class="ttdeci">integer, dimension(nslicemax) slicedir</div><div class="ttdoc">The slice direction for each slice.</div><div class="ttdef"><b>Definition:</b> <a href="mod__slice_8t_source.html#l00020">mod_slice.t:20</a></div></div>
<div class="ttc" id="anamespacemod__slice_html_ada481ed24e7de5c84878a06e5c1920c7"><div class="ttname"><a href="namespacemod__slice.html#ada481ed24e7de5c84878a06e5c1920c7">mod_slice::nslices</a></div><div class="ttdeci">integer nslices</div><div class="ttdoc">Number of slices to output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__slice_8t_source.html#l00017">mod_slice.t:17</a></div></div>
<div class="ttc" id="anamespacemod__slice_html_ae261b249da78bf9f9c0fde95e943551a"><div class="ttname"><a href="namespacemod__slice.html#ae261b249da78bf9f9c0fde95e943551a">mod_slice::slicecoord</a></div><div class="ttdeci">double precision, dimension(nslicemax) slicecoord</div><div class="ttdoc">Slice coordinates, see Slice output.</div><div class="ttdef"><b>Definition:</b> <a href="mod__slice_8t_source.html#l00011">mod_slice.t:11</a></div></div>
<div class="ttc" id="anamespacemod__small__values_html"><div class="ttname"><a href="namespacemod__small__values.html">mod_small_values</a></div><div class="ttdoc">Module for handling problematic values in simulations, such as negative pressures.</div><div class="ttdef"><b>Definition:</b> <a href="mod__small__values_8t_source.html#l00003">mod_small_values.t:3</a></div></div>
<div class="ttc" id="anamespacemod__small__values_html_a16ae31b4ca0d18f843c603e5f4c758d8"><div class="ttname"><a href="namespacemod__small__values.html#a16ae31b4ca0d18f843c603e5f4c758d8">mod_small_values::small_values_daverage</a></div><div class="ttdeci">integer, public small_values_daverage</div><div class="ttdoc">Average over this many cells in each direction.</div><div class="ttdef"><b>Definition:</b> <a href="mod__small__values_8t_source.html#l00012">mod_small_values.t:12</a></div></div>
<div class="ttc" id="anamespacemod__small__values_html_a31018c4c2a11eed22cac84dadb4aa912"><div class="ttname"><a href="namespacemod__small__values.html#a31018c4c2a11eed22cac84dadb4aa912">mod_small_values::trace_small_values</a></div><div class="ttdeci">logical, public trace_small_values</div><div class="ttdoc">trace small values in the source file using traceback flag of compiler</div><div class="ttdef"><b>Definition:</b> <a href="mod__small__values_8t_source.html#l00015">mod_small_values.t:15</a></div></div>
<div class="ttc" id="anamespacemod__small__values_html_abe16023a5fd2637dd995cf180d9791fa"><div class="ttname"><a href="namespacemod__small__values.html#abe16023a5fd2637dd995cf180d9791fa">mod_small_values::small_values_fix_iw</a></div><div class="ttdeci">logical, dimension(:), allocatable, public small_values_fix_iw</div><div class="ttdoc">Whether to apply small value fixes to certain variables.</div><div class="ttdef"><b>Definition:</b> <a href="mod__small__values_8t_source.html#l00018">mod_small_values.t:18</a></div></div>
<div class="ttc" id="anamespacemod__small__values_html_ae9f015805b337cda4f563826c1e8b7cd"><div class="ttname"><a href="namespacemod__small__values.html#ae9f015805b337cda4f563826c1e8b7cd">mod_small_values::small_values_method</a></div><div class="ttdeci">character(len=20), public small_values_method</div><div class="ttdoc">How to handle small values.</div><div class="ttdef"><b>Definition:</b> <a href="mod__small__values_8t_source.html#l00009">mod_small_values.t:9</a></div></div>
<div class="ttc" id="anamespacemod__source_html"><div class="ttname"><a href="namespacemod__source.html">mod_source</a></div><div class="ttdoc">Module for handling split source terms (split from the fluxes)</div><div class="ttdef"><b>Definition:</b> <a href="mod__source_8t_source.html#l00002">mod_source.t:2</a></div></div>
<div class="ttc" id="anamespacemod__timing_html"><div class="ttname"><a href="namespacemod__timing.html">mod_timing</a></div><div class="ttdef"><b>Definition:</b> <a href="mod__timing_8t_source.html#l00001">mod_timing.t:1</a></div></div>
<div class="ttc" id="anamespacemod__timing_html_a235af821f4ab48e15d285460766ca0c6"><div class="ttname"><a href="namespacemod__timing.html#a235af821f4ab48e15d285460766ca0c6">mod_timing::ittimelast</a></div><div class="ttdeci">integer ittimelast</div><div class="ttdef"><b>Definition:</b> <a href="mod__timing_8t_source.html#l00013">mod_timing.t:13</a></div></div>
<div class="ttc" id="anamespacemod__timing_html_a7eaa0c0e6abb95dd60b30c345156d180"><div class="ttname"><a href="namespacemod__timing.html#a7eaa0c0e6abb95dd60b30c345156d180">mod_timing::timelast</a></div><div class="ttdeci">double precision timelast</div><div class="ttdef"><b>Definition:</b> <a href="mod__timing_8t_source.html#l00014">mod_timing.t:14</a></div></div>
<div class="ttc" id="anamespacemod__usr__methods_html"><div class="ttname"><a href="namespacemod__usr__methods.html">mod_usr_methods</a></div><div class="ttdoc">Module with all the methods that users can customize in AMRVAC.</div><div class="ttdef"><b>Definition:</b> <a href="mod__usr__methods_8t_source.html#l00004">mod_usr_methods.t:4</a></div></div>
<div class="ttc" id="anamespacemod__usr__methods_html_a5477c9301c7327d2bed2c833a97428c2"><div class="ttname"><a href="namespacemod__usr__methods.html#a5477c9301c7327d2bed2c833a97428c2">mod_usr_methods::usr_print_log</a></div><div class="ttdeci">procedure(p_no_args), pointer usr_print_log</div><div class="ttdef"><b>Definition:</b> <a href="mod__usr__methods_8t_source.html#l00021">mod_usr_methods.t:21</a></div></div>
<div class="ttc" id="anamespacemod__usr__methods_html_a8e96d26dba482ea92807a1d2c6d4a833"><div class="ttname"><a href="namespacemod__usr__methods.html#a8e96d26dba482ea92807a1d2c6d4a833">mod_usr_methods::usr_write_analysis</a></div><div class="ttdeci">procedure(p_no_args), pointer usr_write_analysis</div><div class="ttdef"><b>Definition:</b> <a href="mod__usr__methods_8t_source.html#l00022">mod_usr_methods.t:22</a></div></div>
<div class="ttc" id="anamespacemod__usr__methods_html_ae95367023a331f1118de73c42283b348"><div class="ttname"><a href="namespacemod__usr__methods.html#ae95367023a331f1118de73c42283b348">mod_usr_methods::usr_transform_w</a></div><div class="ttdeci">procedure(transform_w), pointer usr_transform_w</div><div class="ttdef"><b>Definition:</b> <a href="mod__usr__methods_8t_source.html#l00023">mod_usr_methods.t:23</a></div></div>
<div class="ttc" id="astructmod__forest_1_1tree__node_html"><div class="ttname"><a href="structmod__forest_1_1tree__node.html">mod_forest::tree_node</a></div><div class="ttdoc">The data structure that contains information about a tree node/grid block.</div><div class="ttdef"><b>Definition:</b> <a href="mod__forest_8t_source.html#l00011">mod_forest.t:11</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
